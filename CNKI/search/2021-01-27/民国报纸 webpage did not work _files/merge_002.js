var wordsGuid=(function(){function b(k,j){this.recommendDiv=k;this.inputText=j}var i="";var a;var h=typeof window!=="undefined";var g=h&&window.navigator.userAgent.toLowerCase();var f=g&&/msie|trident/.test(g);var d=g&&g.indexOf("msie 9.0")>0;b.prototype={init:function(){var j=this;if(typeof(searchClassify)!=="undefined"){a=new searchClassify()}j.inputFunc();j.recommendCheckbox()},clearInputAttr:function(j){j.removeAttr("data-checkedcode");j.removeAttr("data-field");j.removeAttr("searchWord");j.removeAttr("data-authorcode");j.removeAttr("data-authorunit");j.removeClass("disable-editor");j.removeClass("is-input-error")},clearRecommendBox:function(k){var j=k.attr("data-tipid");if(!!j){$("#"+j).hide().siblings(".default-info").show();$("#"+j).remove()}if($(".search-sidebar-b .recommend-info").length==0){$(".search-sidebar-b .prototype").addClass("recommend-info")}},inputFunc:function(){var j=this;var m=j.inputText;var n=j.recommendDiv;var l=false;$(j.inputText).parents(".search-box").on("click",".input-box .reopt li",function(p){p.preventDefault();if($(this).hasClass("prevCur")){$(this).removeClass("prevCur");return}else{if(!$(this).hasClass("tit")){$(this).closest(".sort-list").find("li.prevCur").removeAttr("class")}}var o=$(this).closest(".input-box").find(":text");var q=$(this).text();j.clearInputAttr(o);j.clearRecommendBox(o);if(o.siblings("a.btn-cleartext").length>0){o.siblings("a.btn-cleartext").hide()}});$("body").on("focus",j.inputText,function(r){r.preventDefault();var s=$(this).attr("noneedtip");if(s=="1"){return}var w=$(this).attr("data-tipid");var p=$("div.recommend-info").attr("id");var u=$(this).val();var q=$(this).hasClass("disable-editor")?$(this).attr("searchword"):$(this).val();var v=$(this).siblings("div.droplist").find("li");if(!!u&&u!=$(this).attr("placeholder")){if($(this).siblings("a.btn-cleartext").length>0){$(this).siblings("a.btn-cleartext").show()}}else{v.parent().empty()}var o=$(".recommend-info");if((!!q===false)&&(!!u===false)){o.hide().siblings(".default-info").show();return}var t=$("#"+w);if(!!t&&(t.attr("searchtext")===$.trim(q)||t.attr("searchtext")===$.trim(u))){if(!t.hasClass("noContent")){t.addClass("recommend-info").show().siblings().removeClass("recommend-info").hide()}else{t.hide().siblings().hide().siblings(".default-info").show()}if(!!a){a._rightRecommendH()}return}if(v.length>0){q=$(this).attr("searchword");if(!!q){v.closest("div.droplist").show();return}}j._judgeRecommend(this)});$("body").on("mouseup",function(o){o.preventDefault();var q=j.recommendDiv;var p=j.inputText;if($(o.target).closest(p).length==0&&$(o.target).closest(q).length==0&&$(o.target).closest(".popup-prompt").length==0){if($(j.recommendDiv).find(".default-info").length>0){$(j.recommendDiv).find(".default-info").show().siblings().hide()}else{$(j.recommendDiv).hide()}}});var k=function(o,q){var p;return function(){var s=this;var r=arguments;clearTimeout(p);p=setTimeout(function(){o.apply(s,r)},q)}};$("body").on("compositionstart",j.inputText,function(o){l=true});if(d){$("body").on("keyup",j.inputText,function(o){if(o.keyCode==8||o.keyCode==46){$(this).trigger("input")}})}$("body").on("input",j.inputText,k(function(r){if(l){return}var q=$(this).attr("noneedtip");if(q=="1"){return}var u=this;var o=$(u);var p=$.trim(o.val());var s=$.trim($("#"+o.attr("data-tipid")).attr("searchtext"));if(p!==s||o.hasClass("disable-editor")){j.clearInputAttr(o);j.clearRecommendBox(o)}if(o.siblings("a.btn-cleartext").length>0){if(!!o.val()&&o.val()!=o.attr("placeholder")){o.siblings("a.btn-cleartext").show()}else{o.siblings("a.btn-cleartext").hide();$(j.recommendDiv).hide();return}}if(o.val().indexOf("+")==-1&&o.val().indexOf("（")==-1&&o.val().indexOf("(")==-1){o.removeClass("disable-editor")}if(!!o.attr("data-tipid")){var t=o.attr("data-tipid");$("#"+t).hide();if(o.hasClass("disable-editor")){$("#"+t).siblings(".default-info").show()}else{j._judgeRecommend(u)}}else{if(o.hasClass("disable-editor")){$(j.recommendDiv).hide();$(j.recommendDiv).find("ul").empty();return false}else{j._judgeRecommend(u)}}},300));$("body").on("compositionend",j.inputText,function(){l=false})},recommendCheckbox:function(){var j=this;var m=5;var l;var n=false;function k(r){var p=$(r).closest(".recommend-info-list");var q=$(r).closest(".recommend-fund-list");if(p.length>0){return $(r).closest(".recommend-info-list")}else{if(q.length>0){return $(r).closest(".recommend-fund-list")}else{return $(r).closest(".recommend-info")}}}function o(q){var r=$(q).closest(".recommend-info").attr("id");if(!!r){var s=$(q).closest(".grade-search-content,.author-search-content").find("input[data-tipid='"+r+"']");var p=$.trim(s.attr("searchWord"));s.val(p);s.removeClass("disable-editor");j.clearInputAttr(s)}}$(j.recommendDiv).unbind("click").on("click",".icon",function(){var p=$(this).parent();p.toggleClass("is-down");if(p.hasClass("is-down")){p.next("ul").slideDown()}else{p.next("ul").slideUp()}});$(j.recommendDiv).on("click",".btn-clear-selected",function(){recommendBox=k(this);var q=$(this).parents(".recommend-info").attr("id");var p=$("input[data-tipid='"+q+"']");if(!!p.hasClass("disable-editor")){o(this)}recommendBox.find("input[type=checkbox]").prop("checked",false);recommendBox.find("label").removeClass("selected");$(".popup-prompt").remove()});$(j.recommendDiv).on("click","ul.recommendList input[type=checkbox]",function(){var z=function(R,X){n=true;R.find(":checked").prop("checked",false);R.find("label").removeClass("selected");var S=R.find("span.organ");var Z="";var aa=P.attr(X);$.each(S,function(){aa=aa.replace($.trim($(this).attr("value")),"")});var W=aa.split("+");for(var Y=0,T=W.length;Y<T;Y++){if(!!W[Y]){Z+=W[Y]+"+"}}P.attr(X,Z.substring(0,Z.length-1));var U=P.val();$.each(S,function(){U=U.replace($.trim($(this).text()),"")});var V=U.split("+");Z="";for(var Y=0,T=V.length;Y<T;Y++){if(!!V[Y]){if(Y==T-1||$.trim(W[Y])=="）"){Z+=V[Y]}else{Z+=V[Y]+"+"}}}P.val(Z)};var J=function(){if(y.indexOf("（")==-1&&y.indexOf("(")==-1){return y+"（"+organText+"）"}else{return M(B)}};var M=function(S){text="";if(S.length==1){return S[0]}else{for(var T=0,R=S.length;T<R;T++){if(T!=0){text+=T==1?S[T]:(" + "+S[T])}}return S[0]+"（"+text+"）"}};var w=function(V,S){var R=new Array();if(S){var T=[];if(V.indexOf("（")==3){T.push(V.substring(0,3));T=T.concat(V.substring(4,V.length-1).split(/[+]/))}else{T=V.split(/[+()（）]/)}}else{var T=V.split(/[+]/)}for(var U=0;U<T.length;U++){if(!$.trim(T[U])==""){R.push($.trim(T[U]))}}return R};var x=function(T,R){for(var S=0;S<T.length;S++){if($.trim(T[S])==R){return S}}return -1};var C=function(S,R){var T=x(S,R);if(T>-1){S.splice(T,1)}};var F=k(this);var I=F.attr("class").indexOf("authorlist")>-1;var A=F.hasClass("js-recommend-themelist");var H=$(this).closest(".recommend-info").attr("id");var K=$(this).parents("ul.recommendList").attr("data-field");var P=$(this).closest(".grade-search-content,.author-search-content").find("input[data-tipid='"+H+"']");if(P.length==0){P=$(j.inputText)}l=!!P.val()?P.val().split("+").length:0;if(A){l--}if(I){var E;if(!P.attr("data-authorcode")&&!P.attr("data-authorunit")){P.attr("searchWord",$.trim(P.val()))}if($(this).parents("ul").siblings("div.item").length==0){var G=$(this).parents("div.item").siblings("ul");if(!!G.find(":checked").length>0){z(G,"data-authorunit")}E="data-authorcode"}else{var t=$(this).parents("ul").siblings("div.item");if(!!t.find(":checked").length>0){z(t,"data-authorcode")}E="data-authorunit"}var u=P.attr(E);var v=!!u?w(u,I):[];var s=$.trim($(this).siblings("span.organ").attr("value"));var y=P.val()}else{var u=P.attr("data-checkedcode");var v=!!u?w(u,I):[];var s=$.trim($(this).attr("value"));var y;if(!!u){y=P.val()}else{y="";P.attr("searchWord",$.trim(P.val()))}}var r=$(this).closest("label");var q=P.attr("searchWord");var O=new RegExp(q,"g");if(I){y=$.trim(y).replace(O,"<$>");var p=y.substring(3).replace(/\<\$\>/g,q);y="<$>"+p}var B=w(y,I);var N=$.trim(r.text());var D;if(r.hasClass("selected")){r.removeClass("selected");l--;if(I){organText=$.trim(r.find(".organ").text());C(B,organText);D=M(B).replace("<$>",q);P.val(D);C(v,s);D="";for(var L=0,Q=v.length;L<Q;L++){D+=L==0?v[L]:("+"+v[L])}P.attr(E,D)}else{C(B,N);D="";for(var L=0;L<B.length;L++){D+=L==0?B[L]:(" + "+B[L])}P.val(D);C(v,s);D="";for(var L=0,Q=v.length;L<Q;L++){D+=L==0?v[L]:("+"+v[L])}P.attr("data-checkedcode",D)}if(B.length<=1){P.removeClass("disable-editor")}}else{if(l<m||n){r.addClass("selected");if(I){organText=$.trim(r.find(".organ").text());B.push(organText);D=J().replace("<$>",q);P.val(D);v.push(s);D=!!u?u+"+"+s:s;P.attr(E,D)}else{B.push(N);D=!!u?y+" + "+N:N;if(A&&!u){P.val(P.attr("searchWord")+" + "+D)}else{P.val(D)}v.push(s);D=!!u?u+"+"+s:s;P.attr("data-checkedcode",D)}if(!P.attr("data-field")){P.attr("data-field",K)}P.addClass("disable-editor")}}});$(j.recommendDiv).on("click","ul.recommendList input[type=checkbox]",function(){if(n){n=false;return}var p=$(this).parents("ul.recommendList").parent();if(l>=m){if($(".popup-prompt").length>0){clearTimeout(autoDelPop);$(".popup-prompt").remove()}popupPrompt=$('<div class="popup-prompt">\n   <a class="btn-close" href="javascript:void(0)"></a>\n   <p>最多只能选择'+m+'项</p>\n   <a class="btn-confirm" href="javascript:void(0)">确定</a>\n</div>').on("click",".btn-close,.btn-confirm",function(){$(this).parent().remove()});p.append(popupPrompt);autoDelPop=setTimeout(function(){popupPrompt.remove()},2000);return false}});$(".droplist").on("click","li.theme",function(){$("input.search-input").val($(this).find("span").text());$(".search-btn").click()})},setCheckedItems:function(l,j,q){if(q){var s=l.attr("data-authorcode");if(!!s){var m=s.split("+");for(var p=0,k=m.length;p<k;p++){var o=$.trim(m[p]);var t=j.find("span[value='"+o+"']").siblings(":checkbox");if(!!t){t.prop("checked",true);t.parent().addClass("selected")}}}var n=l.attr("data-authorunit");if(!!n){var m=n.split("+");for(var p=0,k=m.length;p<k;p++){var o=$.trim(m[p]);var t=j.find("span[value='"+o+"']").siblings(":checkbox");if(!!t){t.prop("checked",true);t.parent().addClass("selected");t.parents("ul").show().siblings("div.item").addClass("is-down")}}}}else{var r=l.attr("data-checkedcode");if(!!r){var m=r.split("+");for(var p=0,k=m.length;p<k;p++){var o=$.trim(m[p]);var t=j.find("input[value='"+o+"']");if(!!t){t.prop("checked",true);t.parent().addClass("selected")}}}}},getData:function(m,k,n,j,o){var l=typeof i=="function"?false:true;$.ajax({url:APPPATH+"/AdvSearch/Recommend",data:{pageIndex:m,xmltype:k,searchName:n},type:"POST",dataType:"json",async:l,success:function(p){j(m,p,o)}})},getAuthorData:function(l,m,j){if(!!l==false){l="1"}var k=typeof i=="function"?false:true;$.ajax({url:APPPATH+"/AdvSearch/AuthorRecommend",data:{pageIndex:l,authorName:m},type:"POST",async:k,dataType:"json",success:function(n){j(l,n)}})},creatHtml:function(p){var l={CCJD:"CJFD_",CJFQ:"CJFD_",CCND:"CCND_"};var m="";var n=$("#dbcode").val();for(var k=0;k<p.list.length;k++){var j;if(!!p.list[k].ViewCode&&n.toUpperCase()==="SCDB"){j=l[p.list[k].ViewCode]}j=!!j?j:"";var o='<li><label><input value="'+j+p.list[k].Code+'" type="checkbox"><span title="'+p.list[k].Name+'">'+p.list[k].Name+"</span></label></li>\n";m=m+o}return m},creatAuthorHtml:function(p){var n="";for(var j=0;j<p.list.length;j++){var m;SecondInstitution=p.list[j].SecondInstitution.split(";");var o='             <li>\n                <div class="item"><i class="icon"></i><label href="javascript:void(0);"><input type="checkbox"><span title="'+p.list[j].AuthorName+'">'+p.list[j].AuthorName+'</span><span class="organ" value="'+p.list[j].AuthorCode+'" title="'+p.list[j].FirstInstitution+'">'+p.list[j].FirstInstitution+"</span></label></div>\n                <ul>\n";var q="";for(var l=0;l<SecondInstitution.length;l++){if(!SecondInstitution[l]){continue}q=q+'<li><div><label href="javascript:void(0);"><input type="checkbox"><span title="'+p.list[j].AuthorName+'">'+p.list[j].AuthorName+'</span><span class="organ" value="'+SecondInstitution[l]+'" title="'+SecondInstitution[l]+'">'+SecondInstitution[l]+"</span></label></div></li>\n"}var r="                 </ul>\n             </li>\n";m=o+q+r;n=n+m}return n},getThemeDataBySug:function(o,m,k,l,p){var n=$("div.data-selected>span").attr("value");var j="//search-1cnki-1net-10097d65e0393.erf.sbb.spk-berlin.de/sug/su.ashx?action=getsmarttips&kw="+encodeURIComponent(o)+"&jsonvar=eJson&t=&attr=1&p=0.28596960222989365";$.ajax({url:j,timeout:1000,type:"GET",dataType:"jsonp",complete:function(){if(!eJson){return}var r=eJson.sug.replace(/[|*@]/g,"");var q=m(r);k.empty();k.append(q);k.siblings(".search-page").hide();k.siblings(".btn-morefund").hide();b.prototype.setCheckedItems(l,p);if(typeof i=="function"){i(r)}}})},showOrhide:function(k){var j=$(".recommend-info");if(k){j.removeClass("noContent");j.hasClass("droplist")?j.show():j.show().siblings().hide()}else{j.addClass("noContent");j.hasClass("droplist")?j.hide():j.siblings(".default-info").show().siblings().hide()}}};function c(k,j){this.recommendDiv=k;this.inputText=j;b.prototype.init.call(this)}c.prototype=new b();c.prototype.constructor=c;c.prototype._judgeRecommend=function(o,l){var m=this;var k=0;inputObj=$(o);i=l;mainSearch=inputObj.closest(".search-mainbox");rightSearch=mainSearch.siblings(".search-sidebar-b");reoptText=$.trim(inputObj.siblings(".reopt").find(".sort-default>span").text());reoptArr=Object.keys(message.RecommendIndex);if(reoptArr.indexOf(reoptText)==-1){rightSearch.find("dl.default-info").show().siblings().hide();return false}inputVal=!!inputObj.attr("searchWord")?inputObj.attr("searchWord"):$.trim(inputObj.val());tipID=inputObj.attr("data-tipID");recommendInfoBox=rightSearch.find(".recommend-info");if(inputVal==""||(inputObj.hasClass("disable-editor")&&recommendInfoBox.length==0)){rightSearch.find(".default-info").show().siblings().hide()}else{var n=$("#"+tipID);if(n.length>0&&(n.attr("searchText")===$.trim(inputObj.val())||inputObj.hasClass("disable-editor"))){if(!n.hasClass("noContent")){recommendInfoBox.removeClass("recommend-info").hide();n.show().addClass("recommend-info").siblings().hide()}return}var p=recommendInfoBox.attr("id");if(p!==tipID&&n.length==0){var r=$("input[data-tipid='"+p+"']");var q=r.hasClass("disable-editor")?r.attr("searchword"):r.val();recommendInfoBox.parent().append(recommendInfoBox.clone().removeClass("recommend-info").attr("searchText",q));recommendInfoBox.removeClass("prototype")}else{if(n.length==1){n.addClass("recommend-info").siblings().removeClass("recommend-info");recommendInfoBox=n}}iconTop=inputObj.offset().top-inputObj.parents(".search-middle").offset().top+(inputObj.height()-16)/2;recommendInfoBox.find(".icon-triangle").css("top",iconTop+"px");recommendInfoBox.attr("id",tipID);recommendInfoBox.find(".reopt-tit").text(reoptText);recommendInfoBox.find("ul.recommendList").empty();recommendInfoBox.find("ul.recommendList~div").hide();recommendInfoBox.attr("searchText",$.trim(inputObj.val()));m._matchListFormat(recommendInfoBox,reoptText,inputVal)}};c.prototype._matchListFormat=function(t,B,n){var E=this;if(!n){return}var l=t.attr("id");var G=$("input[data-tipid="+l+"]");var q=t.find(".recommendList");var s=function(I,K,J){q.siblings(".search-page").hide();q.siblings(".btn-morefund").hide();if(K.total==0){q.empty();E.showOrhide(false)}else{var H=E.creatHtml(K);if(J){if(I=="1"){q.empty()}q.siblings(".search-page").hide();if(K.maxPageIndex<=1||I==K.maxPageIndex){$(".btn-morefund").hide()}else{$(".btn-morefund").show()}}else{q.empty();if(K.maxPageIndex>1){q.siblings(".search-page").show()}else{q.siblings(".search-page").hide()}}q.append(H);q.siblings(".search-page").find("b").text(I);q.siblings(".search-page").find("em").text(K.maxPageIndex);q.closest("div.recommend-info").show().siblings().hide();E.setCheckedItems(G,q);E.showOrhide(true);a._rightRecommendH()}if(typeof i=="function"){i(K)}};var x=function(I,J){q.siblings(".search-page").hide();q.siblings(".btn-morefund").hide();if(J.total==0){q.empty();E.showOrhide(false)}else{var H=E.creatAuthorHtml(J);q.empty();q.append(H);q.siblings(".search-page").find("b").text(I);q.siblings(".search-page").find("em").text(J.maxPageIndex);if(J.maxPageIndex>1){q.siblings(".search-page").show()}else{q.siblings(".search-page").hide()}E.setCheckedItems(G,t,true);if(!!a){a._rightRecommendH()}E.showOrhide(true)}if(typeof i=="function"){i(J)}};var p=function(H,I,J){$(".search-page a").unbind("click").on("click",function(){var M=$(this).parents(".search-page").find("b").text();l=$(this).parents(".recommend-info").attr("id");G=$("input[data-tipid="+l+"]");q=$("div.recommend-info>ul.recommendList");var L=!!G.attr("searchWord")?G.attr("searchWord"):G.val();var K=$(this).parents(".search-page").find("em").text();if($(this).hasClass("but-l")){if(M=="1"){return}else{M--}}else{if($(this).hasClass("but-r")){if(M==K){return}else{M++}}else{return}}if(I){E.getAuthorData(M,L,x)}else{if(J){E.getData(M,H,L,s,true)}else{E.getData(M,H,L,s)}}if(M==K){$(this).parents(".search-page").find("a.but-r").attr("disable","true");$(this).parent().siblings("div.btn-morefund").hide()}else{if(M=="1"){$(this).parents(".search-page").find("a.but-l").attr("disable","true")}else{$(this).parents(".search-page").find("a.but-r").attr("disable","false");$(this).parents(".search-page").find("a.but-l").attr("disable","false")}}$(this).parents(".search-page").find("b").text(M)});$("div.btn-morefund a").unbind("click").on("click",function(){$(this).parent().siblings(".search-page").find("a.but-r").click()})};var A=function(){var I=$("#RecommendApi").val();if(!I){return}var H=$.ajax({url:I+"/api/Recommend/GetTheme",async:true,data:{themeText:n,language:LanguageEncode.toUpperCase()},type:"GET",dataType:"json",success:function(K){if(K.isSuccess){var J=y(K.data);q.empty();q.append(J);a._rightRecommendH();q.siblings(".search-page").hide();q.siblings(".btn-morefund").hide();E.setCheckedItems(G,t)}else{E.getThemeDataBySug(n,y)}if(typeof i=="function"){i(K)}}})};var y=function(K){E.showOrhide(K.length>0);var H="";for(var I=0;I<K.length;I++){var J='<li class="theme-item"><label><input value="'+K[I].name+'"type="checkbox"><span title="'+K[I].name+'" >'+K[I].name+"</span></label></li>\n";H=H+J}return H};var o=function(){t.find("h6>span").text(message.RecommendWords);q.removeClass().addClass("recommend-info-list js-recommend-themelist recommendList");q.attr("data-field","");A()};var z=function(){t.find("h6>span").text(message.RecommendAuthor);q.removeClass().addClass("recommend-info-list js-recommend-authorlist recommendList");q.attr("data-field","AUC|AF");E.getAuthorData("1",n,x);p(null,true)};var F=function(){t.find("h6>span").text(message.RecommendAuthor);q.removeClass().addClass("recommend-info-list js-recommend-authorlist recommendList");q.attr("data-field","AUC|AF");E.getAuthorData("1",n,x);p(null,true)};var r=function(){t.find("h6>span").text(message.RecommendAuthor);q.removeClass().addClass("recommend-info-list js-recommend-authorlist recommendList");q.attr("data-field","IAUC|IAF");E.getAuthorData("1",n,x);p(null,true)};var k=function(){t.find("h6>span").text(message.RecommendLiterature);q.removeClass().addClass("recommend-info-list js-recommend-journallist recommendList");q.attr("data-field","LYC");E.getData("1","literaturerecommend",n,s);p("literaturerecommend")};var v=function(){t.find("h6>span").text(message.RecommendJournal);q.removeClass().addClass("recommend-info-list js-recommend-journallist recommendList");q.attr("data-field","LYC");E.getData("1","journalrecommend",n,s);p("journalrecommend")};var w=function(){t.find("h6>span").text(message.RecommendNewspaper);q.removeClass().addClass("recommend-info-list js-recommend-journallist recommendList");q.attr("data-field","LYC");E.getData("1","newsrecommend",n,s);p("newsrecommend")};var C=function(){t.find("h6>span").text(message.RecommendYearbook);q.removeClass().addClass("recommend-info-list js-recommend-journallist recommendList");q.attr("data-field","LYC");E.getData("1","yearbookrecommend",n,s);p("yearbookrecommend")};var j=function(){t.find("h6>span").text(message.RecommendMagzine);q.removeClass().addClass("recommend-info-list js-recommend-journallist recommendList");q.attr("data-field","LYC");E.getData("1","compilationrecommend",n,s);p("compilationrecommend")};var m=function(){t.find("h6>span").text(message.RecommendFund);q.removeClass().addClass("recommend-fund-list js-recommend-fundlist recommendList");q.attr("data-field","FUC");$(".search-page").hide();E.getData("1","fundrecommend",n,s,true);p("fundrecommend",false,true)};var u={"主题":o,"篇名":o,"题名":o,"正文":o,"专利名称":o,"标准名称":o,"成果名称":o,"关键词":o,"摘要":o,"全文":o,"报告标题":o,"标题":o,"职业标准名称":o,"成果简介":o,"作者":z,"第一作者":F,"通讯作者":r,"文献来源":k,"期刊名称":v,"基金":m,"报纸名称":w,"年鉴名称":C,"辑刊名称":j};var D=message.RecommendIndex[B];if(D in u){u[D]()}};function e(k,j){this.recommendDiv=k;this.inputText=j;b.prototype.init.call(this)}e.prototype=new b();e.prototype.constructor=e;e.prototype.privateEvent=function(){var j=this;$(j.recommendDiv).on("mouseenter",".item",function(){recommendList=$(this).closest(".recommend-info-list");if($(this).hasClass("hover")){return}recommendList.find(".item").removeClass("hover");$(this).addClass("hover")});$("body").on("click","a.btn-cleartext",function(){$(this).siblings(":text").val("");j.clearInputAttr($(this).siblings(":text"));$(this).hide()})};e.prototype._judgeRecommend=function(k){var j=this;var l=$(k).siblings("div.sort.reopt").find(".sort-default span").text();var m=!!$(k).attr("searchWord")?$(k).attr("searchWord"):$.trim($(k).val());if(m==""||m==$(k).attr("placeholder")){$(j.recommendDiv).hide();return}else{j._matchListFormat($(j.recommendDiv).find("ul"),l,m)}};e.prototype._matchListFormat=function(s,z,m){var C=this;if(!m){return}var p=s;var E=$(C.inputText);var r=function(G,I,H){if(I.total==0){C.showOrhide(false)}else{var F=C.creatHtml(I);p.empty();if(I.maxPageIndex>1){p.siblings(".search-page").show()}else{p.siblings(".search-page").hide()}p.append(F);p.siblings(".search-page").find("b").text(G);p.siblings(".search-page").find("em").text(I.maxPageIndex);C.setCheckedItems(E,p);C.showOrhide(true)}};var w=function(G,H){if(H.total==0){C.showOrhide(false)}else{var F=C.creatAuthorHtml(H);p.empty();p.append(F);p.siblings(".search-page").find("b").text(G);p.siblings(".search-page").find("em").text(H.maxPageIndex);if(H.maxPageIndex>1){p.siblings(".search-page").show()}else{p.siblings(".search-page").hide()}C.setCheckedItems(E,s,true);p.find("li>div").removeClass("item").addClass("item");C.showOrhide(true)}};var o=function(F,G){$(".search-page a").unbind("click").on("click",function(){var K=$(".search-page b").text();var I=$(C.inputText);var J=!!I.attr("searchWord")?I.attr("searchWord"):I.val();var H=$(".search-page em").text();if($(this).hasClass("but-l")){if(K=="1"){return}else{K--}}else{if($(this).hasClass("but-r")){if(K==H){return}else{K++}}else{return}}if(G){C.getAuthorData(K,m,w)}else{C.getData(K,F,m,r)}if(K==H){$(".search-page a.but-r").attr("disable","true");$("div.btn-morefund").hide()}else{if(K=="1"){$(".search-page a.but-l").attr("disable","true")}else{$(".search-page a.but-r").attr("disable","false");$(".search-page a.but-l").attr("disable","false")}}$(".search-page b").text(K)})};var y=function(){p.removeClass().addClass("recommend-info-list recommend-authorlist recommendList");p.attr("data-field","AUC|AF");C.getAuthorData("1",m,w);o(null,true)};var D=function(){p.removeClass().addClass("recommend-info-list recommend-authorlist recommendList");p.attr("data-field","FIC|FAF");C.getAuthorData("1",m,w);o(null,true)};var q=function(){p.removeClass().addClass("recommend-info-list recommend-authorlist recommendList");p.attr("data-field","IAUC|IAF");C.getAuthorData("1",m,w);o(null,true)};var k=function(){p.removeClass().addClass("recommend-info-list recommend-fundlist recommendList");p.attr("data-field","LYC");C.getData("1","literaturerecommend",m,r);o("literaturerecommend")};var n=function(){p.removeClass().addClass("recommend-info-list recommend-fundlist recommendList");p.attr("data-field","");C.getThemeDataBySug(m,x,p,E,s)};var x=function(I){if(!!I){I=I.split(";")}else{I=[]}C.showOrhide(I.length>0);var F="";for(var G=0;G<I.length;G++){if(!I[G]){continue}var H='<li class="theme"><span>'+I[G].replace(/#.*#/i,"")+"</span></label></li>\n";F=F+H}return F};var u=function(){p.removeClass().addClass("recommend-info-list recommend-fundlist recommendList");p.attr("data-field","LYC");C.getData("1","journalrecommend",m,r);o("journalrecommend")};var v=function(){p.removeClass().addClass("recommend-info-list recommend-fundlist recommendList");p.attr("data-field","LYC");C.getData("1","newsrecommend",m,r);o("newsrecommend")};var A=function(){p.removeClass().addClass("recommend-info-list recommend-fundlist recommendList");p.attr("data-field","LYC");C.getData("1","yearbookrecommend",m,r);o("yearbookrecommend")};var j=function(){p.removeClass().addClass("recommend-info-list recommend-fundlist recommendList");p.attr("data-field","LYC");C.getData("1","compilationrecommend",m,r);o("compilationrecommend")};var l=function(){p.removeClass().addClass("recommend-info-list recommend-fundlist recommendList");p.attr("data-field","FUC");C.getData("1","fundrecommend",m,r);o("fundrecommend")};var t={"文献来源":k,"作者":y,"第一作者":D,"通讯作者":q,"期刊名称":u,"基金":l,"报纸名称":v,"年鉴名称":A,"辑刊名称":j};var B=message.RecommendIndex[z];if(B in t){t[B]()}};return{getAdvWordsGuid:function(k,j){return new c(k,j)},getOneBoxWordsGuid:function(k,j){return new e(k,j)}}}());window.wordsGuid=wordsGuid; 
 var ajaxSubmit={smallwaiting:"#leftnavi",Submit:function(c,a,f,d,e,b){if(!b){b="POST"}if(!e){e="text"}if(a){a.random=Math.random()}$.ajax({type:b,contentType:"application/x-www-form-urlencoded",url:c,data:a,jsonp:e=="jsonp"?"callback":"",beforeSend:function(h){if(!d||d==""){return}$(d+" .loading").remove();var i=$(window).height();var k=$(document).scrollTop();var g=(i-300)/2+k;var j=$(d).width()/2;if((ajaxSubmit.smallwaiting+",").indexOf(d+",")>-1){$(d).prepend("<div class='loading' style=' position: fixed;width: 16px; height: 16px;z-index: 300;background: url("+APPPATH+"/Content/images/gb/waitingsmall.gif) no-repeat scroll center center transparent;position: relative;top: 30%;font-size: 16px;left: 40%;width: 110px;'></div>")}else{$(d).prepend("<div class='loading' style='position: fixed;height: 32px;z-index: 300; background: url("+APPPATH+"/Content/images/gb/waiting.gif) no-repeat scroll; padding-left: 35px;padding-top: 5px; top:"+g+"px;margin-left:"+(j-32)+"px'></div>")}},complete:function(g){},dataType:e,error:function(){$(d+" .loading").remove()},success:function(g){$(d+" .loading").remove();if(f){f(g)}else{if(!g){return""}}}})}}; 
 function getSortValue(a){var c=[{key:"pubdate",value:"%e5%8f%91%e8%a1%a8%e6%97%b6%e9%97%b4%2f(%e5%8f%91%e8%a1%a8%e6%97%b6%e9%97%b4%2c%27TIME%27)"},{key:"relevant",value:"%e7%9b%b8%e5%85%b3%e5%ba%a6%2f(ffd%2c%27rank%27)"},{key:"cite",value:"%e8%a2%ab%e5%bc%95%2f(%e8%a2%ab%e5%bc%95%e9%a2%91%e6%ac%a1%2c%27integer%27)"},{key:"download",value:"%e4%b8%8b%e8%bd%bd%2f(%e4%b8%8b%e8%bd%bd%e9%a2%91%e6%ac%a1%2c%27integer%27)"}];for(var b=0;b<c.length;b++){if(c[b].key==a){return c[b].value}}return""}function GetQueryStringByName(d,b){if(!!d==false||!b){b=d;d=window.location.href}if("[object String]"==Object.prototype.toString.call(d)&"[object String]"==Object.prototype.toString.call(b)){var c=d.match(new RegExp("[?&]"+b+"=([^&]+)","i"));if(c==null||c.length<1){return""}var a=c[1].replace(/#*$/,"");return decodeURIComponent(a)}return""}function SetQueryStringByName(e,a,b){if(!!e==false){a=e;e=window.location.href}if(!!e){var c=e.match(new RegExp("([?&]+)"+a+"=[^&]*","i"));var d=e;if(c!=null){d=e.replace(c[0],c[1]+a+"="+encodeURI(b))}else{if(e.indexOf("?")<0){d=e+"?"+a+"="+b}else{d=e+"&"+a+"="+b}}return d}return""}function J(a){return document.createElement(a)}function O(a,b,c){if(ISIE){if(b=="load"){a.onreadystatechange=function(){if(this.readyState=="loaded"){c()}}}else{a.attachEvent("on"+b,(function(d){return function(){c.call(d)}})(a))}}else{a.addEventListener(b,c,false)}}function CoreDomainLoadJson(){this.C;this.J=J;this.O=O;this.Load=function(d,a,b){var c=document.getElementById(b);if(c){document.body.removeChild(c)}this.C=J("SCRIPT");this.C.type="text/javascript";if(typeof b=="string"&&b.length>0){this.C.id=b}else{this.C.id="callScriptE"}this.C.src=d+"&td="+(new Date()).getTime();this.C.charset="utf-8";document.body.appendChild(this.C);O(this.C,"load",a)}}function addToCookie(b,a){company="cnki";cookie=new String(getCookie("RecordID"));if((cookie.length>0)&&((cookie.substring(0,cookie.indexOf(":"))==company))){if(cookie.length-1==cookie.indexOf(":")){setCookie("RecordID",cookie+b,a)}else{setCookie("RecordID",cookie+","+b,a)}}else{setCookie("RecordID",company+":"+b,a)}}function setCookie(a,c,b){if(window.localStorage){if(c&&c!=""){if(b==2||b=="2"){sessionStorage.setItem(a,c)}else{localStorage.setItem(a,c)}}}else{document.cookie=a+"="+escape(c)+";path=/"}}function getCookie(a,b){if(window.localStorage){if(b=="2"||b==2){return sessionStorage.getItem(a)}else{return localStorage.getItem(a)}}return getValueFromCookie(a)}function delCookie(b,c){if(window.localStorage){if(c=="2"||c==2){sessionStorage.removeItem(b)}else{localStorage.removeItem(b)}}var a=new Date();a.setTime(a.getTime()-1);var d=getCookie(b);if(d!=null){document.cookie=b+"="+d+";expires="+a.toGMTString()}}function getValueFromCookie(d){var e=d+"=";var h=false;var g=0;var c=0;var b=document.cookie;var f="";var a=0;while(a<b.length){g=a;c=g+e.length;if(b.substring(g,c)==e){h=true;break}a++}if(h==true){g=c;c=b.indexOf(";",g);if(c<g){c=b.length}f=unescape(b.substring(g,c))}if(f.indexOf("cnki:")==0){f=f.substring(5,f.length)}return f}function ValidDbcode(a){if(!a){return false}if(!/^[a-z_A-Z]+$/i.test(a)){return false}return true}function GetCNKIUserKey(){var a=getValueFromCookie("cnkiUserKey");if(a){return a}function b(){var d="";for(var e=1;e<=32;e++){var c=Math.floor(Math.random()*16).toString(16);d+=c;if((e==8)||(e==12)||(e==16)||(e==20)){d+="-"}}return d}a=b();$.ookie("cnkiUserKey",a,{expires:3650,path:"/"});return a}function getUInfoFromECP(o){if(!o){return""}var ecpjosn=getValueFromCookie("Ecp_LoginStuts");if(ecpjosn){var ecpjosntype=eval("("+ecpjosn+")");switch(o){case"uname":return ecpjosntype.ShowName;case"utype":return ecpjosntype.UserType;default:return""}}return""}function isPersonal(){if(getUInfoFromECP("utype")=="bk"){return false}else{return true}}function getUsername(){return getUInfoFromECP("uname")}String.prototype.cnkiFormat=function(){var a=this.toString();var b=/[<][a-zA-Z/]+/ig;if(b.test(a)){a=a.replace(/</ig,"< ")}return $.trim(a)};String.prototype.format=function(){var a=arguments;return this.replace(/\{(\d+)\}/g,function(b,c){return a[c]})};String.prototype.ltrim=function(){return this.replace(/^\s+/,"")};String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};String.prototype.trim=function(){return this.ltrim().rtrim()};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length>>>0;var c=Number(arguments[1])||0;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1}}function checkLength(a){if(a&&a.length>1000){layer.alert(message.mostInput,{btn:message.Confirm,title:message.info})}}var GetPageName=function(){var d=window.location.href;var b=new RegExp(APPPATH+"/([^&/?]*)");var a=d.match(b);if(a==null||a.length<1){return"DefaultResult"}var c=decodeURIComponent(a[1]);c-!!c?c:"DefaultResult";return c};var createElement=function(e,d,c,b){var a=document.createElement(e);a.type=d;a.name=c;a.value=b;return a};var postSubmit=function(c,f,a,b){$("#"+c).remove();var e=$("<form>");e[0].action=f;e[0].method="post";e[0].target=b;e[0].style.display="none";e[0].id=c;if(a){for(var d=0;d<a.length;d++){e[0].appendChild(a[d])}}document.body.appendChild(e[0]);e[0].submit();return e};(function(c){function b(f,h){var e=h.split("?");for(var g=0;g<e.length;g++){var d=document.createElement("input");d.type="hidden";d.name=e[g].substring(0,e[g].indexOf("="));d.value=e[g].substring(e[g].indexOf("=")+1);f.appendChild(d)}}function a(e,g){for(var f in g){var d=document.createElement("input");d.type="hidden";d.name=f;d.value=g[f];e.appendChild(d)}}c.PostWindow=function(f,g,e){var d=document.createElement("form");d.id="tempForm1";d.method="post";d.action=f;d.target=e?e:f;if(typeof(g)=="object"){a(d,g)}else{if(typeof(g)=="string"){b(d,g)}}if(document.attachEvent){d.attachEvent("onsubmit",function(){window.open("about:blank")})}else{if(document.addEventListener){d.addEventListener("onsubmit",function(){window.open("about:blank")})}}document.body.appendChild(d);d.submit();document.body.removeChild(d)};c.BrowserTab=function(e,g){var h="hidden" in document?"hidden":"webkitHidden" in document?"webkitHidden":"mozHidden" in document?"mozHidden":null;if(h!=null){var d=h.replace(/hidden/i,"visibilitychange");var f=function(i,j){if(!document[h]){if(typeof i=="function"){i()}}else{if(typeof j=="function"){j()}}};document.addEventListener(d,function(){f(e,g)})}}})(jQuery);var sessionCookieUnit={addToCookie:function(a,c){var b=encodeURIComponent(a)+"="+encodeURIComponent(c)+";path=/";document.cookie=b},getCookie:function(a){var c=encodeURIComponent(a)+"=",b=document.cookie.indexOf(c),e=null;if(b>-1){var d=document.cookie.indexOf(";",b);if(d==-1){d=document.cookie.length}e=decodeURIComponent(document.cookie.substring(b+c.length,d))}return e},unset:function(a){this.addToCookie(a,"")},};function crosAjaxRequest(c,d,g,i){var h=false;try{h=new XMLHttpRequest()}catch(e){try{h=new ActiveXObject("Msxml2.XMLHTTP")}catch(a){try{h=new ActiveXObject("Microsoft.XMLHTTP")}catch(f){h=false}}}if(!h){alert("Error initializing XMLHttpRequest!")}h.open("GET",c,true);h.onreadystatechange=b;h.send(null);function b(){if(h.readyState==4){if(h.status==200){var j=h.responseText;i(responseHtml)}}}}function crossDomain(){function b(c){return document.createElement(c)}function a(c,d,e){if(ISIE){if(d=="load"){c.onreadystatechange=function(){if(this.readyState=="loaded"){e(this.responseText)}}}else{c.attachEvent("on"+d,(function(f){return function(){e.call(f)}})(c))}}else{c.addEventListener(d,e,false)}}return function(f,c,d){var e=document.getElementById(d);if(e){document.body.removeChild(e)}this.C=b("SCRIPT");this.C.type="text/javascript";if(typeof d=="string"&&d.length>0){this.C.id=d}else{this.C.id="callScriptE"}this.C.src=f+"&td="+(new Date()).getTime();this.C.charset="utf-8";document.body.appendChild(this.C);a(this.C,"load",c)}}(function(a){var b=function(){};b.doValidate=function(c){var d=/[<>\\\;]/im;if(d.test(c)){layer.alert(message.inputParmsError,{btn:message.Confirm,title:message.info});return false}return true};b.hasDangerousChar=function(c){var d=/[<>\\]/im;if(d.test(c)){return true}return false};b.clearillegalChar=function(c){if(c){c=c.replace(/^\s+|[~!@$%^]+|\s+$/g,"")}if(c.length>1000){c=c.substring(0,1000)}return c};b.isCompositeExp=function(d){var e=/^['\"][^'\"]+['\"]$/;if(!e.test(d)&&/[^\+\*\-\s]+\s+[\+\*\-]\s+[^\+\*\-\s]+/.test(d)){var c=d.split("'").length-1;var f=d.split('"').length-1;if(c%2==0&&f%2==0&&b.isBrackBalance(d)){return true}else{return false}}return false};b.isBrackBalance=function(c){if(!c){return true}if(c.indexOf("(")<0&&c.indexOf(")")<0){return true}c=/['\"][^'\"]+['\"]/.replace(c,"*");var e=0;for(var d=0;d<c.length;d++){if(c[d]=="("){e++}if(c[d]==")"){e--}}if(e==0){return true}return false};b.ValidDOI=function(c,d){if(!c){return false}if(/^[\'\"]?10\./.test(c)){if(d){return/\//.test(c)}return true}return false};b.ValidExpertSearch=function(d){var c=/[=%]/ig;if(!c.test(d)){return false}var e=/\'\s(or|and)\s\'/i;if(e.test(d)){return false}return true};b.starYear=function(c){c=c.replace(/[^\d]/g,"");if(c.length==4){if(c<1979&&c!=1915&&c!=1949){return"1949"}var d=new Date().getFullYear();if(c>d){c=d}}return c};b.endYear=function(c){c=c.replace(/[^\d]/g,"");if(c.length==4){if(c<1979&&c!=1915&&c!=1949){return"1949"}var d=new Date().getFullYear();if(c>d){c=d}}return c};window.fliter=b})(jQuery); 
 var histroyuser=(function(){var c="/gethistory/gethistoryhandler.ashx";var b=APPPATH+"/dbpage/GetHistory";var e="/KRSWriteHandler.ashx";function d(m,p){if(!p){return true}var o=7;var l=new Date();l.setTime(l.getTime()+o*24*60*60*1000);var n=a(m);if(n){if(!i(n,$.trim(p))){if(window.sessionStorage){sessionStorage.setItem(m,p+"<#>"+n)}else{$.cookie(m,escape(p+"<#>"+n),{expires:l.toGMTString(),path:"/"})}return false}else{return true}}else{if(window.sessionStorage){sessionStorage.setItem(m,p+"<#>")}else{$.cookie(m,escape(p+"<#>"),{expires:l.toGMTString(),path:"/"})}return false}}function a(l){var o="";if(window.sessionStorage){o=sessionStorage.getItem(l)}else{var m,n=new RegExp("(^| )"+l+"=([^;]*)(;|$)");if(m=document.cookie.match(n)){o=unescape(m[2])}}if(o==null){o=""}return o}function j(m){if(window.sessionStorage){sessionStorage.removeItem(m)}else{var l=new Date();l.setTime(l.getTime()-1);$.cookie(m,"",{expires:l.toGMTString(),path:"/"})}}function i(o,l){var p=false;var q="";if(!o){return p}if(o.indexOf("<!>")>-1){var n=o.split("<#>");for(var m=0;m<n.length;m++){if(n[m].toString().substring(0,l.indexOf("<!>"))==l.substring(0,l.indexOf("<!>"))){p=true}}}else{var n=o.split("<#>");for(var m=0;m<n.length;m++){if(n[m].toString()==l){p=true}}}return p}function k(p){if(!p||p.length==0){return""}var n=p.split("<#>");var q=0;var o;var t="";for(var m=0,s=n.length;m<s;m++){if(!n[m]){continue}o=n[m].split("<!>");if(o.length!=3){continue}if(!o[2]||!o[1]||$.trim(o[1])=="null"){continue}if(q<5){var r="<li><a target='_blank' href='"+o[2]+"' title='"+o[1]+"'>"+(o[1].length>29?o[1].substring(0,29)+"...":o[1])+"</a></li>";t+=r}else{break}q++}return t}function g(n){var l=0,m="";for(var p=0;p<n.length;p++){if(!n[p]||n[p]==="undefined"){continue}var o="<li><a target='_blank' onclick='$(\".search-input\").val(\""+n[p]+'"); $(".search-btn").click()\' title=\''+n[p]+"'>"+(n[p].length>40?n[p].substring(0,40)+"...":n[p])+"</a></li>";if(l<5){m+=o}else{break}l++}$("#historysearch").html(m);$("#historysearch").parent().css("display","block")}function h(s,l,m){try{if(s=="undefined"||s==""||l=="undefined"||l==""){return}var r=getValueFromCookie("cnkiUserKey");var q=f();var n="";if(m=="download"){n="download.aspx?dbCode="+s+"&fileName="+l}else{if(m=="detail"){n="detail.aspx?dbCode="+s+"&fileName="+l}}var o=window.location;if(typeof WriteActionLog!="undefined"&&Object.prototype.toString.call(WriteActionLog)=="[object Function]"){WriteActionLog(q,r,n,o)}}catch(p){}}function f(){var l="";if(isPersonal()){l=getUsername()}return l}return{searchAdd:function(m){var n=d("UserInputs",m);if(n){return}$("#historysearch").prepend("<li><a target='_blank' onclick='$(\".search-input\").val(\""+m+'"); $(".search-btn").click()\'>'+m+"</a></li>");if($("#historysearch li").length>5){$("#historysearch li:last").remove()}var o=$("div.all-box div.switch-ChEn a").hasClass("cur")?$("#dbcode").val():($("ul.doctype-menus>li.cur a").attr("dbcode")||$("#dbcode").val());var l=$("#krs").val()+e+"?keyWord="+m+"&dbcode="+o+"&cnkiUserKey="+escape(getValueFromCookie("cnkiUserKey"))+"&action=keyWord&userName="+escape(f());ajaxSubmit.Submit(l)},sqlAdd:function(){var m=getValueFromCookie("cnkiUserKey");var n=f();var o=$("div.all-box div.switch-ChEn a").hasClass("cur")?$("#dbcode").val():($("ul.doctype-menus>li.cur a").attr("dbcode")||$("#dbcode").val());var l=$("#SqlValue").val()||$("#sqlVal").val();if(typeof WriteSQLLog!="undefined"&&Object.prototype.toString.call(WriteSQLLog)=="[object Function]"){WriteSQLLog(n,m,o,l)}},viewAdd:function(l){var n=d("UserSees",l);if(n){return}$("#historyview").prepend(k(l));if($("#historyview li").length>5){$("#historyview li:last").remove()}var m=l.split("!");h(m[1],m[0],"detail")},downloadAdd:function(l){var n=d("UserDownLoads",l);if(n){return}$("#historydownload").prepend(k(l));if($("#historydownload li").length>5){$("#historydownload li:last").remove()}var m=l.split("!");h(m[1],m[0],"download")},searchGet:function(){var l,m=a("UserInputs");if(m&&m.length>0){l=m.split("<#>")}if(l==null||l.length==0){var n={cnkiUserKey:$.cookie("cnkiUserKey"),username:f(),action:"keyword",pagesize:5,pageindex:1};ajaxSubmit.Submit($("#krs").val()+c,n,function(s){if(!s){$("#historysearch").parent().remove();return""}var p=JSON.parse(s);if(!p||!p.table||p.table.length==0){$("#historysearch").parent().remove();return""}var o="";for(var r=0;r<p.table.length;r++){o+=p.table[r].KeyWord+"<#>"}o=o.substring(0,o.length-3);var q=d("UserInputs",o);g(o.split("<#>"))},"","","get")}else{g(l)}},viewGet:function(){var l=a("UserSees");if(l){$("#historyview").html(k(l));$("#historyview").parent().css("display","block");if(!$("#historyview").html()){$("#historyview").parent().remove()}return}var m={cnkiUserKey:$.cookie("cnkiUserKey"),username:f(),action:"view",pagesize:5,pageindex:1};ajaxSubmit.Submit($("#krs").val()+c,m,function(s){if(!s){$("#historyview").parent().remove();return""}var o=s.table;if(!o||o.length==0){$("#historyview").parent().remove();return""}var q="",p="";for(var n=0;n<o.length;n++){q+=o[n].dbcode+",";p+=o[n].filename+","}var r={dbcode:q.substr(0,q.length-1),filename:p.substr(0,p.length-1)};ajaxSubmit.Submit(b,r,function(x){if(!x){$("#historyview").parent().remove();return""}var u=JSON.parse(x);if(!u||u.length==0){$("#historyview").parent().remove();return""}var t="";for(var w=0;w<u.length;w++){t+=u[w].FileName+"!"+u[w].DBCode+"!"+u[w].TableName+"<!>"+u[w].TitleName+"<!>http://tra-1oversea-1cnki-1net-10097d65e0393.erf.sbb.spk-berlin.de/kns/detail/detail.aspx?FileName="+u[w].FileName+"&DbName="+u[w].TableName+"&DbCode="+u[w].DBCode+"<#>"}t=t.substring(0,t.length-3);var v=d("UserSees",t);$("#historyview").html(k(t));$("#historyview").parent().css("display","block")})},"","jsonp","get")},downloadGet:function(){var l=a("UserDownLoads");if(l){$("#historydownload").html(k(l));$("#historydownload").parent().css("display","block");if(!$("#historydownload").html()){$("#historydownload").parent().remove()}return}var m={cnkiUserKey:$.cookie("cnkiUserKey"),username:f(),action:"download",pagesize:5,pageindex:1};ajaxSubmit.Submit($("#krs").val()+c,m,function(s){if(!s){$("#historydownload").parent().remove();return""}var o=s.table;if(!o||o.length==0){$("#historydownload").parent().remove();return""}var q="",p="";for(var n=0;n<o.length;n++){q+=o[n].dbcode+",";p+=o[n].filename+","}var r={dbcode:q.substr(0,q.length-1),filename:p.substr(0,p.length-1)};ajaxSubmit.Submit(b,r,function(x){if(!x){$("#historydownload").parent().remove();return""}var u=JSON.parse(x);if(!u||u.length==0){$("#historydownload").parent().remove();return""}var t="";for(var w=0;w<u.length;w++){t+=u[w].FileName+"!"+u[w].DBCode+"!"+u[w].TableName+"<!>"+u[w].TitleName+"<!>http://tra-1oversea-1cnki-1net-10097d65e0393.erf.sbb.spk-berlin.de/kns/detail/detail.aspx?FileName="+u[w].FileName+"&DbName="+u[w].TableName+"&DbCode="+u[w].DBCode+"<#>"}t=t.substring(0,t.length-3);var v=d("UserDownLoads",t);$("#historydownload").html(k(t));$("#historydownload").parent().css("display","block")})},"","jsonp","get")},clear:function(l){if(!l){j("UserInputs");j("UserSees");j("UserDownLoads")}else{if(l=="search"){j("UserInputs")}else{if(l=="view"){j("UserSees")}else{if(l=="download"){j("UserDownLoads")}}}}}}})();$(document).ready(function(){var a=GetQueryStringByName(window.location.href,"kw");if(a){histroyuser.searchAdd(a)}});$(".search-btn,.btn-search,.btn-result-search:not(.is-hide)").click(function(){var a=$("#txt_search").val()||$("input[data-tipid='gradetxt-1']:visible").val()||$("div.search-condition input[type=text]").val();histroyuser.searchAdd(a)}); 
 if(typeof ISIE=="undefined"){ISIE=navigator.userAgent.indexOf("MSIE")!=-1&&!window.opera}if(typeof sugPara!="Object"){sugPara={IsTopK:true,IsExp:true,Expara:{DefaultPicS:"http://c61-1cnki-1net-10097d65e0393.erf.sbb.spk-berlin.de",CSYDPicS:"http://192.168.100.131"},IsAttr:false,AttrCallFun:function(f){try{var b=$(f).find("input[name='codevalue']").val();var a=$(f).find("b").text();if(b){categoryClick(b,a);return false}}catch(d){}},attrSet:function(f){try{var b=$(f).find("input[name='codevalue']").val();var a=$(f).find("b").text();if(ge("hiddenNavi")){ge("hiddenNavi").innerHTML=SpecilNavi(b,a)}}catch(d){}},searchClick:function(){try{$("#btnSearch").click()}catch(a){}},getHistoryWords:function(){var b="UserInputs";var f=function(h){var k="";if(window.localStorage){k=localStorage.getItem(h)}else{var i,j=new RegExp("(^| )"+h+"=([^;]*)(;|$)");if(i=document.cookie.match(j)){k=unescape(i[2])}}if(k==null){k=""}return k};var d=f(b);d=d.replace(/\',\"/g,"");if(d){var g=d.split("<#>");var a=g.length;var c=new Array();for(var e=0;e<a;e++){if(g[e]==null||g[e]==""){continue}c.push(g[e])}return c}return[]},clearHistory:function(b,d){var c=function(g){var h=g+"=";if(document.cookie.length>0){offset=document.cookie.indexOf(h);if(offset!=-1){offset+=h.length;end=document.cookie.indexOf(";",offset);if(end==-1){end=document.cookie.length}return unescape(document.cookie.substring(offset,end))}}};if(window.localStorage){localStorage.removeItem("UserInputs")}else{var a=new Date();a.setTime(a.getTime()-1);var e=c("UserInputs");if(e!=null){document.cookie="UserInputs=| ;expires="+a.toGMTString()+";path=/"}}$("#newsearchhis").html("");$("#history_js").hide();$("#newsearchhis").hide();if(typeof CoreDomainLoadJson=="function"){var f=new CoreDomainLoadJson();f.Load("../request/GetUserInputsHandler.ashx?action=UserInputs",function(){},"AyclearHistoryScrpitO")}}}}function J(a){return document.createElement(a)}function createdroplist(){var a=document.getElementById("__droplist");if(a){document.body.removeChild(a)}a=J("div");a.id="__droplist";a.name="__droplist";if(a.className!="undefined"){a.className="dictdiv"}a.setAttribute("class","dictdiv");document.body.appendChild(a)}function InitSug(b){createdroplist();if(!this.space1){this.space1=CreateCacheSpace(20,0)}if(!this.space2){this.space2=CreateCacheSpace(20,0)}var a="input[id^=txt_][type!='checkbox'],input[id^=buttom_],input[id^=au_],input[id^=base],input[id^=magazine_],input[id^=sen_]";if(Object.prototype.toString.call(b)!="[object String]"){b=""}BindDroplist(a,b,sugPara)}function BindDroplist(V,o,W){if(o==undefined){return}sugUrlComm.Server=o;var K=function(ag){var ah=document.getElementById("expandarea");if(ah){ag=ag||window.event;var O=ag.srcElement||ag.target;while(O){if(O==ah){return true}O=O.parentNode}}};var g=$("#__droplist"),a="",y="",t=null,z="",H="",B="",ac="",T=-1,G=0,f="",c=W.IsTopK||false,ae=W.IsAttr||false,X=W.AttrCallFun||function(){},C=W.attrSet||function(){},E=W.IsExp||false,l=W.getHistoryWords||function(){return[]},m=function(){if(W.clearHistory){W.clearHistory()}g.empty()},L=false,s="180px",j=0;$(document.body).bind("click",function(O){if(K(O)){return}g.css("display","none")});function n(ag,O,ah){if(ag){return ag.addEventListener?ag.addEventListener(O,ah,false):ag.attachEvent("on"+O,ah)}}function q(ah){B=$(this).attr("id");t=$("#"+B);var ag=t.val();ag=ag.replace(/\s+/g," ");if(ag==""&&j!=1){g.hide();return}P();Q();var O=(ah.keyCode)||(ah.which)||(ah.charCode);if(!(O==40||O==38||O==13||O==9||O==27)){if(ag==z&&H==a){p(ag);return}}if((O==37||O==39)&&B==ac&&H==a){p(ag);return}if(O==9||O==40||O==38){var ai=false;if(O==9||O==40){ai=true}if(O==9){i(ah)}U(ai)}else{if(O==13){if(typeof firstTag!="undefined"&&firstTag==true){g.hide();firstTag=false}else{if(T!=-1){M();g.hide();T=-1}else{if(ag!=z||B!=ac||H!=a){w()}else{g.hide()}}}}else{if(O==27){g.hide()}else{w()}}}H=a;z=ag}function r(ag){ag=ag||function(){};if(typeof top_Words_Json=="undefined"){var O=new Z();O.Load(sugUrlComm.getTopUrl(o),ag,"TopWords_Request")}ag()}if(c){r(function(){});$(document).on("click",V,D)}$(document).on("keyup",V,q);function D(ag){t=ag.srcElement||ag.target;t=$(t);B=t.attr("id");var O=t.val();O=O.replace(/(^\s*)|(\s*$)/g,"");if(!O){g.empty();G=0;v(ag);d(ag);x().mousedown(function(ah){aa(this,ah)});A();T=-1}}function v(ag){var O=l();if(O&&O.length>0){j=0;new Array().slice;var ah=h.getTitleTipHtml(O.length>3?O.slice(0,3):O,"",u(),"");if(ah){if($("#sugtip_ULlist").length<=0){g.append(h.getTipIframe())}$("#sugtip_ULlist").append(ah+'<div class="topRecom" style="line-height:18px;padding-bottom:3px;padding-left:28px;border-bottom:1px solid #ddd;"><a id="clearHistoryO">'+message.ClearSearchHistory+"</a></div>");$("#clearHistoryO").mousedown(function(ai){m()})}}}function u(){var O=t.val().replace("\\","").replace(/(^\s*)|(\s*$)/g,"");O=O.toLowerCase();return O}function d(O){r(function(){j=1;var ag="";if(typeof top_Words_Json=="undefined"){return}if(Object.prototype.toString.call(top_Words_Json)=="[object Array]"){ag=top_Words_Json.join(";")}else{if(typeof top_Words_Json!="undefined"){if(top_Words_Json.Count!="0"){ag=top_Words_Json.sug}}}if(!ag){return}ag=F(ag);var ah=h.getTitleTipHtml(ag,"",u(),message.todayHot);if(ah){if($("#sugtip_ULlist").length<=0){g.append(h.getTipIframe())}$("#sugtip_ULlist").append(ah)}if(document.activeElement.id==B){e()}})}function i(O){if(O.preventDefault){O.preventDefault()}O.cancelBubble=true;return O.returnValue=false}function p(O){A();g.show();H=a;z=O}function S(O,ag,ah){if(ISIE){if(ag=="load"){O.onreadystatechange=function(){if(this.readyState=="loaded"){ah()}}}else{O.attachEvent("on"+ag,(function(ai){return function(){ah.call(ai)}})(O))}}else{O.addEventListener(ag,ah,false)}}function Z(){this.C;this.J=J;this.O=S;this.Load=function(ai,O,ag){if(!ai){return}var ah=document.getElementById(ag);if(ah){document.body.removeChild(ah)}this.C=J("SCRIPT");this.C.type="text/javascript";if(typeof ag=="string"&&ag.length>0){this.C.id=ag}else{this.C.id="callScriptE"}this.C.src=ai+"&td="+(new Date()).getTime();this.C.charset="utf-8";document.body.appendChild(this.C);S(this.C,"load",O)}}function Q(){var O=B.replace("value1","sel1").replace("value2","sel2");if($("#"+O).length<=0){O=B.replace("value1","sel").replace("value2","sel")}var ag=$("#"+O).find("option:selected").text();if(!ag||ag==undefined){a=Y()}else{a=ag}}function P(){y=$("#singleDB").val();if(!y){y=$("#dbPrefix").val()}}function Y(){if(B.indexOf("magazine_")==0){return"source"}if(B.indexOf("base")==0){return"base"}return""}function w(){ac=B;var O=$("#"+B).val().replace(/(^\s*)/g,"");var aj=a;var ag=ae;if(O==""){g.hide();return}O=O.replace(/\s+/g," ");var ah=O.lastIndexOf(" ");var ai="";f=O;if(ah>0){ai=O.substring(0,ah+1);if(ah==O.length-1){O=O.replace(/(^\s*)|(\s*$)/g,"");ah=O.lastIndexOf(" ");aj="GJGXC";ag=false}O=O.substring(ah+1,O.length)}A();T=-1;j=0;g.empty();var am=space1.getExData(O);if(am){ak(am)}else{var an=sugUrlComm.getURL(o,aj,O,(y?"&dbt="+y:"")+(!ag||ah>0?"":"&attr=1"));var al=new Z();al.Load(an,function(){var ao="";var ar="";if(typeof oJson!="undefined"){if(oJson&&Object.prototype.toString.call(oJson)=="[object Array]"){ao=oJson.join(";")}else{if(oJson.Count!="0"){try{ao=oJson.sug;ar=oJson.attr}catch(aq){}}}}if(ao!=null&&ao!=""&&$("#"+B).val().replace(/(^\s*)|(\s*$)/g,"")!=""){g.empty();var ap=h.createlist(ao,ai,u(),ar);space1.pushSpace(O,ap);ak(ap)}else{g.hide()}},"sugkewword_JS")}function ak(ao){if(ao){g.append(ao)}x().mousedown(function(ap){aa(this,ap)});if(document.activeElement.id==B){e()}}}function e(){g.show();if(L){var ag=$("#tipWordList");if(ag.length<=0){ag=$("#sugtip_ULlist ul").first()}var ah=ag.height();var O=0;$("#expandarea .dictmore").each(function(){O+=$(this).height()});if(O+20>ah){ag.height(O+20)}else{$("#expandarea .dictmore").height(ah-20)}}else{af()}}function R(ag,O){if(ag&&O){var ah=new RegExp("^"+O,"i");return ag.replace(ah,"")}return ag}function N(ah,O){var ag=ah;if(O&&ah.indexOf(O)==0){ag=O+"<strong>"+F(ah.substr(O.length))+"</strong>"}return ag}var h=(function(ai){this.CreateContentEle=function(am,ap,ao,aq,an){var ar="<"+am+" "+(ap?"id='"+ap+"'":"")+(ao?" class='"+ao+"'":"")+(an?an:"")+">";ar+=aq;ar+="</"+am+">";return ar};function ah(an,ar){var ao=an.toLowerCase().split(";");var am="";var ap=t.val().replace("\\","").replace(/(^\s*)|(\s*$)/g,"");ap=ap.toLowerCase();for(var aq=0;aq<ao.length;aq++){if(ao[aq]==null||ao[aq]==""){continue}am+=O(ao[aq],ap,G,ar);G++}return am}function O(at,an,ao,aq){var aw="";var ar=aq+aj(at);var am=RegExp("^"+an,"ig");var ax=al(N(ar,an),ao);var av=false;if(E){if(I(ar)){ax=F(ax)+"<i></i>";av=true}}var au="try {ge('btnSearch').click();} catch (e) {};";if(B.indexOf("buttom_")>=0||B.indexOf("sen_")>=0){au=""}var ap=R(ar,aq);aw="<div "+ag(av,ar,ap)+ak(av)+" onmousedown=\"$('#'+'"+B+"').val('"+b(F(ar))+"');"+au+"\"><span class='rw' id='rw"+ao.toString()+"'>"+ax+"</span></div>";return aw}function al(an,am){if(j==1){switch(am){case 0:return"<em class='num num1'>1</em>"+an;case 1:return"<em class='num num2'>2</em>"+an;case 2:return"<em class='num num3'>3</em>"+an}return"<em class='num'>"+(am+1).toString()+"</em>"+an}else{if(j==2){return"<em class='num numx'></em>"+an}}return an}function aj(am){var an="";if(SugExpand.MarkRegex.test(am)){an=am.match(SugExpand.MarkRegex)[0];am=F(am)}am=am.split(",")[0]+an;return am}function ag(ao,an,am){return' onmouseover="return tipDivOnMouseOverEvent(this,'+ao.toString()+",'"+an+"','"+am+"',event);\""}function ak(am){return' onmouseout="tipDivOnMouseOutEvent(this,'+am.toString()+',event);"'}this.CreateDiv=function(an,am,ao){return CreateContentEle("div",an,am,ao)};this.CreateUL=function(an,am,ao){return CreateContentEle("ul",an,am,ao)};this.CreateLI=function(ao,an,ap,am){return CreateContentEle("li",ao,an,ap,am)};this.createListLi=function(at,an,ao,aq,am){var av="";var ar=aq+aj(at);var aw=al(N(ar,an),am);var au=false;if(E){if(I(ar)){aw=F(aw)+"<i></i>";au=true}}else{aw=F(aw)}var ap=R(ar,aq);av=CreateLI("rw"+ao.toString(),"rw",aw,this.getLiEvent(au,ar,ap,B));return av};this.getLiEvent=function(ap,am,ao,an){return getLiMouseEvent(ap,am,ao,an,"")};this.getLiMouseEvent=function(ap,am,ao,an,aq){return ag(ap,am,ao)+ak(ap)};return{createlist:function(an,ar,am,ao,ap){G=0;var aq=CreateDiv("sugtip_list","dictlistX",this.getWordsC(an,ar,am,ao,ap));return aq},splitRemoveEmptyEntries:function(an){var aq=an.toLowerCase().split(";");var am=aq.length;var ap=new Array();for(var ao=0;ao<am;ao++){if(aq[ao]==null||aq[ao]==""){continue}ap.push(aq[ao])}return ap},getAttrC:function(ao,au,ay){var aw="";var ap="";if(ao&&au){var av=aj(F(ao));var az=N(av,ay);ap+=CreateLI("rw"+G.toString(),"rw1",az,getLiEvent(false,av,ar,B));var ar=R(av,"");var am=au.split("$$");var at=am[0].split(";");var aq=am[1].split(";");var an='<input type="hidden" name="inputvalue" value="'+F(ao)+'"/>';if(at.length==aq.length){for(var ax=0;ax<at.length;ax++){if(aq[ax]){G++;ap+=CreateLI("rw"+G.toString(),"rw2","在<b>"+aq[ax]+"</b>分类中检索"+an+'<input type="hidden" name="codevalue" value="'+at[ax]+'"/>',getLiMouseEvent(false,av,ar,B))}}}G++}if(ap){aw+=CreateDiv("Attr_Div","dictlistTop",CreateUL("","l",ap))}return aw},getTipWHtml:function(aq,ap,am){var ar=ap;if(Object.prototype.toString.call(ap)=="[object String]"){ar=this.splitRemoveEmptyEntries(ap)}var an="";for(var ao=0;ao<ar.length;ao++){an+=createListLi(ar[ao],aq,G,am,ao);G++}return an},getWordsC:function(au,ao,ar,av,ap){var am=this.splitRemoveEmptyEntries(au);var aq="";var at="";if(ap){at='<div class="topRecom" >'+ap+"</div>"}var an="";if(av){an=this.getAttrC(am[0],av,ar)}aq=this.getTipWHtml(ar,am,ao);return an+CreateDiv("sugtip_ULlist","dictlistCol clearfix",at+CreateUL("","",aq))},getTipIframe:function(){return CreateDiv("sugtip_list","dictlistX",CreateDiv("sugtip_ULlist","dictlistCol clearfix",""))},getTitleTipHtml:function(ar,ao,ap,aq){var an="";var am="";if(aq){am='<div class="topRecom" >'+aq+"</div>"}an=this.getTipWHtml(ap,ar,ao);return am+CreateUL("","",an)}}})(jQuery);function x(){return $("#Attr_Div li,#sugtip_ULlist > UL li",g)}function U(ak){var al=x();if(al.length==0){return}var O=function(){if(ak){T++}else{T--}};if(g.css("display")=="none"){g.css("display","")}else{O()}if(T>=al.length||T<0){al.removeClass("drop_selected");t.val(b(f));T=ak?-1:al.length;return}var aj=function(){var an=al.length;while(an--){if($(al[an]).attr("id")==("rw"+T.toString())){return $(al[an])}}return $(null)};$(al[T]).mouseout();var ah=aj();if(ah.length<=0){O();ah=aj()}var ai=ab(ah);if(!ai){var ag=""}var am=al.length-1;if(T<0){T=0}if(T>am){T=am}al.removeClass("drop_selected");$(al[T]).mouseover();t.val(b(ai));if(typeof C=="function"){C(ah)}}function ab(ai){if(ai){var ah=ai.find("em");var ag=ah.text();var O=ai.text();if(ag){return O.replace(new RegExp("^w*?"+ag,"g"),"")}else{var aj=ai.find("input[name='inputvalue']");if(aj.length>0){return aj.val()}}return O}return""}function b(O){O=O.replace("<strong>","").replace("</strong>","");O=O.replace(/\<i\>\<\/i\>/ig,"");if(O.indexOf("/")>=0){O=O.substring(0,O.indexOf("/"))}return O}function M(){if(T==-1){return}var O=x();var ag=$(O[T]);t.val(b(ag.text()))}function A(ah){var ai=t.offset();var ag=t.outerWidth();var O=t.outerHeight();g.css("top",ai.top+O);g.css("left",ai.left)}function af(){$("#sugtip_list").width(t.outerWidth()-2)}function F(O){return O.replace(SugExpand.MarkRegex,"")}function I(O){if(typeof O=="string"&&(O.indexOf("$")>=0||O.indexOf("#")>=0)){return true}return false}function aa(O,ag){k(O,ag)}function ad(O){return $(O).find("input[name='inputvalue']").length>0}function k(O,ag){var ah=ab($(O));$("#"+B).val(b(ah));if(ad(O)){X(O)}else{if(B.indexOf("buttom_")<0||B.indexOf("sen_")<0){try{if(typeof W.searchClick=="function"){W.searchClick()}else{$("#btnSearch").click()}}catch(ai){}}}}}function tipClass(a,b){if($("#tipWordList div").length>0){$("#tipWordList div").each(function(){$(this).removeClass(b)})}else{$("#sugtip_list li").each(function(){$(this).removeClass(b)})}$(a).addClass(b)}function tipDivOnMouseOverEvent(g,d,j,b,c){var h=function(){var e=$(g).attr("class");if(e.indexOf("drop_selected")>=0){return true}tipClass(g,"drop_selected");if(d){SugExpand.expendTR(j,b,g,sugPara.Expara||{})}else{$("#expandarea").hide()}};var f=window.event||c;var i=f.fromElement||f.relatedTarget;if(i){if(document.all){if(!(i==g||g.contains(i))){h()}}else{var a=g.compareDocumentPosition(i);if(!(i==g||a==20||a==0)){h()}}}else{h()}}function tipDivOnMouseOutEvent(d,b,a){var c=window.event||a;var g=c.toElement||c.relatedTarget;var i=document.getElementById("expandarea");var f=function(){tipClass(d,"");if(b){$("#expandarea").hide()}return false};var j=function(e){if((e&&e.id=="expandarea")||(i&&i.contains(e))){return true}if(!d.contains(e)){return f()}return true};var h=function(e){var k=function(m,n){if(n&&m){var l=n.compareDocumentPosition(m);if(!(l==20||l==0)){return true}}return false};if(!!(d&&d.nodeName&&d.nodeType==1)&&!!(e&&e.nodeName&&e.nodeType==1)){if(!k(e,i)){return true}if(k(e,d)){return f()}}};if(document.all){return j(g)}else{return h(g)}}var sugUrlComm=(function(){this.URLType={APP:0,SUG:1,EXPAND:2,TOP:3};this.getSugUrl=function(a,e,d,b){var c=b?b:"";return a+"/sug/su.ashx?action=getsmarttips&kw="+encodeURIComponent(d)+"&t="+encodeURIComponent(e)+c+"&p="+Math.random()},this.getAppUrl=function(a,e,d,b){var c=b?b:"";return a+"/Parts/Suggest/GetForJquery?source=kms&item="+encodeURIComponent(e)+"&text="+encodeURIComponent(d)+"&jsonvar=oJson"+c+"&p="+Math.random()};this.gUrlType=function(a,b){if(Object.prototype.toString.call(a)=="[object String]"){var c=/app\.cnki\.net/ig;if(c.test(a)){return URLType.APP}}return URLType.SUG};return{Server:"",getURL:function(a,g,d,b,c){var e=gUrlType(a);if(e==URLType.APP){this.getURL=getAppUrl}else{this.getURL=getSugUrl}return this.getURL(a,g,d,b)},getTopUrl:function(a,c){var b=c?c:"";return a+"/sug/topk.ashx?jsonvar=top_Words_Json"+b+"&v="+((new Date()).getTime())}}})();var SugExpand=(function(){this.getExpandData=function(b,c,a,f){var d=sugUrlComm.getURL(b,c,a,"&jsonvar=eoJson");var e=new CoreDomainLoadJson();e.Load(d,function(){if(typeof f=="function"){f()}},"sugExpandData_JS")};this.creatExpandarea=function(){$("#expandarea").remove();if($("#sugtip_ULlist").length>0){$("#__droplist #sugtip_ULlist").append("<div id='expandarea' name='expandarea' class='dictexpand' ></div>")}else{$("#__droplist").append("<div id='expandarea' name='expandarea' class='dictexpand' ></div>")}};return{MarkRegex:new RegExp("#([\\\d|,]*?)#$","i"),filterMark:function(a){return a.replace(SugExpand.MarkRegex,"")},expendTR:function(i,b,h,c){var e=h;creatExpandarea();var a=false;var f=$("#expandarea");function d(n){f.empty();if(typeof n!="string"){return}var m=g(n);if(m==""){f.hide();a=false;return false}n=n.replace(SugExpand.MarkRegex,"");var l=space2.getExData(n);if(l){j(n,m,l);f.show();a=true}else{getExpandData(sugUrlComm.Server,m,n,function(){if(typeof eoJson!="undefined"){space2.pushSpace(n,eoJson.sug);j(n,m,eoJson.sug);f.show();a=true}else{f.hide();a=false}})}return a}function g(l){if(SugExpand.MarkRegex.test(l)){return SugExpand.DICTCenter.getDICTKey(RegExp.$1)}return""}function j(m,l,o){if(o){f.empty();var n=new SugExpandTip(SugExpand.filterMark(m),o,l,1,c);f.append(n.getHtml());k();f.mousemove(function(){h.onmouseout=function(){}});f.mouseout(function(){h.onmouseout=e.onmouseout;return false})}}function k(){var m=$("#tipWordList");if(m.length<=0){m=$("#sugtip_ULlist ul").first()}var n=m.height();var l=0;$("#expandarea .dictmore").each(function(){l+=$(this).height()});if(l+20>n){m.height(l+20)}else{$("#expandarea .dictmore").height(n-20)}}d(b)},DICTCenter:(function(){this.DMap={A1:"CJFD_EX",A2:"CCND_EX",A3:"CMFD_EX",A4:"IMAGE_EX",A5:"CSYD_EX",A6:"CDFD_EX",A7:"CYFD_EX",A8:"CRFD_EX"};this.PriorityMap={A1:1,A2:2,A3:3,A4:3,A5:3,A6:6,A7:7,A8:8};this.getPri=function(a){return PriorityMap[a]};this.getDTArray=function(a){var b=a.split(",");for(var c=0;c<b.length;c++){b[c]="A"+b[c]}return b};return{getDICTKey:function(b){var c=getDTArray(b);var a=DMap[c[0]];if(a&&a!=undefined){return a}return""}}})()}})();function SugExpandTip(c,e,d,b,a){if(typeof a!="object"){this.ExpPara={}}else{this.ExpPara=a}this.CurData=e;this.DataType=d;this.CurDataHanlerFun=function(){};this.delGetHtml=function(){return""};this.CurSearchWord=c;this.MixTipCount=b||1;this.LinkArray={};this.PicServerHosts={};this.Init()}SugExpandTip.prototype.getHtml=function(){var a="";if(Object.prototype.toString.call(this.CurData)=="[object Array]"){for(var b=0;b<this.MixTipCount&&b<this.CurData.length;b++){a+=this.delGetHtml(this.CurData[b])}}else{a=this.delGetHtml(this.CurData)}return a};SugExpandTip.prototype.Init=function(){this.LinkArray={CJFD:(this.ExpPara.CJFDLinkS||"")+APPPATH+"/Navi?&DBCode=CJFQ&BaseID={0}",CMFD:(this.ExpPara.CMFDLinkS||"")+APPPATH+"/Navi?&DBCode=CMFD&BaseID={0}",CDFD:(this.ExpPara.CDFDLinkS||"")+APPPATH+"/Navi?&DBCode=CDFD&BaseID={0}",CCND:(this.ExpPara.CCNDLinkS||"")+APPPATH+"/Navi?&DBCode=CCND&BaseID={0}",CYFD:(this.ExpPara.CYFDLinkS||"")+APPPATH+"/Navi?&DBCode=CYFD&BaseID={0}",CRFD:(this.ExpPara.CRFDLinkS||"http://gongjushu-1cnki-1net-10097d65e0393.erf.sbb.spk-berlin.de")+"/refbook/{0}.html",CSYD:(this.ExpPara.CSYDLinkS||"javascript:void(0);"),IMAGE:(this.ExpPara.IMAGELinkS||"http://image-1cnki-1net-10097d65e0393.erf.sbb.spk-berlin.de")+"/detail.aspx?ref=kcms&id={0}"};this.PicServerHosts={CJFD:this.ExpPara.CJFDPicS||this.ExpPara.DefaultPicS||"/fengmian",CMFD:this.ExpPara.CMFDPicS||this.ExpPara.DefaultPicS||"/fengmian",CDFD:this.ExpPara.CDFDPicS||this.ExpPara.DefaultPicS||"/fengmian",CCND:this.ExpPara.CCNDPicS||this.ExpPara.DefaultPicS||"/fengmian",CYFD:this.ExpPara.CYFDPicS||this.ExpPara.DefaultPicS||"/fengmian",CRFD:this.ExpPara.CRFDPicS||"http://refbook-1img-1cnki-1net-10097d65e0393.erf.sbb.spk-berlin.de/",CSYD:this.ExpPara.CSYDPicS||this.ExpPara.DefaultPicS||"/fengmian",IMAGE:this.ExpPara.IMAGEPicS||"http://image-1cnki-1net-10097d65e0393.erf.sbb.spk-berlin.de"};this.HandlerFunMaps(this.DataType);this.CurData=this.CurDataHanlerFun(this.CurData)};SugExpandTip.prototype.HandlerFunMaps=function(a){switch(a){case"CSYD_EX":this.delGetHtml=this.ExpandHtmlMode.gCSYD;this.CurDataHanlerFun=this.InstanceDataHanler.CSYD;break;case"CJFD_EX":this.delGetHtml=this.ExpandHtmlMode.gCJFD;this.CurDataHanlerFun=this.InstanceDataHanler.CJFD;break;case"CCND_EX":this.delGetHtml=this.ExpandHtmlMode.gCCND;this.CurDataHanlerFun=this.InstanceDataHanler.CCND;break;case"CMFD_EX":this.delGetHtml=this.ExpandHtmlMode.gCDMD;this.CurDataHanlerFun=this.InstanceDataHanler.CMFD;break;case"CDFD_EX":this.delGetHtml=this.ExpandHtmlMode.gCDMD;this.CurDataHanlerFun=this.InstanceDataHanler.CDFD;break;case"IMAGE_EX":this.delGetHtml=this.ExpandHtmlMode.gIMAGE;this.CurDataHanlerFun=this.InstanceDataHanler.IMAGE;break;case"CYFD_EX":this.delGetHtml=this.ExpandHtmlMode.gCYFD;this.CurDataHanlerFun=this.InstanceDataHanler.CYFD;break;case"CRFD_EX":this.delGetHtml=this.ExpandHtmlMode.gCRFD;this.CurDataHanlerFun=this.InstanceDataHanler.CRFD;break}return function(b){return null}};SugExpandTip.prototype.getSplitDataArray=function(a){return a.split("$$")};SugExpandTip.prototype.InstanceDataHanler=(function(){this.getHref=function(a,b){if(b&&a){return a.replace(/\{\d\}/ig,b)}return""};this.getPicSRC=function(b,a){return b+a};return{CSYD:function(g){var b=g;var a=b.split("||");if(a&&a.length>0){var e=function(j,h){if(j){var i=j.substring(j.length-1);return h+"/suginfo/CSYD/"+i+"/"+j+".jpg"}return""};var f=new Array();for(var d=0;d<a.length;d++){var c=this.getSplitDataArray(a[d]);if(c.length==2){f.push({PICSRC:e(c[0],this.PicServerHosts.CSYD),HREF:getHref(this.LinkArray.CSYD,c[0]),AT:c[1]})}}return{TN:this.CurSearchWord,TT:"数据",HREF:getHref("http://tongji-1cnki-1net-10097d65e0393.erf.sbb.spk-berlin.de/kns55/Dig/DigResult.aspx?postZones=xj35%3B&postTar={0}&postYear=ra2000&areaSelType=xjSel&refersource=kdn",encodeURI(this.CurSearchWord)),IARR:f}}},IMAGE:function(f){var b=f;var a=b.split("||");if(a&&a.length>0){var e=new Array();for(var d=0;d<a.length;d++){var c=this.getSplitDataArray(a[d]);if(c.length==2){e.push({PICSRC:getPicSRC(this.PicServerHosts.IMAGE,"/getimage.ashx?id="+c[0]),HREF:getHref(this.LinkArray.IMAGE,c[0]),AT:c[1]})}}return{TN:this.CurSearchWord,TT:"图片",HREF:"//tra-1oversea-1cnki-1net-10097d65e0393.erf.sbb.spk-berlin.de/kns/RedirectPage.aspx?action=indexpage&code=IMAGE&korder=1&kw="+encodeURI(this.CurSearchWord),IARR:e}}},CJFD:function(e){var a=e.split("||");var d=new Array();for(var c=0;c<a.length;c++){var b=this.getSplitDataArray(a[c]);d[c]={ID:b[0],TN:b[1],TT:b[2],PicSrc:getPicSRC(this.PicServerHosts.CJFD,"/CJFD/small/"+b[0]+".jpg"),HREF:getHref(this.LinkArray.CJFD,b[0]),IARR:{ZB:b[3],ZQ:b[4],CBD:b[5],FYZ:b[6],ZYZ:b[7],TZ:[b[8].indexOf("T")>=0?"T":"",b[9]=="1"?"Y":""]}}}return d},CMFD:function(b){var a=this.getSplitDataArray(b);return{ID:a[0],TN:a[1],TT:a[7],PicSrc:getPicSRC(this.PicServerHosts.CMFD,"/cmfd/"+a[0]+".jpg"),HREF:getHref(this.LinkArray.CMFD,a[0]),IARR:{ZB:a[2],IS211:a[3],LC:a[4],SCF:a[5],SDF:a[6],FW:a[7]}}},CDFD:function(b){var a=this.getSplitDataArray(b);return{ID:a[0],TN:a[1],TT:a[7],PicSrc:getPicSRC(this.PicServerHosts.CDFD,"/cdfd/"+a[0]+".jpg"),HREF:getHref(this.LinkArray.CDFD,a[0]),IARR:{ZB:a[2],IS211:a[3],LC:a[4],SCF:a[5],SDF:a[6],FW:a[7]}}},CCND:function(b){var a=this.getSplitDataArray(b);return{ID:a[0],TN:a[1],TT:"",PicSrc:getPicSRC(this.PicServerHosts.CCND,"/ccnd/"+a[0]+".jpg"),HREF:getHref(this.LinkArray.CCND,a[0]),IARR:{ZB:a[2],ZG:a[3],CBD:a[4],ZQ:a[5],CN:a[6]}}},CYFD:function(b){var a=this.getSplitDataArray(b);if(a.length==8){return{ID:a[0],TN:a[1],TT:a[2],PicSrc:getPicSRC(this.PicServerHosts.CYFD,"/cyfd/"+a[7]+".jpg"),HREF:getHref(this.LinkArray.CYFD,a[0]),IARR:{YE:a[3],ISBN:a[4],ZB:a[5],PT:a[6]}}}return{}},CRFD:function(f){var b=f;var a=b.split("||");if(a&&a.length>0){var e=new Array();for(var d=0;d<a.length;d++){var c=this.getSplitDataArray(a[d]);if(c.length>=8){e.push({ID:c[0],TN:c[1],TT:c[2],PicSrc:getPicSRC(this.PicServerHosts.CRFD,c[7]),HREF:getHref(this.LinkArray.CRFD,c[0]),IARR:{ZR:c[3],ZB:c[4],ISBN:c[5],PT:c[6]}})}}return e}return[]}}})();SugExpandTip.prototype.ExpandHtmlMode=(function(){this.Template={dataImage:{TN:"草原",TT:"图片",IARR:[{PICSRC:"",HREF:"",AT:""},{PICSRC:"",HREF:"",AT:""}]},TITLE:'<h3><a target="_blank" href="<%[HREF]%>" onclick="<%[SCRIPT]%>"><b><%[TN]%></b><%[TT]%></a></h3>',Picture:'<div class="floatL"><img src="<%[PicSrc]%>" class="picbor" onerror="this.style.display=\'none\'" /></div>',APicture:'<div class="floatL"><a target="_blank" href="<%[HREF]%>" title="<%[TN]%>"><img src="<%[PicSrc]%>" class="picbor" onerror="this.style.display=\'none\'"/></a></div>',SpiteDivHT:'<div class="HT10"></div>',SpiteDivBD:' <div class="BD10"></div>',ShowMore:'<div class="botlink floatR"><%[MORE]%></div>',MoreLink:'<a href="javascript:void(0);">阅读全部<span class="arrow">&gt;&gt;</span></a>',ALink:'<a target="_blank" href="<%[ASRC]%>" title="<%[FTI]%>"><%[FTI]%></a>',LITemplet:"<li><label><%[TITLE]%></label><%[TC]%></li>",IMAGEDETAILLI:' <li><a target="_blank" href="<%[HREF]%>"><img src="<%[PICSRC]%>" onerror="this.style.display=\'none\'"/></a><p><a target="_blank" href="<%[HREF]%>" title="<%[AT]%>"><%[AT]%></a></p></li>',IMAGEDETAILLINOLINK:'<li><span><img src="<%[PICSRC]%>" onerror="this.style.display=\'none\'"/></span><p><span  title="<%[AT]%>"><%[AT]%></span></p></li>'};this.DataExplain={TN:"刊名|标题|学位授予单位",TT:"类型|英文刊名|学位",PICSRC:"图片地址",YI:"年期（2011年12期）",LC:"文献数",SCF:"总被引",SDF:"总下载",MORE:"更多链接",HREF:"标题链接"};this.gTitle=function(a){return this.Replace(this.Template.TITLE,a)};this.gPic=function(a){return this.Replace(this.Template.Picture,a)};this.gAPic=function(a){return this.Replace(this.Template.APicture,a)};this.gMore=function(a){return this.Replace(this.Template.MoreLink,a)};this.gALink=function(a){return this.Replace(this.Template.ALink,a)};this.gMixUL=function(e,b,c,f){var a="";var d=e.IARR;if(typeof f=="function"){handlFun=f}else{handlFun=function(){return""}}if(d){a='<ul class="infoList floatR">';a+=this.gMixLi(d,this.Template.LITemplet,b,c);a+=handlFun();a+="</ul>"}return a};this.gExMixHtml=function(d,a,b){var c='<div class="dictmore" >';c+=this.gTitle(d);if(b){c+=this.gAPic(d)}if(typeof a=="function"){c+=a();c+='<div class="HT10"></div>'}c+="</div>";return c};this.gMixLi=function(f,b,c,e){var d="";var g=c.length;if(g==e.length){for(var a=0;a<g;a++){var h=f[e[a]];if(h&&h!=undefined){d+=Replace(b,{TITLE:c[a],TC:h})}}}return d};this.gIMAGEMode=function(c,a){var b=a||Template.IMAGEDETAILLI;return gExMixHtml(c,function(){var f=c.IARR;if(f&&f.length>0){var d='<div class="detail"> <ul class="mode5">';var e=f.length;while(e--){d+=Replace(b,f[e])}d+="</ul></div>"}return d},false)};MIX=function(a){return this.Replace(this.Template.MIX,a)};TEXTLIST=function(a){return this.Replace(this.Template.TEXTLIST,a)};IMAGE=function(a){var b=this.H(a);return this.Replace(this.Template.IMAGE,a)};EMPTY=function(a){return""};getV=function(b,a){if(b){for(var c in b){if(c==a){return b[a]}}}return""};Replace=function(a,b){return a.replace(/\<\%\[(.*?)\]\%\>/g,function(c,d){return b[d]})};return{gCJFD:function(a){return gExMixHtml(a,function(){var c=["主办：","周期：","出版地：","复合影响因子：","综合影响因子："];var b=["ZB","ZQ","CBD","FYZ","ZYZ"];return gMixUL(a,c,b,function(){var e="";var d=a.IARR;if(d){var f=d.TZ;if(f&&f.lenth>0){e+="<li>";for(var h=0;h<f.length;h++){switch(f[h]){case"T":e+='<b class="cMarkTip Glod">独家授权</b>';break;case"P":e+='<b class="cMarkTip Silver">优先出版</b>';break}}e+="</li>"}}return e})},true)},gCSYD:function(a){return gIMAGEMode(a,Template.IMAGEDETAILLINOLINK)},gCCND:function(a){return gExMixHtml(a,function(){var c=["主办单位：","主管单位：","出版地：","周期：","国内统一刊号："];var b=["ZB","ZG","CBD","ZQ","CN"];return gMixUL(a,c,b,null)},true)},gCYFD:function(a){return gExMixHtml(a,function(){var c=["年鉴年份：","ISBN：","出版者：","出版日期："];var b=["YE","ISBN","ZB","PT"];return gMixUL(a,c,b,null)},true)},gCRFD:function(a){return gExMixHtml(a,function(){return gMixUL(a,["责任者：","出版者：","ISBN：","出版时间："],["ZR","ZB","ISBN","PT"],null)},true)},gIMAGE:function(a){return gIMAGEMode(a)},gCDMD:function(c){var a='<div class="dictmore" >';a+=gTitle(c);a+=gAPic(c);var e=["省份："];var d=["ZB"];a+=gMixUL(c,e,d,function(){var g="";var f=c.IARR;if(f){var h=f.IS211;if(h&&h=="1"){g+='<li><b class="colorG">211工程院校</b></li>'}}return g});a+='<div class="HT10"></div>';var b=c.IARR;if(b){a+=Replace('<div class="detail"><div class="mode3"><a href="javascript:void(0);">文献数<em><%[LC]%></em></a> <a href="javascript:void(0);">总被引<em><%[SCF]%></em></a><a href="javascript:void(0);">总下载<em><%[SDF]%></em></a></div></div>',b)}a+="</div>";return a}}})();function searchWordEvent(b,a){if(b&&a){$("input[id^=txt_],input[id^=buttom_],input[id^=au_],input[id^=base],input[id^=magazine_],input[id^=sen_]").val(a);if($("#"+b).length>0){$("#"+b).click()}else{}}return false}; 
 function CreateCacheSpace(a,c){var b=new CacheSpace(a,c);return b}function CacheSpace(a,b){if(!isNaN(a)){a=parseInt(a);if(a>0){a=a}}else{a=20}this.size=a;this.list=new Array();this.length=0;this.pointer=0;this.type=b}CacheSpace.prototype={find:function(a,c){var b=this.length;var d=this.defaultFind;if(typeof c=="function"){d=c}while(b--){if(d(this.list[b],a)){return b}}return -1},defaultFind:function(c,d){return c==d},enterSpace:function(a){if(typeof a!="undefined"){if(this.type==0){if(this.pointer>=this.size){this.pointer=0}this.list[this.pointer]=a;this.pointer++}else{if(this.pointer>=this.size){var b=this.list[0].time;var d=0;for(var c=1;c<this.size;c++){if(this.list[c].time<b){b=this.list[c].time;d=c}}this.list[d]=a}else{this.list[this.pointer]=a;this.pointer++}}if(this.length<this.size){this.length++}return true}return false},popSpace:function(){if(this.length>0){var a=this.list[this.pointer];this.list--;this.length--;return a}return null},clearSpace:function(){this.length=0;this.pointer=0},isEmpty:function(){if(this.length==0){return true}else{return false}}};CacheSpace.prototype.exfind=function(a){return this.find(a,function(b){return b.key==a})};CacheSpace.prototype.pushSpace=function(b,a){if(b&&a){this.enterSpace({key:b,value:a,time:1})}};CacheSpace.prototype.getExData=function(a){var b=this.getEle(a);if(b){b.time++;return b.value}return""};CacheSpace.prototype.getEle=function(a){var b=this.find(a,function(d,c){if(d){return d.key==c}return false});if(b>=0&&b<this.length){return this.list[b]}return null}; 
 (function(p){var n={Local:1,Session:2,Cookie:3};var e="";var o="FileNameS";function b(r){if(r){return r.replace(/[\(|\)|\+|\.|\*]/g,function(s){return"\\"+s})}return r}function h(r){if(!r||r.length<=0){return""}var t=r.split("!");if(t.length==4){return t[0]+"!"+t[1]}return""}function i(r,v){var t=new Array();var u=l();if(!u){return}var s=function(y,x,z){var w=new RegExp("!"+x+",","ig");y=y.replace(w,"!"+z+",");w=new RegExp("!"+x+"$","ig");y=y.replace(w,"!"+z);return y};u=s(u,r,v);a(o,u,e)}function l(r){if(window.localStorage){this.getFileNameS=function(s,u){var v="";if(u==n.Session){v=window.sessionStorage.getItem(s)}else{v=window.localStorage.getItem(s)}return v==null?"":v}}else{this.getFileNameS=function(s,t){return p.cookie(s)}}r=r?r:o;return this.getFileNameS(r,e)}function a(r,u,s){if(window.localStorage){this.setFileNameS=function(w,y,x){if(x==n.Session){window.sessionStorage.setItem(w,y)}else{window.localStorage.setItem(w,y)}}}else{this.setFileNameS=function(w,y,x){p.cookie(w,y)}}this.setFileNameS(r,u,s)}function k(r){var t=l();var s=h(r);if(s==""||t.indexOf(s)>-1){return false}if(t){r=t+","+r}a(o,r,e);return true}function c(v){var u=b;var x=function(A,z){var B=new RegExp(","+u(z)+",");A=(","+A+",").replace(B,",");while(A.length!=0){if(A.startWith(",")){A=A.substring(1)}if(A.endWith(",")){A=A.substring(0,A.length-1)}if(A.indexOf(",,")>-1){A=A.replace(",,",",")}if(!A.startWith(",")&&!A.endWith(",")&&A.indexOf(",,")==-1){break}}return A};var w=l();if(o=="FileNameS"&&(!w||w.length<=0)){p.searchinfoInit();p.filenameInit();return false}var y=h(v);if(y.length<=0){w=x(w,"");a(o,w,e);return false}y=u(y);var t=new RegExp(y+"[^,]*","ig");var s=w.match(t);if(s&&s.length>0){for(var r=0;r<s.length;r++){w=x(w,s[r])}a(o,w,e);return true}return false}function d(s){var r=l("SelectFileNameS");if(p(s).attr("name")=="CookieName"){r=r.replace(p(s).val(),"")}else{p("input:checkbox[name='CookieName']").each(function(){r=r.replace(p(this).val(),"")})}a("SelectFileNameS",r,e)}function j(r){if(p(r).prop("checked")){p("input:checkbox[name='CookieName']").each(function(){if(p.filenameCount()>=500){alert(message.most100);return false}if(!p(this).prop("checked")){if(document.cookie.length+p(this).val().length>4096){alert(message.updateBrowser);return false}var s=k(p(this).val());if(s){p(this).prop("checked",true)}}})}else{p("input:checkbox[name='CookieName']").each(function(){var s=c(p(this).val());if(s){p(this).removeAttr("checked")}})}}function m(){var r=true;var t=p("input:checkbox[name='CookieName']");if(!t||t.length==0){return false}var s=p(t[0]).prop("checked");if(s){p(t).each(function(){if(!p(this).prop("checked")){r=false;return false}});if(r){p("#selectCheckAll1").prop("checked",true)}else{p("#selectCheckAll1").prop("checked",false)}}else{p("#selectCheckAll1").removeAttr("checked")}}function q(){var r=l();r=r.replace(/cnki:/i,"");a(o,r,e);p("input:checkbox[name='CookieName']").each(function(){if(r&&r.indexOf(h(p(this).val()))>-1){p(this).prop("checked",true)}else{p(this).prop("checked",false)}});p("#selectCount,#anisys_select span").text(p.filenameCount());p("#batchOpsBox>li:eq(0)>span").text(message.selected+"（"+p.filenameCount()+"）");m()}function f(){var r=new Array();var u=l();if(!u){return r}var s=u.split(",");for(var v=0;v<s.length;v++){var t=s[v].split("!");if(t.length==4&&r.indexOf(t[3])==-1){r.push(t[3])}}return r}var g={saveKey:"SEARCHINFO",keyCollection:new Array(),valueCollection:new Array(),count:0,get:function(){return this.getCahce(this.saveKey,e)||p("#sqlVal").val()||""},init:function(){if(!this.isExistFileNames()){this.clear();return}var r=this.get();if(Object.prototype.toString.call(r)=="[object String]"&&r!=""){this.splitInfoStr(r);this.updataCount();this.save()}else{if(Object.prototype.toString.call(this.emptyCallBackFun)=="[object Function]"){this.emptyCallBackFun()}}},updataCount:function(){this.count=this.keyCollection.length},splitInfoStr:function(s){if(typeof s=="string"){var r=s.split(",");var t=r.length;if(t>0){while(t--){this.fillKV(r[t])}}}},fillKV:function(u){if(typeof u=="string"){var w=u.split("!");if(w.length!=3){return}var x=this.indexOfValue(w[1]+"!"+w[2]);if(x>-1){var s=parseInt(this.keyCollection[x]);this.keyCollection.splice(x,1);this.valueCollection.splice(x,1);this.keyCollection.push(w[0]);this.valueCollection.push(w[1]+"!"+w[2]);return}var r=this.indexOf(w[0]);if(r>=0&&w[2]){this.keyCollection[r]=w[0];this.valueCollection[r]=w[1]+"!"+w[2];return}this.keyCollection.push(w[0]);this.valueCollection.push(w[1]+"!"+w[2]);this.updataCount()}},indexOf:function(t,r){if(this.count>0){var s=this.count;while(s--){if(this.keyCollection[s]==t){return s}}}return -1},indexOfValue:function(r){if(this.count>0){var s=this.count;while(s--){if(r==this.valueCollection[s]){return s}}}return -1},isExist:function(r){if(this.indexOf(r)>=0){return true}return false},getV:function(s){var r=this.indexOf(s);if(r>=0){return this.valueCollection[r]}return""},addKV:function(w,u){var x=this.indexOfValue(u);if(x>-1){var s=parseInt(this.keyCollection[x]);this.keyCollection.splice(x,1);this.valueCollection.splice(x,1);this.keyCollection.push(w);this.valueCollection.push(u);this.save();return s}var r=this.indexOf(w);if(r>=0&&u){this.keyCollection[r]=w;this.valueCollection[r]=u}else{this.keyCollection.push(w);this.valueCollection.push(u)}this.updataCount();this.save();return""},getCahce:function(s,r){if(window.localStorage){if(r==n.Session){return window.sessionStorage.getItem(s)}else{return window.localStorage.getItem(s)}}else{return getCookie(s)}},remove:function(s){var r=this.indexOf(s);if(r>=0){this.keyCollection=this.deletArray(this.keyCollection,r);this.valueCollection=this.deletArray(this.valueCollection,r);this.updataCount();this.save()}},deletArray:function(r,s){return r.slice(0,s).concat(r.slice(++s))},save:function(r){var s=this.getStr();var u=this.saveKey;if(window.localStorage){if(r==n.Session){window.sessionStorage.setItem(u,s)}else{window.localStorage.setItem(u,s)}}else{setCookie(u,s,r)}},clear:function(){this.count=0;this.keyCollection=new Array();this.valueCollection=new Array();this.save()},isExistFileNames:function(){var r=l();if(!r){return false}return true},getStr:function(){var s=this.count;var r="";while(s--){if(this.keyCollection[s]&&this.valueCollection[s]){r+="{0}!{1},".format(this.keyCollection[s],this.valueCollection[s])}}if(r.length>0){r=r.substring(0,r.length-1)}return r},emptyCallBackFun:function(){}};p.fn.filenameClick=function(){g.init();var r=p(this).attr("name")=="CookieName"?p(this).val():p("input[name='CookieName']")[0].value;var w=r.substring(r.lastIndexOf("!")+1);if(p(this).prop("checked")){if(p(this).attr("name")=="CookieName"){if(p.filenameCount()>=500){alert(message.most100);p(this).prop("checked",false);return false}k(p(this).val());m()}else{j(this)}}else{if(p(this).attr("name")=="CookieName"){c(p(this).val());m()}else{j(this)}var u=f();if(u.length==0){g.clear()}else{if(u.indexOf(w)==-1){g.remove(w)}}d(this)}var v=GetQueryStringByName(window.location.href,"dbcode")||"SCDB";if(p("#sqlVal").val()){var s=g.addKV(w,v+"!"+p("#sqlVal").val());if(typeof(s)=="number"){i(s,w)}}q();p("#selectCount,#anisys_select span").text(p.filenameCount());p("#batchOpsBox>li:eq(0)>span").text(message.selected+"("+p.filenameCount()+")")};p.fn.filenameSelect=function(){o="SelectFileNameS";if(p(this).prop("checked")){if(p(this).attr("name")=="CookieName"){if(p.filenameCount()>=500){alert(message.most100);return false}k(p(this).val());m()}else{j(this)}}else{if(p(this).attr("name")=="CookieName"){c(p(this).val());m()}else{j(this)}}q()};p.fn.filenameDel=function(){var r=o;o="FileNameS";if(p(this).attr("name")=="CookieName"){c(p(this).val())}else{p("input:checkbox[name='CookieName']:checked").each(function(){c(p(this).val())})}o=r;if(p(this).attr("name")=="CookieName"){c(p(this).val())}else{p("input:checkbox[name='CookieName']:checked").each(function(){c(p(this).val())})}};p.filenameClear=function(){o="SelectFileNameS";a(o,"");o="FileNameS";a(o,"");q();p.searchinfoInit()};p.filenameGet=function(){return l()};p.filenameCount=function(){var r=l();var s=r?r.split(","):new Array();return s?s.length:0};p.searchinfoGet=function(){return g.get()};p.searchinfoInit=function(){g.init()};p.filenameInit=function(){o="FileNameS";q()};p.filenameSelectInit=function(){o="SelectFileNameS";q()};p.filenameSelectGet=function(){return l("SelectFileNameS")}})(jQuery);$.BrowserTab(function(){var a=/(manage(.html)|manage(.html)?[\?|\#].*)$/i;if(!a.test(window.location.href)){$.filenameInit()}else{}});if(document.attachEvent){window.attachEvent("storage",function(){window.localStorage.getItem("FileNameS")})}else{if(document.addEventListener){window.addEventListener("storage",function(){window.localStorage.getItem("FileNameS")})}}function initTable(){var d=$("#manage-table tbody tr");var c=1,b=0;$(d).each(function(){if($(this).find("td").length==1){c=1;return true}$(this).find("td.seq em").click(function(){$(this).parent().find("input[type='checkbox']").click()});$(this).find("td.seq em").text(c);c++;b++});$("#batchOpsBox em").text(b);var a=0;$.each($(".manage-table").find('input[name="CookieName"]:checked'),function(){a++});$("#batchOpsBox>li:eq(0)>span").text(message.selected+"（"+a+"）");$("#anisys_select span").text(a);$(d).find(".condition").each(function(){if($(this).parent().next().find("td").length<=1){$(this).parent().remove()}})}; 
 $(function(){function a(){this.topDocType=$(".top-doctype");this.btnAll=this.topDocType.find(".all");this.docTypeMenus=$(".doctype-menus:not(.is-hide)");this.btnMoreMenus=$(".btn-crossDb-search");this.btnAllFunc();this.switchChEn();this.MoreMenus();this.LoadCustomeDBlist()}a.prototype={MoreMenus:function(){var b=this;b.btnMoreMenus.on("click",function(){if(b.topDocType.hasClass("is-down")){b.topDocType.animate({height:"75px"},100,function(){$(this).removeClass("is-down")})}else{b.topDocType.addClass("is-down").animate({height:"170px"},200)}})},singledbClickFunc:function(h){var e=this;e.btnAll.parent().removeClass("cur");e._resultRCountShowHide("show");var j=$(h).attr("data-lang");var i=$(h).attr("dbcode");if(i){i.indexOf("GXDB")>-1?$("#txt_search").attr("placeholder",""):$("#txt_search").attr("placeholder",message.placehold1)}if($(h).parent().hasClass("all-box")){$(h).parent().addClass("cur");$("ul.doctype-menus>li").removeClass("cur");$(".switch-ChEn").removeClass("is-hidden")}else{if($(h).closest("ul").hasClass("doctype-menus")){var f=$(h).parent();e._isShowChEn(j);var b=$("#dbcode").val();if(dblist.IsZKcode(b)||dblist.IsSingleENCHCode(b)||$("#isscdb").val()=="1"){}else{$(".switch-ChEn a").removeClass("cur")}if(!f.hasClass("is-bottom")){f.addClass("cur").siblings("li").removeClass("cur")}else{e._replaceLast(f)}}else{$(h).parent().addClass("is-hide").siblings().removeClass("is-hide");var g=$(h).attr("href"),c=$(h).html(),d=$(h).closest(".haschild");e._isShowChEn(j);d.addClass("cur").siblings().removeClass("cur");d.find(">a").html(c).attr("href",g).attr("dbcode",i).attr("data-lang",dblist.GetLangCode(i,"en"));if(d.hasClass("is-bottom")){e._replaceLast(d)}}}e._doctypeBottomHide(h)},btnAllFunc:function(){var b=this;b.btnAll.on("click",function(){dblist.SetZKbtnState(this)})},SetZKbtnState:function(d){var b=$(d).attr("dbcode");var c=$("#dbcode").val();if((c&&dblist.IsSingleENCHCode(c))||$("#isscdb").val()=="1"){}else{$(".switch-ChEn a").removeClass("cur")}if(dblist.IsZKenCHCode(c)&&dblist.isSCDB(b)){$(".switch-ChEn a").removeClass("cur")}dblist._resultRCountShowHide("hide");dblist._isShowChEn(1);$(".doctype-menus").find("li").removeClass("cur");$(d).parent().addClass("cur");dblist._doctypeBottomHide(d)},switchChEn:function(){var b=this;function c(){var d=$(".search-classify-menu li.active").attr("name");if(d!="sentenceSearch"){return true}var e=0;$.each($(".inputs-list-sentence").find("dd"),function(){var g=$.trim($(this).find(":text:eq(0)").val());var f=$.trim($(this).find(":text:eq(1)").val());if(!!g&&!!f){e++}});if($(".inputs-list-sentence").length>0&&e==0){layer.alert(message.SentenceMessage,{btn:message.Confirm,title:message.info});return false}return true}$(".switch-ChEn").find(">a").click(function(){$(this).addClass("cur").siblings().removeClass("cur");var e=b.GetLangCode($("#dbcode").val(),$(this).hasClass("en")?"en":"ch");if(!e){return}if(!!SearchQueryState.View){if(e.toUpperCase()=="CFLQ"){cnkiSearch.setDbView("中国学术期刊网络出版总库综合")}else{if(e.toUpperCase()=="WWJD"){cnkiSearch.setDbView("WWJD")}else{cnkiSearch.setDbView("")}}}$("#dbcode").val(e);b._doctypeBottomHide(this);var f=window.location.href;if($.isInAdvancePage(f)){var g=$("#gridTable").html();if(!g){return}if(!c()){return}}else{}if(cnkiSearch){cnkiSearch.setDbCode(e);if(dblist.IsZKcode(e)){var d=$("#CheckedDB").val();cnkiSearch.setKuaKuCode(d)}else{cnkiSearch.setKuaKuCode("")}loadResultSetAndGroups()}})},_isShowChEn:function(b){var d=$(".switch-ChEn"),c="is-hidden";if(b){d.removeClass(c)}else{d.addClass(c)}},_resultRCountShowHide:function(b){if(b=="show"){$("#count").show()}else{if(b=="hide"){$("#count").hide()}}},_doctypeBottomHide:function(b){parentBox=$(b).closest(".top-doctype");if(parentBox.hasClass("is-down")){parentBox.animate({height:"75px"},100,function(){$(this).removeClass("is-down")})}},_replaceLast:function(f){var d=f.html();var e=f.attr("data-id");var c=$(f).siblings(".is-last");var b=f.hasClass("haschild")?"haschild ":"";c.attr("data-id",e).addClass(b+"cur").html(d).siblings("li").removeClass("cur");f.addClass("is-hide").siblings(".is-bottom").removeClass("is-hide")},CrossLangDBs:function(){var b={a:{code:"SCDB",en:"WWDB",ch:"CFLS"},b:{code:"CJFQ",en:"WWJD",ch:"CFLQ"},c:{code:"CIPD",en:"WWPD",ch:"CFLP"},};return b},GetLangCode:function(c,b){if(!c){c="SCDB"}c=c.toUpperCase();var e=this.CrossLangDBs();for(var d in e){if(e[d].code.indexOf(c)>-1||e[d].ch.indexOf(c)>-1||e[d].en.indexOf(c)>-1){return e[d][b]}}return""},GetLang:function(b,c){c=c.toUpperCase();var e=this.CrossLangDBs();for(var d in e){if(e[d].code.indexOf(b)>-1&&e[d].ch.indexOf(c)>-1){return"ch"}else{if(e[d].code.indexOf(b)>-1&&e[d].en.indexOf(c)>-1){return"en"}}}return""},GetLangTotalDBcode:function(b){var d=this.CrossLangDBs();for(var c in d){if(d[c].ch.indexOf(b)>-1||d[c].en.indexOf(b)>-1){return d[c].code}}return b},GetSearchClickDBcode:function(){var b=$("#dbcode").val();var c=dblist.GetLangTotalDBcode(b);$("#dbcode").val(c);$(".switch-ChEn a").removeClass("cur");return c},IsZKcode:function(b){return/SCDB|CFLS|WWDB/i.test(b)},changeSearchSetState:function(b){if(dblist.isSCDB(b)){$("#searchset").show()}else{$("#searchset").hide()}},isSCDB:function(b){return/scdb/i.test(b)},IsENCHcode:function(b){return/WWDB|CFLS|WWJD|CFLQ|WWPD|CFLP/i.test(b)},IsSingleENCHCode:function(b){return/WWJD|CFLQ|WWPD|CFLP/i.test(b)},IsZKenCHCode:function(b){return/CFLS|WWDB/i.test(b)},IsInCrooseDB:function(e){if(this.isSCDB(e)){return true}var d=$("#CheckedDB").val();if(!d){return false}var f=d.indexOf(e);if(f<0){var b=this.docTypeMenus.find("ul").find("a[dbcode="+e+"]").attr("prcode");if(d.indexOf(b)>-1){return true}var c=this.GetLangTotalDBcode(e);if(d.indexOf(c)>-1){return true}if(dblist.isSCDB(c)){return true}}else{return true}return false},SwapDblist:function(d){var c=sessionCookieUnit.getCookie("showlist");var b=sessionCookieUnit.getCookie("personsets");if(!dblist.isSCDB($("#dbcode").val())||c||b){return}if(d==0){$(".doctype-menus.keji").removeClass("is-hide").show();$(".doctype-menus.sheke").addClass("is-hide")}else{if(d=1){$(".doctype-menus.keji").addClass("is-hide");$(".doctype-menus.sheke").removeClass("is-hide").show()}else{$(".doctype-menus.keji").removeClass("is-hide").show();$(".doctype-menus.sheke").addClass("is-hide")}}},LoadCustomeDBlist:function(){var c=this;var h=sessionCookieUnit.getCookie("showlist"),b="",k=0,f;var j=this.getAllDBlist(c.docTypeMenus);var d=GEetUInfoFromECP("utype");if(islogin()&&d=="jf"){var g=getPersonSets(1);if(g&&g.indexOf(";")>0){var e=g.split(";");h=e[0];f=e.pop()}}if(h){var i=h.split(",");f=i.pop();if(!/^\d+$/g.test(f)){i.push(f)}h=i.join(",")}if(h&&j.length>0){var i=h.split(",");i.forEach(function(l){var n=c.docTypeMenus.find("li:not(.is-hide)>a[dbcode="+l+"]");if(n.length>0){b+=c._getNewDBlistsHtml(n,k++)}var m=j.indexOf(l);j.splice(m,1)});j.forEach(function(l){var m=c.docTypeMenus.find("li:not(.is-hide)>a[dbcode="+l+"]");b+=c._getNewDBlistsHtml(m,k++)});c.docTypeMenus.html(b)}this.setCheckedDB(h,f)},setCheckedDB:function(c,f){var d=$("#CheckedDB").val(),b;var g=$("#CheckedDB").attr("data-htime")||0;if(!f||f-g<0){b=d}else{b=c}if(b){$("#CheckedDB").val(b)}else{var e=$("#kuakucode").val();if(e){$("#CheckedDB").val(e)}else{$("#CheckedDB").val("CJFQ,CCND,CIPD,CDMD,BDZK,CISD,SNAD,CCJD,GXDB_SECTION,CJFN,CCVD")}}},getAllDBlist:function(b){var c=[];if(!b||b.length==0){return[]}b.children().each(function(d,f){var g=$(f).children().first().attr("dbcode");if($.inArray(g,c)<0){c.push(g)}});return c},_getNewDBlistsHtml:function(f,c){var e,b="",d=8;e=f.parent();e.removeClass("is-last");e.removeClass("is-bottom");if(e.length>1){}e.removeClass("is-hide");if(c<d){e.removeAttr("id");b+=e[0].outerHTML}else{if(c==d){e.addClass("is-last");b+=e[0].outerHTML;e.removeClass("is-last");e.addClass("is-bottom");e.addClass("is-hide");e.removeAttr("id");b+=e[0].outerHTML}else{e.addClass("is-bottom");b+=e[0].outerHTML}}return b},};window.dblist=new a()});$(function(){$.placeholderFunc();$.dbChange();$.initDbcode();$.collect();$.bindSearchConditionTitle()});(function(a){a.extend({isSupportPlaceholder:function(){var c=document.createElement("input");return"placeholder" in c},placeholderFunc:function(){if(!a.isSupportPlaceholder()){a("input").not("input[type='password'],input[type='button']").not("input[type='hidden']").each(function(){var d=a(this);var e=d.attr("placeholder");if(e&&(d.attr("value")==""||d.attr("value")==undefined)){c(d,e)}})}function c(f,e){if(a(this).is(":hidden")){return}var d=f;var e=a.trim(e);d.attr({value:e,style:"color:#999"}).addClass("noplaceholder");d.focus(function(){if(a.trim(d.val())==e){a(this).attr({value:"",style:"color:#333"})}}).blur(function(){if(d.val()==""){a(this).attr({value:e,style:"color:#999"})}})}},isInAdvancePage:function(c){if(/AdvSearch/i.test(c)){return true}if(/Rss/i.test(c)){return true}return false},dbChange:function(){function e(f){if(/SearchHelper/i.test(f)){return true}return false}function d(h){var f=a("#dbcode").val();if(dblist.IsZKcode(f)){a("#isscdb").val(1)}a("#fakediv").remove();var g=a(h).find("em").text();if(!dblist.isSCDB(f)&&g&&g==0){a("#briefBox").html("");a("#divGroup").html("");a(".relevant").hide();if(a("#fakediv").length==0){a("#briefBox").append('<p class="no-content" id="fakediv"> 抱歉，暂无数据，可尝试更换检索词。</p>')}return true}else{a(".relevant").show()}return false}var c=a(".top-doctype");c.on("click","a[name='dbcode']",function(){a("#blankse").val("");var i=a(this).attr("dbcode"),j;dblist.changeSearchSetState(i);if(!ValidDbcode(i)){a.redirectDBPage(a(this).attr("href"));return}dblist.singledbClickFunc(this);a.each(["en","ch"],function(l,k){if(a(".switch-ChEn .cur").hasClass(k)){j=dblist.GetLangCode(i,k);if(!!j){i=j}}});a("#dbcode").val(i);sessionCookieUnit.unset("knsLeftGroupSelectItem");var h=window.location.href;if(e(h)){window.location.href=APPPATH+"/AdvSearch?dbcode="+i}if(a.isInAdvancePage(h)){var g=a("#CheckedDB").val();a(".search-classify-menu li[name='changeDb']").click();var f=a("#isscdb").val()=="1";if(f&&a("#briefBox:visible").length>0&&dblist.IsInCrooseDB(i)){if(d(this)){return}cnkiSearch.setDbCode(i);if(dblist.IsZKcode(i)){cnkiSearch.setKuaKuCode(g)}else{cnkiSearch.setKuaKuCode("")}cnkiSearch.delQueryNode(cnkiSearch.GroupName.MutiGroup);loadResultSetAndGroups()}else{a(".icon-arrow-filter").hide();sessionCookieUnit.unset("knsLeftGroupSelectItem");a("#divGroup").empty();a(".result-con-l").hide();a("#briefBox").empty();a(".rlv-word").empty();a(".rlv-expert").empty();cnkiSearch.resetSearchQueryState()}}else{if(typeof searchBar!="undefined"){searchBar.LoadSearchFields(i,0,searchBarUI.DbClickEvent,d(this))}}if(dblist.IsZKcode(i)){a("#isscdb").val(1)}if(typeof relevant!="undefined"){relevant.loadRelevantTroggle()}if(typeof(_rss)=="object"){_rss.init()}})},initDbcode:function(){var e=GetQueryStringByName("dbcode");e=e.replace(/[\s*#]$/i,"");if(!e){e=a("#dbcode").val()}if(!ValidDbcode(e)){e="SCDB"}if(!e){e="SCDB"}a("#dbcode").val(e);if(dblist.IsZKcode(e)){a("#isscdb").val(1);a("#searchset").show()}if(a(".top-doctype").length==0){return}if(dblist.IsENCHcode(e)){var d=dblist.GetLangCode(e,"code");a.alldbclick(d);var c=dblist.GetLang(d,e);a(".switch-ChEn").find("."+c).addClass("cur")}else{a.alldbclick(e)}},alldbclick:function(c){c=c.toUpperCase();if(dblist.isSCDB(c)){dblist.SetZKbtnState(dblist.btnAll)}else{dblist.singledbClickFunc(dblist.docTypeMenus.find("li:not(.is-hide)>a[name='dbcode'][dbcode='"+c+"']"))}},redirectDBPage:function(d){if(d){var c=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/;if(c.test(d)){window.location.href=d}}},collect:function(){a("body").off("click",".btn-collect").on("click",".btn-collect",function(){a(this).find("i.icon-collect").click()});a("body").off("click",".icon-collect").on("click",".icon-collect",function(e){var c=a("#KPCAPIPATH").val();var i=this;var g=a(this).attr("data-dbname");var f=a(this).attr("data-filename");if(!!f==false||!!g==false){return}var h=b.RecSysAPI.getRecSysUserOpeData();var d=b.RecSysAPI.getRecSysAPIURL()+"/api/UserDataCenter/CollectFile?idenID="+h.idenID+"&clientID="+h.clientID+"&userIP="+h.userIP+"&productID="+g+"&fileID="+f+"&platformURL="+h.platformURL;if(!a(this).hasClass("hascollected")){a.when(a.ajax({url:d+"&operateType=add",type:"POST"})).then(function(j){if(j.Success&&j.Data==1){a(i).attr("data-fileId",j.Data);a(i).toggleClass("hascollected");a(i).parent().toggleClass("hascollected");a(i).attr("title",message.Collected);a(i).find("b").html(message.Collected);layer.msg(message.Collected)}else{layer.msg(message.CollectFail)}},function(j){layer.msg(layer.msg(message.CollectFail))})}else{a.when(a.ajax({url:d+"&operateType=delete",type:"POST"})).then(function(j){if(j.Success&&j.Data==1){a(i).toggleClass("hascollected");a(i).parent().toggleClass("hascollected");a(i).attr("title",message.Collect);a(i).find("b").html(message.Collect);layer.msg(message.CancelCollect)}else{layer.msg("Fail!")}},function(j){layer.msg("Fail!")})}})},splitFieldValue:function(c,d){var e=a("#selectfield").siblings("span").text();var g=c;var f="=";var i=d;if(c&&c.indexOf("$")>=0){f=c.split("$")[1];g=c.split("$")[0];if(f.indexOf("|")>=0){var j=f;var h=j.split("|")[1];f=j.split("|")[0]}}return{Title:e,Name:g,Value:i,Operate:f,BlurType:h}},removeWildcard:function(g,c){if(c.indexOf("?")<-1||c.indexOf("*")<-1){return c}var i=c;var d=a(".search-main .sort-list li[value='"+g+"']").children("a").attr("value");if(d&&d.indexOf("$")>=0){var e=d.split("$")[1];var g=d.split("$")[0];if(e.indexOf("|")>=0){var h=e;var f=h.split("|")[1];e=h.split("|")[0];switch(f){case"?":i=c.replace(/\?$/i,"");break;case"??":i=c.replace(/^\?/i,"");break;case"*":i=c.replace(/\*$/i,"");break;case"**":i=c.replace(/^\*/i,"");break;default:break}}}return i},showSearchCondition:function(c){var i=[];var h=[];if(!c){return}var f="";var e=function(){var k=window.url;return/AdvSearch/i.test(k)};var g=function(k){if(e){return((/.*data-tipid=.*/i).test(k)||k=="ddx"||k=="sentence")}else{return true}};var j=function(o){if(o){var m=o.Key;if(!g(m)){return}if(m=="sentence"){var l=o.ExtendType=="5"?message.SameSentence:o.ExtendType=="4"?message.SameParagraph:"";if(!l){return}else{var p=o.Value,n=o.Value2;var k=o.Logic==0?"":Object.keys(cnkiSearch.Logic)[o.Logic];if(!f){k=""}f+=k+"（"+l+"："+p+"、"+n+"）"}}else{if(i.indexOf(m)>-1){return}else{i.push(m)}var l=o.Title,q=o.Value;var k=o.Logic==0?"":Object.keys(cnkiSearch.Logic)[o.Logic];if(l&&q){q=a.removeWildcard(o.Name,q);if(!f){k=""}f+=k+"（"+l+"："+q+"）"}}}};var d=function(l){if(!l){return}for(var m=0;m<l.length;m++){var k=false;var n=l[m];if(!n){continue}if(n.Items){n.Items.forEach(function(r){var q=n.Key;if(k||!g(q)){return}if(h.indexOf(q)>-1){return}else{h.push(q)}var p=r.Title,t=r.Value;var o=n.Logic==0?"AND":Object.keys(cnkiSearch.Logic)[n.Logic];if(p&&t){var s=n.Title;t=a.removeWildcard(n.Name,t);if(!f){o=""}f+=o+"（"+s+"："+p+"）"}k=true})}if(k){continue}d(n.ChildItems)}};if(c.Items){c.Items.forEach(j)}d(c.ChildItems);return f},searchConditionWords:function(c,e,d){a(".result-con-l a.tiphide").hide();if(a("#isscdb").val()=="1"&&!dblist.IsZKcode(a("#dbcode").val())&&!e){return}if(!a(".search-main .search-input").val().trim()){a(".conditions").html("");return}var g=a(".search-main .sort span").text()+"："+a.trim(a(".search-main .search-input").val());if(c){if(d){a(".conditions a").last().remove()}a(".conditions").append("<a><i>></i>"+g+"</a>")}else{a(".conditions").html("<a><i>></i>"+g+"</a>")}var i=a(".conditions a").length;if(i>1){a(".result-con-l a.tiphide").show()}var f=a(".search-main .search-input");var h={};h.text=f.val();h.searchword=f.attr("searchword");h.authorcode=f.attr("data-authorcode");h.dfield=f.attr("data-field");h.authorunit=f.attr("data-authorunit");h.checkedcode=f.attr("data-checkedcode");window.conditions[i]=h},isDefaultResult:function(){var c=window.location.href;if(c.toLowerCase().indexOf("defaultresult")>0){return true}return false},bindSearchConditionTitle:function(){a("span.conditions").mouseenter(function(f){var d=parseInt(a(this).css("max-width")),g,c;if(a(this).width()<d){return}this.myTitle=a(this).html();if(this.myTitle==undefined||this.myTitle==""){return}a("<div id='tooltip'  style='pointer-events: none;width:"+parseInt(d+20)+"px'>"+this.myTitle+"</div>").appendTo("body");g=a(this).offset().left-10;c=a(this).offset().top+35;a("#tooltip").css({top:c+"px",left:g+"px"}).show("fast")}).mouseleave(function(){a("#tooltip").remove()})},});var b=function(){};_virtualPath=null;b.getVirtualPath=function(){if(!_virtualPath){_virtualPath=a("#hidVirtualPath").val()}return _virtualPath};b.RecSysAPI=(function(){function d(j,l){var k="expires="+new Date(Date.now()+365*24*60*60*1000);document.cookie=j+"="+escape(l)+"; "+k+"; path=/; domain=cnki.net"}function c(){var j=getValueFromCookie("c_m_LinID");if(void 0===j||""===j||"null"===j||null===j){return""}else{var m=j.indexOf("="),l=j.lastIndexOf("&"),k=j.substring(m+1,l);return k}}function i(k){var j="-1";a.ajax({type:"GET",async:false,url:k,success:function(l){if(l.Success){j=l.Data}else{alert(l.Message)}},error:function(l,m,n){console.log(m)}});return j}function g(){var j=b.RecSysAPI.getRecSysAPIURL()+"/api/UtilityOpenApi/GenerateClientID";return i(j)}function f(){var j=getValueFromCookie("Ecp_ClientId");if(j==undefined||j==""||j==null||j=="null"){j=g();d("Ecp_ClientId",j);window.localStorage.setItem("clientId_mycnkiWap",j)}else{window.localStorage.setItem("clientId_nzxpt",j)}return j}function h(){var j=b.RecSysAPI.getRecSysAPIURL()+"/api/UtilityOpenApi/GetUserIP";return i(j)}function e(){var j=getValueFromCookie("Ecp_ClientIp");if(!j||j=="-1"){j=h();d("Ecp_ClientIp",j);localStorage.setItem("userIp_nzxpt",j)}return j}return{getRecSysUserOpeData:function(){return{idenID:c(),clientID:f(),userIP:e(),platformURL:window.location.href+"@KNS8",operateType:"",productID:"",fileID:""}},getRecSysAPIURL:function(){var j=a("#RecSysAPI").val();if(!!j==false){j="https://recsys-1cnki-1net-10097d65e0393.erf.sbb.spk-berlin.de/RCDService"}else{j=j.replace("/api/RecSysOpenApi/","")}j=j.replace("RCDServiceBeta","RCDService");return j}}})(jQuery);b.isCollection=function(e){var d=b.RecSysAPI.getRecSysUserOpeData();var c="";a.each(e,function(){var f=a(this).attr("href");c=c+GetQueryStringByName(f,"filename")+";"});a.when(a.ajax({url:b.RecSysAPI.getRecSysAPIURL()+"/api/UserDataCenter/IsCollectFile?idenID="+d.idenID+"&clientID="+d.clientID+"&userIP="+d.userIP+"&fileIDs="+encodeURI(c)+"&platformURL="+d.platformURL,type:"GET"})).then(function(f){if(f&&f.Success){if(f.Data&&f.Data.length>0){a.each(f.Data,function(){var g=this;if(g){a("[data-filename='"+g+"'].icon-collect").toggleClass("hascollected");a("[data-filename='"+g+"'].icon-collect").parent().toggleClass("hascollected");a("[data-filename='"+g+"'].icon-collect").find("b").text(message.Collected)}})}}else{}},function(f){})};b.isIE9=function(){var d=typeof window!=="undefined";var e=d&&window.navigator.userAgent.toLowerCase();var c=e&&/msie|trident/.test(e);return isIE9=e&&e.indexOf("msie 9.0")>0};window.KNS=b})(jQuery);function testsql(){if(!!window.ActiveXObject||"ActiveXObject" in window){return}var a=cnkiSearch.getSearchJsonInfo();console.log(a);$.ajax({url:APPPATH+"/DefaultResult/Query",type:"POST",data:{queryJson:a},success:function(b){console.log(b)}})}function loadResultSetAndGroups(){$("div.result-con-l").show();var a=$("#isscdb").val();if(a=="0"){$(".range").html("<b>"+$(".doctype-menus:not(.is-hide)").children("li.cur").children("a").find("span").text()+"</b>")}else{$(".range").html(message.zk)}$.BriefExtend.searchCallBackFun(true);getGroupResult()}(function(a){a.fn.extend({showLoading:function(){this.hideLoading(a(this));a(this).append("<div class='divLoading' style='width:"+a(this).width()+"px'></div>").addClass("js-relative")},hideLoading:function(b){if(typeof(b)!="undefined"&&b.find("div.divLoading").length>0){divLoad=b.find("div.divLoading");divLoad.parent().removeClass("js-relative");divLoad.remove()}else{divLoad=a(this).find("div.divLoading");divLoad.parent().removeClass("js-relative");divLoad.remove()}},popCenter:function(d){defaults=a.extend({isReomvePop:true,closeBtns:[],btns:[]},d);var f=this,c=true;$mask=a('<div class="pop-masknote"></div>');f.after($mask);$mask.css({width:a(document).width(),height:a(document.body).outerHeight(true)-a(".head-adv").height()});f.slideDown();_Width=parseInt(f.outerWidth());_Height=parseInt(f.outerHeight());b();function b(){leftPos=parseInt((a(window).width()/2)-(_Width/2));topPos=parseInt((a(window).height()/2)-(_Height/2));if(a(window).width()<_Width){leftPos=0}if(a(window).height()<_Height){topPos=0}f.show().css({top:a(".header").height()+2})}if(c){a(document).on("click",function(g){$tar=a(g.target);if($tar.closest($mask).length==1){a(document).off("click");e(f)}for(var h in defaults.closeBtns){if($tar.closest(defaults.closeBtns[h]).length==1){a(document).off("click");e(f)}}for(var k in defaults.btns){if($tar.closest(defaults.btns[k]).length==1){a(document).off("click");e(f)}}})}function e(g){if(defaults.isReomvePop){g.remove()}else{g.hide()}$mask.remove();c=false;return false}a(window).on("resize scroll",function(){if(c){b()}return})},})})(jQuery); 
 (function(b){var a={loadRelevant:function(c){b(".relevant").show();this.loadWords(c)},loadRelevantTroggle:function(){var c=b("#dbcode").val();if(!c){return}var d=b(".bottom-commend-list .rlv-expert");var e=b(".bottom-commend-list .rlv-word");if(c.indexOf("GXDB")>-1){d.hide();e.hide()}else{d.show();e.show()}},loadExpert:function(c){var f=b("#ilr").val();if(!f||f=="0"){return}var h=b(".bottom-commend-list .rlv-expert");if(!c){h.empty();return}var e=APPPATH+"/Relevant/LoadExpert";var d=cnkiSearch.getSearchJsonInfo();var i={dbcode:b("#dbcode").val(),qjson:d};var g=cnkiSearch.getRootQueryGroup(cnkiSearch.GroupName.SUBJECT);if(!d||(g&&g.Items.length==0)){h.empty()}b.post(e,i,function(j){if(j&&j.replace(/[\r\n]*/g,"")){h.html(j)}else{h.empty()}})},loadWords:function(d){var e=b(".bottom-commend-list .rlv-word");if(!d){e.empty();return}var f=b("#dbcode").val();if(f&&f.indexOf("GXDB")>-1){return}var c=b("#RecommAPI").val();var g=c+"recommendations/words/union?w="+encodeURIComponent(d)+"&top=14";b.get(g,function(i){if(i&&i.wordres){var h=a.creatWordsList(i.wordres);e.html(h)}else{e.empty()}})},creatWordsList:function(f){if(!Array.isArray(f)){return""}var e=f.length,c="";for(var d=0;d<e;d++){c+='<span><a class="tit" href="'+APPPATH+"/DefaultResult/Index?dbcode="+b("#dbcode").val()+"&kw="+encodeURIComponent(f[d])+'" target="_blank" title="'+f[d]+'">'+f[d]+"</a></span>\n"}return"<h5>"+message.Relevant+"：</h5>\n<p>\n"+c+"</p>"},};window.relevant=a})(jQuery); 
 (function(b){b(function(){a.searchField();a.BindSeachClick();a.initControlStateByHref();a.bindCloseEvent();searchBar.sugInit();searchBar.resultSearch();var c=window.wordsGuid.getOneBoxWordsGuid("div.droplist","input.search-input");c.privateEvent()});var a={searchField:function(){b("body").on("click",".sort",function(c){var d=b(this).find(".sort-list");var e=b(c.target);if(e.closest(d.find("li.tit")).length!=1){d.toggle()}d.find("li").unbind("click").click(function(){d.find("li.cur").addClass("prevCur");if(b(this).hasClass("tit")||b(this).hasClass("cur")){return}var h=d.siblings().find("span"),g=d.siblings().find("input[type=text]");if(h.length>0){h.html(b(this).text())}else{if(g.length>0){g.val(b(this).text())}}if(message.ThemeArr.indexOf(b(this).text())>-1){b(this).parents(".reopt").siblings("input.search-input").attr("id","txt_search")}else{b(this).parents(".reopt").siblings("input.search-input").removeAttr("id")}d.find("li").removeClass("cur");b(this).addClass("cur");d.hide();var f=b(this).find("a").attr("value");if(f){b("#selectfield").val(f)}b("#selectfield").attr("korder",b(this).attr("data-val"));b("#selectfield").siblings("span").attr("value",f)})});b("body").on("mouseleave",".sort",function(){b(this).find(".sort-list").hide()})},searchByInputText:function(c){b("#fakediv").remove();if(!dblist.IsZKcode(c)){b("#isscdb").val(0)}_searchHistory.bindclick();cnkiSearch.delQueryNode(cnkiSearch.GroupName.SCDBGroup);this.SearchClickEvent();b.searchConditionWords(0);if(dblist.IsZKcode(c)){b("#scdbfield").val(b("#selectfield").val())}else{b("#scdbfield").val("")}},hasSearchWord:function(){var d=b.trim(b(".search-input").val());var c=b(".search-input");if(!b.isSupportPlaceholder()&&c.attr("placeholder")==c.val()){layer.alert(message.inputSearchWord1,{btn:message.Confirm,title:message.info});b("input[type=text]").blur();return false}if(!d){layer.alert(message.inputSearchWord1,{btn:message.Confirm,title:message.info});b("input[type=text]").blur();return false}return true},BindSeachClick:function(){var c=this;b(".search-btn").click(function(){if(!c.hasSearchWord()){return}var e=b.trim(b(".search-input").val());var d=b(".search-main .search-input").attr("data-field");if(!d&&!fliter.doValidate(e)){return}var f=dblist.GetSearchClickDBcode();c.searchByInputText(f)});b("body").bind("keyup",function(h){var h=h||event;var d=h.keyCode||h.which||h.charCode;if(d=="13"){if(b("#Ecp_top_login_layer").css("display")=="block"){b("#Ecp_top_login_layer #Ecp_Button1").click();return}if(b(".layui-layer-dialog").css("display")=="block"){return}if(!c.hasSearchWord()){return}var f=b.trim(b(".search-main .search-input").val());var i=b(".search-main .search-input").attr("data-field");if(!i&&!fliter.doValidate(f)){return}b("div.droplist").hide();var g=dblist.GetSearchClickDBcode();c.searchByInputText(g)}})},isErrorDate:function(d){var c=b("#selectfield").val();if(c){if("PD".indexOf(c.split("$")[0])>-1){if(!/^\d{4}[\-\/\.]?\d{0,2}[\-\/\.]?\d{0,2}$/.test(d)){return true}else{return false}}else{return false}}return false},SearchClickEvent:function(){var d=b.trim(b(".search-input").val());if(d){d=fliter.clearillegalChar(d)}else{if(b("#blankse").val()=="0"){a.hasSearchWord()}return}if(!fliter.doValidate(d)){return}if(a.isErrorDate(d)){layer.alert(message.dataError4,{btn:message.Confirm,title:message.info});return}var c=a.getUIQueryState(d);if(c){this.CreateSearchClickQueryState(c.item,c.searchItem);loadResultSetAndGroups();if(typeof relevant!="undefined"&&d){relevant.loadRelevant(d)}if(histroyuser&&d){histroyuser.searchAdd(d)}if(!!b(".search-main .search-input").val()){b(".btn-result-search.disableclick").removeClass("disableclick")}}},getUIQueryState:function(c){var j,o;var f=b("#selectfield").val();var q=b("#dbcode").val();if(!q){q="SCDB"}var g={forStorage:{},forUrl:[]};var j=b(".search-input").attr("data-field"),d=b(".search-input").attr("data-authorcode"),n=b(".search-input").attr("data-authorunit"),o=b(".search-input").attr("data-checkedcode"),m=b(".search-input").attr("searchword");if(!!o&&!!j){if(!dblist.isSCDB(q)){var e=new RegExp(q+".LYC=","gi");o=o.replace(e,"")}g.forStorage.checkedcode=encodeURIComponent(o);g.forStorage.field=encodeURIComponent(j);g.forUrl.push("checkedcode="+encodeURIComponent(o));g.forUrl.push("field="+encodeURIComponent(j))}if(!!j&&(!!n||!!d)){g.forStorage.authorcode=encodeURIComponent(d);g.forStorage.authorunit=encodeURIComponent(n);g.forStorage.field=encodeURIComponent(j);g.forUrl.push("authorcode="+encodeURIComponent(d));g.forUrl.push("authorunit="+encodeURIComponent(n));g.forUrl.push("field="+encodeURIComponent(j))}g.forStorage.searchword=encodeURIComponent(m);g.forUrl.push("searchword="+encodeURIComponent(m));if(!b.isDefaultResult()){var h=APPPATH+"/DefaultResult/Index?dbcode="+q.toUpperCase()+"&kw="+encodeURIComponent(c)+"&korder="+b("#selectfield").attr("korder");if(window.sessionStorage){var p=window.sessionStorage;p.setItem("params",JSON.stringify(g.forStorage))}else{h=h+"&"+g.forUrl.join("&")}var k=GetQueryStringByName("subject");if(k){h=h+"&subject="+k}window.location.href=h;return}var l=null;if(!!j&&(!!d||!!n||!!o)){var i=a.getCombineCondition(d,n,o,j,q,c,m,f.split("$")[0])}else{l=cnkiSearch.getQueryItem();l=b.splitFieldValue(f,c)}return{item:l,searchItem:i}},CreateSearchClickQueryState:function(j,g){if(cnkiSearch){if(b("#isscdb").val()=="1"){var f=cnkiSearch.findQueryNodeByPath("SCDBGroup");var e=cnkiSearch.getRootQueryGroup(cnkiSearch.GroupName.SUBJECT)}var k=b("#dbcode").val();cnkiSearch.resetSearchQueryState();cnkiSearch.setDbCode(k);if(dblist.IsZKcode(k)){var h=b("#CheckedDB").val();cnkiSearch.setKuaKuCode(h)}else{cnkiSearch.setKuaKuCode("")}var d=cnkiSearch.getRootQueryGroup(cnkiSearch.GroupName.SUBJECT);if(!!j){d.Items.push(j)}if(!!g){d.ChildItems.push(g)}if(typeof(f)!="undefined"&&typeof(f.ChildItems)!="undefined"&&f.ChildItems.length>0){for(var c=0;c<f.ChildItems.length;c++){cnkiSearch.addQueryNode(cnkiSearch.GroupName.SCDBGroup+"/"+f.ChildItems[c].Key,f.ChildItems[c].Items)}}}},CreateDbClickQueryState:function(i,e){var j=b("#dbcode").val();cnkiSearch.setDbCode(j);if(dblist.IsZKcode(j)){var h=b("#CheckedDB").val();cnkiSearch.setKuaKuCode(h)}else{cnkiSearch.setKuaKuCode("")}var c=cnkiSearch.getRootQueryGroup(cnkiSearch.GroupName.SUBJECT);var d=b(".search-his-tip .conditions a").last();var f=d.text().substring(d.text().indexOf("：")+1);var g=last.text().substring(0,last.text().indexOf("："));this.removeQueryItem(f,g);if(!!i){c.Items.push(i)}if(!!e){c.ChildItems.push(e)}},DbClickEvent:function(){var e=b("#dbcode").val();if(b("#isscdb").val()!="1"||b(".range").text()!=message.zk){a.SearchClickEvent();b.searchConditionWords(0)}else{if(b("#isscdb").val()=="1"&&!dblist.IsInCrooseDB(e)){b("#isscdb").val(0);a.SearchClickEvent();b.searchConditionWords(0)}else{var c=cnkiSearch.getRootQueryGroup(cnkiSearch.GroupName.SUBJECT);if(c.ChildItems.length==0&&c.Items.length==0){return}cnkiSearch.setDbCode(e);if(dblist.IsZKcode(e)){var d=b("#CheckedDB").val();cnkiSearch.setKuaKuCode(d);a.resumeSCDBSearchField()}else{cnkiSearch.setKuaKuCode("")}cnkiSearch.delQueryNode(cnkiSearch.GroupName.MutiGroup);loadResultSetAndGroups()}}},resumeSCDBSearchField:function(){var d=b("#scdbfield").val();var c=d.split("$")[0];var f=b(".sort-list li[data-val='"+c+"']").length>0?b(".sort-list li[data-val='"+c+"']"):b(".sort-list").find("li[name='defult']");if(f.length>0){var e=b(".sort-list").siblings().find("span");if(e.length>0){e.html(f.text())}b(".sort-list").find("li").removeClass("cur");f.addClass("cur");b("#selectfield").val(f.find("a").attr("value"))}},getCombineCondition:function(d,m,o,i,q,c,l,n){if(!i){return{}}var g=b("#selectfield").siblings("span").text();if(!!o){var k=cnkiSearch.getQueryGroup();k.Logic=cnkiSearch.Logic.AND;k.Title=g;var h=cnkiSearch.getQueryItem();h.Logic=cnkiSearch.Logic.AND;h.Name=i;h.Value=o;h.Operate="=";h.Title=c;h.ExtendType=cnkiSearch.ExtendType.Composite;k.Items.push(h)}else{if(!!d||!!m){var k=cnkiSearch.getQueryGroup();k.Title=g;if(!!d){var e=cnkiSearch.getQueryItem();e.Logic=cnkiSearch.Logic.AND;e.Name=i.split("|")[0];e.Value=d;e.Operate="=";e.Title=c;e.ExtendType=cnkiSearch.ExtendType.Composite;k.Items.push(e)}if(!!m){var f=cnkiSearch.getQueryGroup();f.Logic=cnkiSearch.Logic.OR;if(c){var j=cnkiSearch.getQueryItem();j.Name=n;j.Value=!!l?l:c;j.Operate="=";j.Title=c;f.Items.push(j)}var p=cnkiSearch.getQueryItem();p.Logic=cnkiSearch.Logic.AND;p.Name=i.split("|")[1];p.Value="'"+m.split("+").join("'+'")+"'";p.Operate="=";p.ExtendType=cnkiSearch.ExtendType.Composite;f.Items.push(p);k.ChildItems.push(f)}}}return k},initControlStateByHref:function(){var m=GetQueryStringByName("dbcode");if(!!m){b("#dbcode").val(m.toUpperCase())}else{m=b("#dbcode").val()}if(!b.isDefaultResult()){searchBar.LoadSearchFields(m,j,null);return}var c=GetQueryStringByName("kw");var j=GetQueryStringByName("korder");var l=GetQueryStringByName("checkedcode");var d=GetQueryStringByName("authorcode");var k=GetQueryStringByName("authorunit");var h=GetQueryStringByName("field");var g=GetQueryStringByName("searchword");if(window.sessionStorage){var i=window.sessionStorage;if(!!i.getItem("params")){var e=JSON.parse(i.getItem("params"))}if(!!e){var l=decodeURIComponent(e.checkedcode)==="undefined"?"":decodeURIComponent(e.checkedcode);var d=decodeURIComponent(e.authorcode)==="undefined"?"":decodeURIComponent(e.authorcode);var k=decodeURIComponent(e.authorunit)==="undefined"?"":decodeURIComponent(e.authorunit);var h=decodeURIComponent(e.field)==="undefined"?"":decodeURIComponent(e.field);var g=decodeURIComponent(e.searchword)==="undefined"?"":decodeURIComponent(e.searchword)}}var f=function(){if(!!c){b(".search-input").val(c)}var n=b(".search-input");if(!b.isSupportPlaceholder()&&n.attr("placeholder")==n.val()){return}if(!b.isSupportPlaceholder()&&b(".search-input").attr("style")){b(".search-input").attr("style","")}if(j){b(".input-box>.sort.reopt>.sort-default>span").attr("value",j)}b(".search-input").attr("data-checkedcode",l);b(".search-input").attr("data-authorcode",d);b(".search-input").attr("data-authorunit",k);b(".search-input").attr("data-field",h);b(".search-input").attr("searchword",g);var n=b("#txt_search");if(n.siblings(".sort.reopt").find(".sort-default span").text()!==message.theme){n.removeAttr("id")}var o=GetQueryStringByName(window.location.href,"id");if(o){_searchHistory.init(o)}a.searchByInputText(m)};searchBar.LoadSearchFields(m,j,f)},removeQueryItem:function(f,c){if(cnkiSearch){var d=cnkiSearch.getRootQueryGroup(cnkiSearch.GroupName.SUBJECT);for(var e in d.Items){if(d.Items[e].Value==f||d.Items[e].Value=="?"+f||d.Items[e].Value==f+"?"||d.Items[e].Value=="*"+f||d.Items[e].Value==f+"*"){if(d.Items[e].Title==c){d.Items.splice(e,1);break}}}d.ChildItems.forEach(function(i,j,h){if(i.Items&&i.Items[0]){var g=i.Items[0];if(g.Title==f){d.ChildItems.splice(j,1)}}if(i.ChildItems&&i.ChildItems.length>0){i.ChildItems.forEach(function(m,n,l){if(m.Items&&m.Items[0]){var k=m.Items[0];if(k.Title==f){d.ChildItems.splice(j,1)}}})}})}},bindCloseEvent:function(){var c=this;b(".result-con-l a.tiphide").click(function(){var l=b(".search-his-tip .conditions a");var i=l.length-1;var q=l.last();var o=q.text().substring(q.text().indexOf("：")+1);var k=q.text().substring(1,q.text().indexOf("："));l.last().remove();c.removeQueryItem(o,k);if(i<2){b(".result-con-l a.tiphide").hide()}if(b(".search-his-tip .conditions a").length==0){b(this).hide();b("#txt_search").val("");b(".search-main .search-input").val("");b(".search-main .search-input").trigger("input")}else{var d=b(".search-his-tip .conditions a").last(),g=d.text().substring(1,d.text().indexOf("：")),p=d.text().substring(d.text().indexOf("：")+1),h=b(".search-main .sort-list a:contains('"+g+"')");if(h.length>1){for(var m in h){if(b(h[m]).text()==g){h=b(h[m]);break}}}var j=h.parent();if(j.length>0){var r=b(".sort-list").siblings().find("span");if(r.length>0){r.html(j.text())}b(".sort-list").find("li").removeClass("cur");j.addClass("cur");b("#selectfield").val(j.find("a").attr("value"));b("#selectfield").siblings("span").attr("value",j.find("a").attr("value"))}var e=b(".search-main .search-input");var n=window.conditions[i];e.val(p);e.attr("searchword",n.searchword||"");e.attr("data-authorcode",n.authorcode||"");e.attr("data-field",n.dfield||"");e.attr("data-authorunit",n.authorunit||"");e.attr("data-checkedcode",n.checkedcode||"");e.siblings(".droplist").find("ul.recommendList").empty()}cnkiSearch.delQueryNode(cnkiSearch.GroupName.SCDBGroup);cnkiSearch.delQueryNode(cnkiSearch.GroupName.MutiGroup);loadResultSetAndGroups();if(typeof relevant!="undefined"){relevant.loadRelevant(p)}})},};window.searchBarUI=a;window.conditions=[]})(jQuery);(function(b){function a(){}a.prototype={LoadSearchFields:function(e,d,h,c){if(!e){e="SCDB"}if(typeof _searchHistory==="object"){var f=_searchHistory.getProcuctCode();e=f?f:e}var g=GetQueryStringByName("subject");if(g!=""){b(".search-main .btn-grade-search").attr("href",APPPATH+"/AdvSearch?dbcode="+e+"&subject="+g)}else{b(".search-main .btn-grade-search").attr("href",APPPATH+"/AdvSearch?dbcode="+e)}b.ajax({url:APPPATH+"/DefaultResult/_LoadSearchFields?dbcode="+e.toUpperCase(),type:"Get",success:function(j){b(".sort-list").remove();b(".sort.reopt").append(j);if(!d){var n=b("#selectfield").val();if(n&&n.indexOf("$")>-1){d=n.split("$")[0]}else{d=n}}var k=b("#postfield").val();if(k){if(k.indexOf("$")>=0){var l=k.split("$")[0];d=l}else{d=k}b("#postfield").val("")}var i=b(".sort-list li[data-val='"+d+"']").length>0?b(".sort-list li[data-val='"+d+"']"):b(".sort-list").find("li[name='defult']");if(i.length>0){var m=b(".sort-list").siblings().find("span");if(m.length>0){m.html(i.text())}b(".sort-list").find("li").removeClass("cur");i.addClass("cur");b("#selectfield").attr("korder",d);b("#selectfield").val(i.find("a").attr("value"));b("#selectfield").siblings("span").attr("value",i.find("a").attr("value"))}if(c){return}if(h&&typeof h=="function"){h()}}})},sugInit:function(){var c="//search-1cnki-1net-10097d65e0393.erf.sbb.spk-berlin.de";InitSug(c);b(document).on("click",".dictdiv .dictlistCol li.rw",function(){b(".search-btn").click()})},resultSearch:function(){b(".search-box").on("click","a.btn-result-search",function(){if(b(this).hasClass("disableclick")){return}var n=b("#dbcode").val();if(n==""||!n||b("#isscdb").val()=="1"){n="SCDB"}cnkiSearch.setQueryState("DBCode",n);if(dblist.IsZKcode(n)){cnkiSearch.setKuaKuCode(b("#CheckedDB").val());dblist.SetZKbtnState(b(".top-doctype .all"));b("#dbcode").val(n);cnkiSearch.delQueryNode(cnkiSearch.GroupName.MutiGroup)}else{cnkiSearch.setKuaKuCode("")}var d=b.trim(b(".search-main .search-input").val());var f=b(".search-main .search-input").attr("data-field");if(!d){layer.alert(message.inputSearchWord1,{btn:message.Confirm,title:message.info})}if(!f&&!fliter.doValidate(d)){return}var c=b(".search-main .sort span").text()+"："+d;if(c==b(".result-con-l .conditions a").last().text()){b(".top-doctype").showLoading();setTimeout(function(){b(".top-doctype").hideLoading()},300);return}d=fliter.clearillegalChar(d);var g=b(".search-input").attr("data-field");var l=b(".search-input").attr("data-checkedcode");var e=b(".search-input").attr("data-authorcode");var j=b(".search-input").attr("data-authorunit");var i=b(".search-input").attr("searchword");var k=b("#selectfield").val();if(!!g){var m=searchBarUI.getCombineCondition(e,j,l,g,n,d,i,k.split("$")[0]);if(!!m){m.Key="ddx";cnkiSearch.getRootQueryGroup(cnkiSearch.GroupName.SUBJECT).ChildItems.push(m)}}else{var h=b.splitFieldValue(k,d);if(!!h){h.Key="ddx";cnkiSearch.addQueryNode("Subject",h)}}loadResultSetAndGroups();b.searchConditionWords(1,1);if(typeof relevant!="undefined"){relevant.loadRelevant(d)}})},};window.searchBar=new a()})(jQuery); 
 function getProUrl(){return APPPATH+"/Prohibit/index"}function RegProHibitTag(){var a="";$("#briefBox input[name='CookieName']").each(function(){a+=$(this).attr("value")+":"});if(a!=""&&a!="undefined"){$.ajax({url:getProUrl()+"?code="+a,type:"POST",dataType:"json",success:function(b){if(b.Reg==true){var c=b.RegMsg;if(c!=""&&c!="undefined"){CheckDownType(c)}}},error:function(c,b,d){}})}}function CheckDownType(e){var a=e.split("|");for(var c=0;c<a.length;c++){var b=a[c];if(b!=""&&b!="undefined"){var d=b.split(":");if(d.length==2){if(d[1]!=""&&d[1]!="undefined"&&(d[1]==1||d[1]==4)){var f=$("#briefBox input[value='"+d[0]+"']").parents("td.seq").siblings("td.operat").find("a.downloadlink");if(!!f==false||f.length<=0){f=$("#briefBox input[value='"+d[0]+"']").parents(".seq").siblings("div.opts").find("a.downloadlink")}if(f!=null&&f!="undefined"){f.addClass("icon-fulltext");f.attr("href","javascript:void(0);").attr("target","_self").attr("title",message.prohibitWord).addClass("prohibitLink")}}}}}}function IsBilingLiters(b){if(!b||b.length==0){return}var c=$("#dbcode").val();if(!c){return}if(c=="CJFQ"||c=="CJFD"||c=="CFLQ"||c=="CFLS"||c=="SCDB"){var a="";$.each(b,function(){var d=$(this).attr("href");a=a+GetQueryStringByName(d,"filename")+";"});$.get(APPPATH+"/Brief/GetBilingLiters?filenames="+a,function(d){if(!d){return}$.each(d,function(){if(this.indexOf(",")<0){return}var e=this.split(",");if(e[1]=="1"){$("[data-filename='"+e[0]+"']").parent().siblings("td.name").append("<B class='cMarkSign'>"+message.Biling+"</B>")}})})}}; 
 (function($){$(function(){briefExtend.SortBY();briefExtend.changeListDT();briefExtend.sortPage();briefExtend.turnpage();briefExtend.moreSentence();briefExtend.downloadLinkClick();briefExtend.bulkDownload();briefExtend.getVeriCode();briefExtend.checkCodeBtn();briefExtend.moreAuthors();briefExtend.getQuotes();briefExtend.subscribe();briefExtend.showAllAuthors();briefExtend.analysis();briefExtend.searchHistory();briefExtend.downloadHistory();briefExtend.exportClickEvnt()});var curSort={SortAll:"",SortType:""};var displayModeArr={GBTREFER:"GBTREFER",REFER:"REFER",NEW:"NEW",newdefine:"newdefine",elearning:"elearning",Refworks:"Refworks",EndNote:"EndNote",NoteExpress:"NoteExpress",NodeFirst:"NodeFirst",selfDefine:"selfDefine",MLA:"MLA",APA:"APA"};var briefParam={_getDbCode:function(){return $("#dbcode").val()},_getHandlerId:function(){return $("#HandlerIdHid").val()},_getSearchJson:function(){var isCreateJson=$("#isCreateJsonHid").val();if(isCreateJson=="-1"){return""}else{return cnkiSearch.getSearchJsonInfo()}},_getCurDisMode:function(isSearch){var mode;var dbCode=briefParam._getDbCode();if(!!isSearch&&!!dbCode&&dbCode.indexOf("SCDB")>=0){var utype=GEetUInfoFromECP("utype");if(islogin()&&utype=="jf"){var setvals=getPersonSets(1);var personCongifArr;if(setvals&&setvals.indexOf(";")>0){personCongifArr=setvals.split(";");mode=personCongifArr.length>3?personCongifArr[2]:""}}else{mode=sessionCookieUnit.getCookie("dstyle")}}if(!!mode==false){mode=$("#DivDisplayMode").find(".active").attr("data-mode")}if(!!mode==false){if($(".result-detail-list").length>0){mode="custommode"}else{mode="listmode"}}return mode},_getPageSize:function(isSearch){var dbCode=briefParam._getDbCode();if(!!isSearch&&!!dbCode&&dbCode.indexOf("SCDB")>=0){var dperpage;var utype=GEetUInfoFromECP("utype");if(islogin()&&utype=="jf"){var personCongifArr;var setvals=getPersonSets(1);if(setvals&&setvals.indexOf(";")>0){personCongifArr=setvals.split(";");dperpage=personCongifArr.length>3?personCongifArr[1]:""}}else{dperpage=sessionCookieUnit.getCookie("dperpage")}if(!!dperpage==false){return $("#perPageDiv .sort-default>span").text()}return dperpage}return $("#perPageDiv .sort-default>span").text()},_getCurPage:function(){var curPage=$("#curPageHid").val();if(!!curPage==false){curPage=$("#briefBox div.pages span.cur").text()}return curPage},_multiSearchConditions:function(){var qgroup=cnkiSearch.getRootQueryGroup("Subject");if(!qgroup){return}var cond=[];var contactHtml=function(item){if(item){var name=item.Name;cond.push(name)}};var recureCItems=function(items){if(!items){return}for(var i=0;i<items.length;i++){var item=items[i];if(!item){continue}if(item.Items){item.Items.forEach(contactHtml)}recureCItems(item.ChildItems)}};if(qgroup.Items){qgroup.Items.forEach(contactHtml)}recureCItems(qgroup.ChildItems);return cond.join("+")},_curSortVal:function(isSearch){var curField=$(".sort-default span").attr("value");var url=location.href;if(url.toLowerCase().indexOf("advsearch")>=0){curField=briefParam._multiSearchConditions()}if(!!curField==false){curField=$(".sort-default #selectfield").val()}var isSort=briefParam._getIsSortSearch();var dbCode=briefParam._getDbCode();var curSortAll=$("#orderList").find(".cur").attr("data-sort");var curCls=$("#orderList").find(".cur").attr("class");var isOnlydesc=$("#orderList").find(".cur").attr("data-onlydesc");var sortType=(!!curCls==false||curCls.indexOf("descend")>=0||isOnlydesc=="true")?"desc":"asc";curSort.SortAll=!!curSortAll?curSortAll:"";curSort.SortType=!!sortType?sortType:"";if(!!isSearch&&!!curField&&(curField.toLowerCase().indexOf("ft")>=0||curField.toLowerCase().indexOf("su")>=0)){var ftSortAllVal="%e7%9b%b8%e5%85%b3%e5%ba%a6%2f(ffd%2c%27rank%27)";var ftRelevantSortAllVal="%e7%9b%b8%e5%85%b3%e5%ba%a6%2frelevant";var suSortAllVal="%e5%8f%91%e8%a1%a8%e6%97%b6%e9%97%b4%2f(%e5%8f%91%e8%a1%a8%e6%97%b6%e9%97%b4%2c%27TIME%27)";var suYearSortAllVal="%e5%b9%b4%2f(%e5%b9%b4%2c%27DATE%27)";suBookSortAllVal="%e8%a2%ab%e5%bc%95%2f(%e8%a2%ab%e5%bc%95%e9%a2%91%e6%ac%a1%2c'integer')";var sortTypeVal="desc";if(LanguageEncode=="EN"){ftSortAllVal="Subject%2f(ffd%2c%27rank%27)";ftRelevantSortAllVal="Subject%2frelevant";suSortAllVal="Publication+Date%2f(%e5%8f%91%e8%a1%a8%e6%97%b6%e9%97%b4%2c%27TIME%27)";suYearSortAllVal="Year%2f(%e5%b9%b4%2c%27DATE%27)";suBookSortAllVal="Cites%2f(%e8%a2%ab%e5%bc%95%e9%a2%91%e6%ac%a1%2c'integer')"}else{if(LanguageEncode=="BG"){ftSortAllVal="%e7%9b%b8%e9%97%9c%e5%ba%a6%2f(ffd%2c%27rank%27)";ftRelevantSortAllVal="%e7%9b%b8%e9%97%9c%e5%ba%a6%2frelevant";suSortAllVal="%e7%99%bc%e8%a1%a8%e6%99%82%e9%96%93%2f(%e5%8f%91%e8%a1%a8%e6%97%b6%e9%97%b4%2c%27TIME%27)";suYearSortAllVal="%e5%b9%b4%2f(%e5%b9%b4%2c%27DATE%27)";suBookSortAllVal="%e8%a2%ab%e5%bc%95%2f(%e8%a2%ab%e5%bc%95%e9%a2%91%e6%ac%a1%2c'integer')"}}if(curField.toLowerCase().indexOf("ft")>=0){var relevantDBCodes=["CPVD","CJSF","CCJD","CNAD","CYFD","CSYD","FCJD"];if(relevantDBCodes.indexOf(dbCode)>=0){curSort.SortAll=ftRelevantSortAllVal;curSort.SortType=""}else{curSort.SortAll=ftSortAllVal;curSort.SortType=sortTypeVal}}else{if(curField.toLowerCase().indexOf("su")>=0){var yearDBCodes=["SNAD"];var bookDBCodes=["BDZK"];if(yearDBCodes.indexOf(dbCode)>=0){curSort.SortAll=suYearSortAllVal;curSort.SortType=sortTypeVal}else{if(bookDBCodes.indexOf(dbCode)>=0){curSort.SortAll=suBookSortAllVal;curSort.SortType=sortTypeVal}else{curSort.SortAll=suSortAllVal;curSort.SortType=sortTypeVal}}}}}else{if(!!isSearch&&!!dbCode&&dbCode.indexOf("SCDB")>=0&&!!curSortAll==false){var order;var utype=GEetUInfoFromECP("utype");if(islogin()&&utype=="jf"){var personCongifArr;var setvals=getPersonSets(1);if(setvals&&setvals.indexOf(";")>0){personCongifArr=setvals.split(";");order=personCongifArr.length>3?personCongifArr[3]:""}}else{order=sessionCookieUnit.getCookie("dsorder")}if(!!order){order=getSortValue(order)}if($("#sortList #orderList li").length>0&&!!order){$("#sortList #orderList li").each(function(){var curCls=$(this).attr("class");var sortAll=$(this).attr("data-sort");var sortType=(!!curCls==false||curCls.indexOf("descend")>=0||isOnlydesc=="true")?"desc":"asc";if(sortAll.toLowerCase().indexOf(order.toLowerCase())>=0){curSort.SortAll=sortAll;curSort.SortType=sortType;return false}})}else{if(!!order){curSort.SortAll=order;curSort.SortType="desc"}}}}return curSort},_getIsSentenceSearch:function(){var seachCur=$(".search-classify-menu>.active").attr("name");if(seachCur=="sentenceSearch"){return true}return false},_getSearchSql:function(){return $("#sqlVal").val()},_getIsSortSearch:function(){return $("#isSortHid").val()},_getSearchPaperArgModel:function(isSearch,cPage){var argModel={};var dbCode=briefParam._getDbCode();var pSize=briefParam._getPageSize(isSearch);var cPage=!!cPage?cPage:briefParam._getCurPage();if(!!cPage==false){cPage=1}if(!!pSize==false){pSize=20}argModel={IsSearch:isSearch,QueryJson:briefParam._getSearchJson(),SearchSql:briefParam._getSearchSql(),PageName:GetPageName(),HandlerId:briefParam._getHandlerId(),DBCode:dbCode,KuaKuCodes:cnkiSearch.getKuaKuCode(),CurPage:cPage,RecordsCntPerPage:pSize,CurDisplayMode:briefParam._getCurDisMode(isSearch),CurrSortField:briefParam._curSortVal(isSearch).SortAll,CurrSortFieldType:curSort.SortType,IsSortSearch:briefParam._getIsSortSearch(),IsSentenceSearch:briefParam._getIsSentenceSearch(),Subject:GetQueryStringByName("subject")};if(argModel.IsSearch==true||argModel.IsSortSearch=="true"){argModel.CurPage="1"}return argModel},_getDownloadArgModel:function(){var argModel={};var dbCode=briefParam._getDbCode();var pSize=briefParam._getPageSize(false);var cPage=briefParam._getCurPage();if(!!cPage==false){cPage=1}if(!!pSize==false){pSize=20}var curRec=(cPage-1)*pSize+1;argModel={PageName:GetPageName(),HandlerId:briefParam._getHandlerId(),SearchSql:briefParam._getSearchSql(),DBCode:dbCode,CurItem:curRec,PageSize:pSize};return argModel}};var briefExtend={searchCallBackFun:function(isSearch,cPage){$("div.main,#managesearchbox").showLoading();$.ajax({url:APPPATH+"/Brief/GetGridTableHtml",type:"POST",data:briefParam._getSearchPaperArgModel(isSearch,cPage),dataType:"html",error:function(XMLHttpRequest,textStatus,errorThrown){$("#briefBox").show();var errorMsg="Error Requesting: "+XMLHttpRequest.status+" "+textStatus;$("#briefBox").html('<p class="no-content" data-val="XMLHttpRequest Error'+errorMsg+'"> '+message.searchAgain+"</p>");$("div.main,#managesearchbox").hideLoading()},success:function(data){$("#briefBox").show();$("#briefBox").html(data);$("div.main,#managesearchbox").hideLoading();var isCreateJson=$("#isCreateJsonHid").val();if(isCreateJson=="-1"){$("#briefBox #batchOpsBox #analysisLi").hide()}else{$("#briefBox #batchOpsBox #analysisLi").show()}if($("#briefBox .verifycode").length>0){briefExtend.setVeriCodeKeyUp();return}if(!!isSearch==false&&briefParam._getIsSortSearch()=="false"){briefExtend.scrollToTop()}var cnt=$("#countPageDiv>em").text();if(cnt=="0"){$("#gridTable .toolbar-col").addClass("disabled")}else{$("#gridTable .toolbar-col").removeClass("disabled")}briefExtend.downloadValidRight(briefParam._getDownloadArgModel());getResourceGroup(briefParam._getHandlerId());$.searchinfoInit();$.filenameInit();if(cnkiSearch.findQueryNodeByPath("Subject/ddx")){_searchHistory.apisave()}histroyuser.sqlAdd();if($("a.fz14").length>0){window.KNS.isCollection($("a.fz14"))}else{if($("dl.result-detail-list>dd h6>a").length>0){window.KNS.isCollection($("dl.result-detail-list>dd>.middle>h6>a"))}}briefExtend.setMostAuthors();if($("#isoversea").val()=="1"){RegProHibitTag();IsBilingLiters($("a.fz14"))}}})},scrollToTop:function(){var tool=$(".wrapper .top-doctype");if(!!tool){var offset=tool.offset();$("html,body").animate({scrollTop:!!offset?offset.top:0},500)}},searchHistory:function(){$("body").on("click","#gridTable td.name a,div.detail-list dd>h6>a",function(){var obj=this;var strParams="";if($(obj).attr("href")&&$(obj).attr("href").length>0){var query=decodeURI($(this).attr("href"));var strdbcode=GetQueryStringByName(query,"dbcode");var strdbname=GetQueryStringByName(query,"dbname");var strfilename=GetQueryStringByName(query,"filename");strParams=strfilename+"!"+strdbcode+"!"+strdbname;var params=strParams+"<!>"+$(obj).text()+"<!>"+$(obj).attr("href");histroyuser.viewAdd(params)}})},downloadHistory:function(){$("body").on("click","#gridTable  td.operat a.downloadlink:not(.prohibitLink),#gridTable div.opts ul a.icon-download:not(.prohibitLink)",function(){var obj=$(this).parents("tr").find("td.name a").length>0?$(this).parents("tr").find("td.name a"):$(this).parents("dd").find("h6 a");var strParams="";if($(obj).attr("href")&&$(obj).attr("href").length>0){var query=decodeURI($(obj).attr("href"));var strdbcode=GetQueryStringByName(query,"dbcode");var strdbname=GetQueryStringByName(query,"dbname");var strfilename=GetQueryStringByName(query,"filename");strParams=strfilename+"!"+strdbcode+"!"+strdbname;var params=strParams+"<!>"+$(obj).text()+"<!>"+$(obj).attr("href");histroyuser.downloadAdd(params)}});$("body").on("click","#gridTable td.operat a.prohibitLink,#gridTable div.opts ul a.prohibitLink",function(){alert(message.prohibitTip);return false})},checkAll:function(form){e=document.forms[0].elements;for(i=0;i<e.length;i++){if(e[i].type=="checkbox"&&e[i].name=="FileNameS"){if(numMarked()>=100){alert(message.most100);return false}else{if(e[i].checked==false){if(document.cookie.length+e[i].value.length>4096){alert(message.updateBrowser);return false}addToCookie(e[i].value);e[i].checked=true}}}}return true},clearAll:function(obj){$("#selectCheckAll1").prop("checked",false);$.each($("table.result-table-list :checked"),function(){$(this).prop("checked",false)});$.each($("dl.result-detail-list :checked"),function(){$(this).prop("checked",false)});if(window.localStorage){var storage=window.localStorage;storage.setItem("FileNameS","");storage.setItem("SelectFileNameS","")}$(obj).siblings("em").text("0")},SortBY:function(){$("body").on("click","#sortList #orderList li",function(){var cls=$(this).attr("class");$(this).siblings().removeClass("descend").removeClass("ascend").removeClass("cur");var sortHtml=$(this).html();var onlyDesc=$(this).attr("data-onlydesc");if(!!sortHtml&&onlyDesc=="true"){$(this).removeClass("ascend").addClass("descend").addClass("cur")}else{if(!!cls){$(this).toggleClass("ascend").toggleClass("descend")}else{$(this).addClass("descend")}$(this).addClass("cur")}$("#isSortHid").val("true");briefExtend.searchCallBackFun(false)})},changeListDT:function(){$("body").on("click","#DivDisplayMode li",function(){$(this).addClass("active").siblings().removeClass("active");briefExtend.searchCallBackFun(false)})},sortPage:function(){$("body").on("click","#perPageDiv",function(){$selectList=$(this).find(".sort-list");$selectList.find("li").on("click",function(){if($(this).hasClass("tit")){return}var titSpan=$("#perPageDiv .sort-default>span");if(titSpan.length>0){titSpan.text($(this).text());titSpan.attr("value",$(this).find("a").attr("data-val"))}$selectList.find("li").removeClass("cur");$(this).addClass("cur");$selectList.hide();$("#curPageHid").val("1");briefExtend.searchCallBackFun(false)})});$("body").on("click","#perPageDiv",function(){$(this).find(".sort-list").show()}).on("mouseleave","#perPageDiv",function(){$(this).find(".sort-list").hide()})},turnpage:function(){$("body").on("click","#Page_next,#Page_prev,.pages a,#Page_next_top,#Page_Prev_top",function(){$that=$(this);var curPage=$that.attr("data-curPage");$("#curPageHid").val(curPage);briefExtend.searchCallBackFun(false)});$("body").on("keyup",function(event){var srcEl=event.srcElement?event.srcElement:event.target;var tagstr=srcEl.tagName;var reTag=/input|select/gi;if(reTag.test(tagstr)){return}else{var typestr=srcEl.type;var reType=/text/gi;if(reType.test(typestr)){return}}var keycode=event.which||event.keyCode;switch(keycode){case 37:case 3:case 271:if($("#PagePrev")){$("#PagePrev").click()}break;case 39:case 4:case 272:if($("#PageNext")){$("#PageNext").click()}break}})},moreSentence:function(){$("body").on("click",".result-detail-list .btn-more-sentence",function(){var queryID=$(this).attr("data-queryID");var curRec=$(this).attr("data-CurRec");var dbCode=$(this).attr("data-dbprefix");if(!!dbCode==false){dbCode=briefParam._getDbCode()}var articleTitle=$(this).siblings("#keyfrom").html();if(!articleTitle){articleTitle=$(this).siblings("a").html()}var searchSen1=$("#sen_1_value1").val();var searchSen2=$("#sen_1_value2").val();var showTitle=message.file+"《"+articleTitle+"》"+message.inContain+'<font class="Mark">'+searchSen1+'</font>和<font class="Mark">'+searchSen2+"</font>"+message.allSens;var url=APPPATH+"/Brief/GetMoreSentence";var pArr=new Array();pArr.push(createElement("input","hidden","HandlerId",queryID));pArr.push(createElement("input","hidden","CurRec",curRec));pArr.push(createElement("input","hidden","DBCode",dbCode));pArr.push(createElement("input","hidden","PageName",GetPageName()));pArr.push(createElement("input","hidden","ShowTitle",escape(showTitle)));pArr.push(createElement("input","hidden","SearchSql",briefParam._getSearchSql()));postSubmit("SentenceClickSubmitForm",url,pArr,"_blank")})},downloadValidRight:function(paramObj){if(!islogin()){return}$.ajax({url:APPPATH+"/Download/ValidRight",type:"POST",cache:false,data:paramObj,error:function(XMLHttpRequest,textStatus,errorThrown){var errorMsg="Error Requesting: "+XMLHttpRequest.status+" "+textStatus},success:function(result){if(!!result){var jsonArr=eval("("+result+")");setDownload.setDownloadCls(jsonArr)}}})},downloadLinkClick:function(){$("body").on("click","a.downloadCnt",function(){var mode=briefParam._getCurDisMode(false);var alink;if(mode=="custommode"){alink=$(this).parents("div.middle").siblings(".opts").find("a.downloadlink");if(!!alink==false||alink.length<=0){alink=$(this).parents("div.middle").siblings(".opts").find("a.icon-play")}}else{alink=$(this).parents("td.download").siblings("td.operat").find("a.downloadlink");if(!!alink==false||alink.length<=0){alink=$(this).parents("td.views").siblings("td.operat").find("a.icon-play")}}if(alink.length>0){alink[0].click()}});$("body").on("click","a.icon-nodownperm",function(){var title=$(this).attr("title");window.open(APPPATH+"/Error/Index?erroeMsg="+escape(title));return false})},bulkDownload:function(){$("body").on("click",".dropdown-analysis-btns li.bulkdownload a",function(){window.open(APPPATH+"/manage/batch")})},setVeriCodeKeyUp:function(){var $input=$(".verifycode #vericode");$input.on("keyup",function(ev){if(ev.keyCode==13){if(ev.stopPropagation){ev.stopPropagation()}else{ev.cancelBubble=true}$(".verifycode #checkCodeBtn").click()}})},checkCodeBtn:function(){$("body").on("click","#briefBox #checkCodeBtn",function(){var cPage=briefParam._getCurPage();var vcode=$("#vericode").val();var argModel={vericode:vcode};if(!!vcode==false){$(".verifycode .error").text(message.inputVerificationCode).show();return false}$(".verifycode .error").hide();$.ajax({url:APPPATH+"/Brief/CheckCode",type:"POST",cache:false,data:argModel,success:function(result){if(!!result){$("#checkFlag").removeClass().addClass("icon icon-wrong");$(".verifycode .error").text(message.inputVerificationCodeError).show()}else{$("#checkFlag").removeClass().addClass("icon icon-right");$(".verifycode .error").hide();briefExtend.searchCallBackFun(false,cPage)}}})})},getVeriCode:function(){$("body").on("click","#briefBox #changeVercode",function(){var url=APPPATH+"/Brief/VerifyCode";$(this).attr("src",url+"?t="+Math.random())})},moreAuthors:function(){$("body").on("click","#briefBox .moreAuthors",function(){var $this=$(this);var au=$this.parent().parent().find(".otherAuthorinfos");if(au.is(":visible")){$this.removeClass("icon-up").addClass("icon-down");au.hide()}else{$this.removeClass("icon-down").addClass("icon-up");au.show()}})},getQuotes:function(){$("body").on("click",".quote-pop .quote-r",function(){var text=this;if(document.body.createTextRange){var range=document.body.createTextRange();range.moveToElementText(text);range.select()}else{if(window.getSelection){var selection=window.getSelection();var range=document.createRange();range.selectNodeContents(text);selection.removeAllRanges();selection.addRange(range)}}});$("body").on("click",".icon-quote",function(){var $this=$(this);var url=APPPATH+"/manage/APIGetExport";var mode=briefParam._getCurDisMode(false);var fileName=$this.parent(".operat").siblings("td.seq").find(".cbItem").val();if(mode=="custommode"||!!fileName==false){fileName=$this.parents(".opts").siblings("div.seq").find(".cbItem").val()}if($this.parents(".detail-list").hasClass("dbpage")){var params=[];var fileObj=$this.parents("dd").find("h6");params.push(fileObj.attr("dbcode"));params.push(fileObj.attr("name"));params.push("0");params.push("0");fileName=params.join("!")}if(!!fileName==false){layer.alert(message.sorry,{btn:message.Confirm,title:message.info});return}var displaymode=displayModeArr.GBTREFER+","+displayModeArr.MLA+","+displayModeArr.APA;$.post(url,{filename:fileName,displaymode:displaymode},function(dataJson){if(!!dataJson){var quotes="";if(dataJson.code==1){quotes="<table>\n";var data=dataJson.data;if(data.length==0){quotes="<table>\n<tr>\n<td>"+message.sorry+'</td>\n</tr>\n<input type="hidden" value="'+dataJson.msg+'"></table>'}else{for(i=0;i<data.length;i++){for(j=0;j<data[i].value.length;j++){var tmpVal=data[i].value[j];var reg=new RegExp("<br>","g");tmpVal=tmpVal.replace(reg,"\n");quotes+='<tr>\n<td class="quote-l">'+data[i].key+'</td>\n<td class="quote-r">'+tmpVal+"</td>\n</tr>\n"}}var others="<tr></tr>";quotes+="</table>";var others="<div class='format-links'>";others+="<a href='javascript:void(0);' class='otherFormat' data-fileName='"+fileName+"' data-format='"+displayModeArr.elearning+"'>"+message.elearning+"</a>";others+="<a href='javascript:void(0);' class='otherFormat' data-fileName='"+fileName+"' data-format='"+displayModeArr.EndNote+"'>EndNote</a>";others+="<a href='javascript:void(0);' class='otherFormat' data-fileName='"+fileName+"' data-format='"+displayModeArr.NoteExpress+"'>NoteExpress</a>";others+="<a href='javascript:void(0);' class='otherFormat' data-fileName='"+fileName+"' data-format='"+displayModeArr.Refworks+"'>Refworks</a>";others+="<a href='javascript:void(0);' class='otherFormat' data-fileName='"+fileName+"' data-format='"+displayModeArr.NodeFirst+"'>NoteFirst</a>";var moreLink=APPPATH+"/manage/export.html?displaymode="+displayModeArr.NEW+"&filename="+fileName;others+="<a class='btn-more-formats' target='_blank' href='"+moreLink+"'>"+message.moreFormats+" &gt;&gt;</a></div>";quotes+=others}}else{quotes="<table>\n<tr>\n<td>"+message.sorry+'</td>\n</tr>\n<input type="hidden" value="'+dataJson.msg+'"></table>'}layer.open({type:1,skin:"quote-pop",closeBtn:1,resize:false,shadeClose:true,title:message.Quote,area:"750px",content:quotes,scrollbar:false});$(".quote-pop .quote-r").eq(0).trigger("click")}})});$("body").on("click",".otherFormat",function(){var $this=$(this);var filename=$this.attr("data-fileName");var displayMode=$this.attr("data-format");if(!!filename==false||!!displayMode==false){}else{briefExtend.exportToExt(filename,displayMode,"txt")}})},exportToExt:function(filename,displayMode,type){var param={filename:filename,DisplayMode:displayMode,Type:type};if(type=="elearning"){$.PostWindow(APPPATH+"/manage/FileToText.es5",param)}else{$.PostWindow(APPPATH+"/manage/FileToText",param)}},subscribe:function(){var submit=function(url,valueList){var form=$("<form/>",{id:"subScriptionForm",name:"subScriptionForm",method:"POST",target:"_blank",action:url,style:"display:none"});valueList.forEach(function(element){var input=$("<input>",{name:element.name,value:element.value});form.append(input)});$("#briefBox").append(form);form.submit();$("#subScriptionForm").remove()};$(".result-con-l").on("click","a.btn-subscribe",function(){var lid=getValueFromCookie("LID");var loginState=getValueFromCookie("Ecp_LoginStuts");var userid,userType;if(!!loginState){var jsonState=JSON.parse(loginState);userid=jsonState.UserName;userType=jsonState.UserType}if(!lid||!userid){$("#Ecp_top_login").click();return}else{if(userType!="jf"){layer.msg(message.SubscribeTips)}else{if($("#sqlVal").val()==""){layer.msg(message.SearchErrorSQL)}else{var json=cnkiSearch.getSearchJsonInfo();var ConditionExp="";var content="";$.when($.ajax({url:APPPATH+"/Brief/GetCustomCondition",type:"GET",data:{json:json},success:function(result){ConditionExp=encodeURIComponent(result)}})).then(function(){var condition=$(".conditions").text().replace(">","");var dbname=$(".range").text();content="<form id='addexp'><dl>";content+="<dt><p style='background-color: #3288ff; color: #fff'>"+message.Custom+"</p></dt> <dd><p class='toptip'><i></i>"+message.CustomMark+"</p></dd>";content+="<dd><span>"+message.searchTitle+":</span><input id='Name' name='Name' class='newtitle' type='text' maxlength='50'><label id='nameTag' style='color: red;'></label></dd>";content+="<dd><span>"+message.searchDB+":</span><p>"+dbname+"</p><input id='dbcod' type='hidden' name='dbcode' value=''></dd>";content+="<dd><span>"+message.searchCondition+":</span> <input id='cus' name='condition' type='hidden' value='"+condition+"'><p>"+condition+"</p><input id='cusexp' type='hidden' name='cusexp' value=''></dd>";content+="</dl><div class='btns'><a class='add' title="+message.add+">"+message.add+"</a> ";content+="<span class ='QueryCustom' style='display:none' title="+message.QueryCustom+">"+message.QueryCustom+"</span> ";content+=" <a class='ShowCustom' title="+message.ShowCustom+"  style='display:none' target='_blank'  href='https://i-1cnki-1net-10097d65e0393.erf.sbb.spk-berlin.de/?type=subscribe'>"+message.ShowCustom+"</a></div>";content+="</form>"}).done(function(){layer.open({type:1,skin:"custom-pop",closeBtn:1,resize:false,shadeClose:true,title:message.Custom,area:"750px",content:content,scrollbar:false});$("#cusexp").val(ConditionExp)})}}}});$("body").on("focus","#Name",function(){$("#nameTag").text("")});$("body").on("click","a.add",function(){$("#nameTag").text("");if($("#Name").val()==""){$("#nameTag").text(message.Tip);return}var geturl=$("#RecSysAPI").val()+"api/UserDataCenter/CustomExpression";var expressionName=encodeURIComponent($("#Name").val());var condition=$("#cusexp").val();var dbcode=$("#dbcode").val();var param="idenID="+getValueFromCookie("LID")+"&clientID="+getValueFromCookie("Ecp_ClientId")+"&userIP="+getValueFromCookie("Ecp_ClientIp")+"&platformURL="+window.location.href+"@"+APPPATH.replace("")+"&operateType=add&expressionName="+expressionName+"&productID="+dbcode+"&condition="+condition;try{$.ajax({url:$("#RecSysAPI").val()+"api/UserDataCenter/CustomExpression?"+param,dataType:"json",type:"post",success:function(data){if(1==data.Code){$(".add").hide();$(".ShowCustom").show();$(".QueryCustom").show()}else{layer.msg(data.Message)}}})}catch(e){}})},removeScriptChar:function(str){str=str.replace(/[\r|\n]/ig,"");var reg=/<script[^>]*?>[|\w|\W]*?<\/.*?script.*?>/ig;str=str.replace(reg,"");str=str.replace(/;;/ig,";");str=$.trim(str);return str},setMostAuthors:function(){$("table.result-table-list>tbody>tr>td.author").each(function(){var outHtml=$(this).html();var outText=$(this).text().trim();var oaulist;outHtml=briefExtend.removeScriptChar(outHtml);var oZz=/<a[^>]*>[^<>]*(((<(font|span)[^>]*>)[^<>]*)+((<\/(font|span)>)[^<>]*)+)*<\/a>/ig;if(oZz.test(outHtml)){oaulist=outHtml.match(oZz)}else{if(outHtml.indexOf(";;")>0){oaulist=outHtml.split(";;")}else{oaulist=outHtml.split(";")}}var aul=oaulist.length;if(aul>5){outHtml=oaulist.slice(0,5).join(";")+"<a  title='"+message.showAllAuthors+"' class='showAllAuthors'></a><span style='display:none'>;"+oaulist.slice(5).join(";")+"</span>"}else{if(aul==1&&outText.length>80){outHtml=outText.substring(0,80)+"<a  title='"+message.showAllAuthors+"' class='showAllAuthors'></a><span style='display:none'>;"+outText.substring(80)+"</span>"}}$(this).html(outHtml)});$(".result-detail-list>dd>.middle>.authorinfo>p").each(function(){var outHtml=$(this).html();outHtml=outHtml.replace(/;;/ig,";");$(this).html(outHtml)})},showAllAuthors:function(){$("body").on("click","table.result-table-list > tbody > tr > td.author>.showAllAuthors",function(){$(this).hide();$(this).next("span").show()})},analysis:function(){$("body").on("click","#anisys_select",function(){var filename=$.filenameGet();var searchinfo=$.searchinfoGet();var pathAnalysis=$("#pathAnalysisHid").val();if(!filename){alert(message.selectLiterature);return false}var param2={formfilenames:filename,searchinfo:searchinfo};$.PostWindow(pathAnalysis,param2,"KvisualAnalysis")});$("body").on("click","#anisys_all",function(){var json=briefParam._getSearchJson();var searchSql=briefParam._getSearchSql();var dbCode=briefParam._getDbCode();var param2={json:json,searchSql:searchSql,dbCode:dbCode};$.PostWindow(APPPATH+"/Visual/Center",param2)})},exportClickEvnt:function(){$("body").on("click",".dropdown-analysis-btns li.export ul.secondUl li",function(){if($("#selectCount").text()==="0"){layer.alert(message.selectLiterature,{btn:message.Confirm,title:message.info});return false}var exportType=$(this).find("a").attr("exportType");var url=APPPATH+"/manage/export.html?displaymode="+exportType+(GetQueryStringByName("subject")?"&subject="+GetQueryStringByName("subject"):"");window.open(url)})}};var setDownload={setDownloadCls:function(jsonObj){if(jsonObj==null){return}var tableList=$("#gridTable .result-table-list");var detailList=$("#gridTable .result-detail-list");var dbpageList=$("div.fl>dl.detail-list");if(!!tableList&&tableList.find("tbody>tr").length>0){$.each(tableList.find("tbody>tr"),function(index,item){setDownload._setDownCls(index,item,jsonObj)})}else{if(!!detailList&&detailList.find("dd").length>0){$.each(detailList.find("dd"),function(index,item){setDownload._setDownCls(index,item,jsonObj)})}else{if(!!dbpageList&&dbpageList.find("dd").length>0){$.each(dbpageList.find("dd"),function(index,item){setDownload._setDownCls(index,item,jsonObj)})}}}},_setDownCls:function(index,item,jsonObj){var $this=$(item);var curRec=$this.find(".seq>.cbItem").attr("data-cur");var downObj=$this.find(".downloadlink");var downClass;var downTitle;var downShowName;var downHref;var rightTag=!!curRec?jsonObj[curRec]:jsonObj[index+1];if(!!rightTag){switch(rightTag[0]){case"1":downClass="icon-download";downTitle=message.downLoad;downShowName=message.downLoad;break;case"-1":downClass="icon-notlogged";downTitle=message.unlogin;downShowName=message.downLoad;break;case"0":downClass="icon-nodownperm";downTitle=!!rightTag[1]?rightTag[1]:message.unorder;downShowName=message.downLoad;downHref="javascript:void(0);";break}if(!!downClass){downObj.removeClass().addClass("downloadlink "+downClass)}if(!!downTitle){downObj.attr("title",downTitle)}if(!!downShowName){downObj.find("b").text(downShowName)}if(!!downHref){downObj.attr("href",downHref)}}}};window.BriefExtend=window.$.BriefExtend=briefExtend;window.BriefParam=window.$.BriefParam=briefParam})(jQuery); 
 var cnkiSearch=(function(a){this.OperateType={SEARCH:0,RESULTSEARCH:1,GROUP:2,ORDER:3,NAVI:4};this.Logic={NONE:0,AND:1,OR:2,NOT:3,HighLogic:4};this.ExtendType={NONE:0,XLS:1,Between:2,CP:3,SEN:4,NEAR:5,SUB:6,PREV:7,AFT:8,PEG:9,ADDQuery:10,DBSource:11,Expert:12,Composite:13,NoExtend:14};this.QueryState=function(){this.Platform="";this.DBCode="";this.KuaKuCode="";this.QNode=new KBQueryModel()};this.KBQueryModel=function(){this.QGroup=[]};this.QueryGroup=function(){this.Key="",this.Title="",this.Logic=Logic.AND,this.Items=[],this.ChildItems=[]};this.QueryItem=function(){this.Key="",this.Title="",this.Logic=Logic.AND,this.Name="",this.Operate="",this.Value="",this.ExtendType=ExtendType.NONE,this.ExtendValue="",this.Value2="",this.BlurType=""};this.ReductionGroup=[];this.ReductionItem=function(){this.Key="",this.Logic=Logic.AND,this.Field="",this.Value="",this.AttrSearchWord="",this.AttrCheckedcode="",this.AttrAuthorcode="",this.AttrAuthorunit="",this.AttrFiled="",this.AttrTxt="";this.Freq="",this.Type="=",this.isCheckBox=false,this.isDropBox=false};this.SearchQueryState=new this.QueryState();this.findQG=function(b,e){if(!(b&&e)){return null}var d=new Array();var c="";var f="";if(e.indexOf("/")>=0){c=e.substring(0,e.indexOf("/"));f=e.substring(e.indexOf("/")+1)}else{c=e}if(b.length&&b.length>0){for(i=0;i<b.length;i++){if(b[i].Key==c){if(!f){d.push(b[i])}else{return this.findQG(b[i],f)}}}}if(b.ChildItems&&b.ChildItems.length>0){for(i=0;i<b.ChildItems.length;i++){if(b.ChildItems[i].Key==c){if(!f){d.push(b.ChildItems[i])}else{return this.findQG(b.ChildItems[i],f)}}}}if(b.Items&&b.Items.length>0){for(i=0;i<b.Items.length;i++){if(b.Items[i].Key==c){if(!f){d.push(b.Items[i])}else{return this.findQG(b.Items[i],f)}}}}return d.length==0?null:d};this.chechkQgroup=function(b){if(b.ChildItems&&b.ChildItems.length>0){for(var d=0;d<b.ChildItems.length;d++){return isHasValQuery(b.ChildItems[d])}}var c=[],f;a(".nav-content-list .icon-select.selected").each(function(){c.push(a(this).siblings(".icon").attr("id")+"?")});if(!c||c.length==0){f="A?+B?+C?+D?+E?+F?+G?+H?+I?+J?"}else{f=c.join("+")}if(b.Items&&b.Items.length>0){for(var e=0;e<b.Items.length;e++){if(b.Items[e].Key&&typeof(b.Items[e].Key)=="string"&&b.Items[e].Key.toLocaleLowerCase()=="navi"){if(b.Items[e].Value&&b.Items[e].Value==c&&c!=f){return false}}if(b.Items[e].Name&&b.Items[e].Value){return true}if(b.Items[e].Key=="Expert"&&b.Items[e].Value){return true}}}return false};this.isHasValQuery=function(d){if(typeof d=="undefined"){return false}if(typeof d.QNode!="undefined"){var e=d.QNode.QGroup;var f=false,b;for(var c=0;c<e.length;c++){b=e[c];f=chechkQgroup(b);if(f){return true}}if(!!d.View){return true}a("input[type=text]").blur();return false}else{if(!!d){return chechkQgroup(d)}else{a("input[type=text]").blur();return false}}};this.getNode=function(b,e,m){if(!b){return null}if(!e){return b}var g=e.split("/");for(var k=0;k<g.length;k++){var f=null;if(Object.prototype.toString.call(b)=="[object Array]"){for(var c=0;c<b.length;c++){if(b[c].Key==g[k]&&g.length>0){g.shift();var l=g;var h="";if(Object.prototype.toString.call(l)=="[object String]"){h=l}else{h=l.join("/")}return arguments.callee(b[c],h,m)}}}else{f=findQG(b,g[k]);if(b.ChildItems){var d=b.ChildItems.length;while(d--){if(b.ChildItems[d].Key==g[g.length-1]){return b.ChildItems[d]}}}if(typeof(f)!="undefined"&&f!=""){g.shift();if(g.length==0&&m!=true){return f}if(g.length!=0){return arguments.callee(f,g.join("/"),m)}}}}if(m==true){return b}};return{GroupName:{NAVI:"NaviParam",SUBJECT:"Subject",MutiGroup:"MutiGroup",SCDBGroup:"SCDBGroup",CONTROLGROUP:"ControlGroup"},ExtendType:this.ExtendType,Logic:this.Logic,getReductionItem:function(){return new ReductionItem()},getQueryItem:function(){return new QueryItem()},getQueryGroup:function(){return new QueryGroup()},getRootQueryGroup:function(d){if(SearchQueryState.QNode.QGroup.length>0){for(var c=0;c<SearchQueryState.QNode.QGroup.length;c++){if(SearchQueryState.QNode.QGroup[c].Key==d){return SearchQueryState.QNode.QGroup[c]}}}var b=this.getQueryGroup();b.Key=d;SearchQueryState.QNode.QGroup.push(b);return b},resetSearchQueryState:function(){SearchQueryState=new QueryState();SearchQueryState.Platform=GetQueryStringByName("subject")},setQueryState:function(c,b){SearchQueryState[c]=b},setDbCode:function(b){SearchQueryState.DBCode=b},setPlatformName:function(b){SearchQueryState.Platform=b},setKuaKuCode:function(b){SearchQueryState.KuaKuCode=b},setDbView:function(b){SearchQueryState.View=b},getDbView:function(){return SearchQueryState.View},getDbCode:function(b){return SearchQueryState.DBCode},getKuaKuCode:function(b){return SearchQueryState.KuaKuCode},getSearchJsonInfo:function(){try{return JSON.stringify(SearchQueryState)}catch(b){return""}},addQueryNode:function(d,b){var e=d.split("/");var f=SearchQueryState.QNode.QGroup;for(var g=0;g<e.length;g++){var c=findQG(f,e[g].split(".")[0]);if(c&&c.length>0){f=c[0];continue}else{c=new QueryGroup();c.Key=e[g].split(".")[0];if(e[g].split(".").length>1){c.Logic=e[g].split(".")[1]}if(f.ChildItems){f.ChildItems.push(c)}else{SearchQueryState.QNode.QGroup.push(c)}f=c}}if(f){if(Object.prototype.toString.call(b)==="[object Array]"){for(var g=0;g<b.length;g++){f.Items.push(b[g])}}else{f.Items.push(b)}}},delQueryNode:function(e,b){if(!b){var d;var h;if(e.lastIndexOf("/")>-1){h=e.substring(e.lastIndexOf("/")+1);e=e.substring(0,e.lastIndexOf("/"));d=findQG(SearchQueryState.QNode.QGroup,e);if(d&&d.length>0&&d[0].ChildItems&&d[0].ChildItems.length>0){d=d[0].ChildItems}}else{d=SearchQueryState.QNode.QGroup;h=e}if(d!=null){if(d||d.length>0){for(var f=0;f<d.length;f++){if(d[f].Key==h){d.splice(f,1);break}}}}}else{var d=findQG(SearchQueryState.QNode.QGroup,e);if(!d||d.length==0||!(d instanceof Array)){return false}var g;for(var f=0;f<d.length;f++){g=d[f].Items;for(var c=0;c<g.length;c++){if(g[c].Key==b){g.splice(c,1);break}}}}},findQueryNodeByPath:function(b){return getNode(SearchQueryState.QNode.QGroup,b)},isHasValQuery:this.isHasValQuery}})(jQuery); 
 function getResourceGroup(d){var a=cnkiSearch.getDbCode();var b=$("#isscdb").val();if(b=="1"&&a!="SCDB"&&a!="CFLS"&&a!="WWDB"){return}else{if(a!="SCDB"&&a!="CFLS"&&a!="WWDB"&&b=="0"){$("div.top-doctype").find("em").text("");return}}var c=cnkiSearch.getSearchJsonInfo();$.post(APPPATH+"/Group/ResGroup",{queryJson:c,handleid:d},function(e){$("div.top-doctype").find("em").text("");if(typeof(e)!="undefined"&&e!=""){if(e[a]=="0"){return}var h=cnkiSearch.getKuaKuCode();if(typeof(h)!=undefined&&$.trim(h)!=""){var f=h.split(",");if(f.length>0){f.push("SCDB");var j="";for(var g=0;g<f.length;g++){j=f[g];$("div.top-doctype a[dbcode='"+j+"']").find("em").text(typeof(e[j])!="undefined"?e[j]:"0");$("div.top-doctype a[prcode='"+j+"']").each(function(){var i=$(this).attr("dbcode");if(typeof(i)!="undefined"&&i!=""){$("div.top-doctype a[dbcode='"+i+"']").find("em").text(typeof(e[i])!="undefined"?e[i]:"0")}})}}}else{$("div.top-doctype").find("a[name='dbcode']").each(function(){var i=$(this).attr("dbcode");if(typeof(i)!="undefined"&&i!=""){$(this).find("em").text(typeof(e[i])!="undefined"?e[i]:"0")}})}}})}function getGroupResult(b){var c=sessionCookieUnit.getCookie("knsLeftGroupTag");if(c=="0"){$(".icon-arrow-filter").show();filterBoxFold();return}else{$("#divGroup").parent().parent().removeClass("is-filter-off").addClass("is-filter-on")}$("div.sidebar-filter").show();$(".sidebar-filter").showLoading();var a=cnkiSearch.getSearchJsonInfo();$.post(APPPATH+"/Group/Result",{queryJson:a},function(d){$("#divGroup").html(d);$(".sidebar-filter").hideLoading();new filterFn();renderSelectedGroupItem();$(".icon-arrow-filter").show();filterBoxFold()}).error(function(f,d,e){$(".sidebar-filter").hideLoading()})}function filterBoxFold(){$(".sidebar-filter").off("click").on("click",".icon-arrow-filter",function(){$(this).parent().parent().toggleClass("is-filter-on is-filter-off");if($(this).parent().parent().hasClass("is-filter-on")){sessionCookieUnit.addToCookie("knsLeftGroupTag","1");if($("#fakediv").length<1){getGroupResult()}}else{sessionCookieUnit.addToCookie("knsLeftGroupTag","0")}})}function resultHide(a){var b=a.width();objUl=a.find("ul");initH=a.outerHeight(true);if(a.closest(".exp").length>0){if(initH>=117){initH=117}else{return}}else{if(initH>=67){initH=67}else{return}}if(objUl.length==0){return}len=objUl.length;if(objUl.length>5){len=Math.ceil(objUl.length/2)}divwidth=objUl.outerWidth()*len;a.width(divwidth).slideDown(500,function(){$(this).addClass("show");a.parent().addClass("is-show").height(initH)})}function mouseout(b){var a=this;this.in_dom=function(c,d){if(c==d){return true}else{if(!c.parentNode){return false}else{if(c.parentNode==d){return true}else{return a.in_dom(c.parentNode,d)}}}};$(b).mouseleave(function(d){var d=arguments[0]||window.event;var c=d.relatedTarget||d.toElement;if(!a.in_dom($(c),b)){$(b).attr("style","").removeClass("show");$(b).parent().attr("style","").removeClass("is-show")}})}function setDateItem(b){var a=$("a.btn-visual").attr("tit");var c=$("a.btn-visual").attr("field");if(setDateItemToJson(a,c)){$.BriefExtend.searchCallBackFun(true);getGroupResult();if(typeof(b)=="function"){b()}}}function setDateItemToJson(f,d){var e=$("#txtStartYear").val();var h=$("#txtEndYear").val();var a=/^(\d{4})$/;if($.trim(e)==""){alert(message.enterStaringYear);return false}if($.trim(h)==""){alert(message.enterEndingYear);return false}if(!a.test(e)){alert(message.enterCorrectStaringYear);return false}if(!a.test(h)){alert(message.enterCorrectEndingYear);return false}if(h<e){alert(message.yearIncorrect);return false}var i=$("#isscdb").val()=="1"&&cnkiSearch.getDbCode()=="SCDB";var g=(i?cnkiSearch.GroupName.SCDBGroup:cnkiSearch.GroupName.MutiGroup)+"/"+f+d;var b=cnkiSearch.getQueryItem();b.Key=e+"-"+h;b.Title=b.Key;if(cnkiSearch.getDbCode()=="CYFD"){if(e<=1949){alert(message.yearLaterThan1949);return false}var c=new Date().getFullYear();if(h>c){alert(message.yearNotBeLaterCurrentYear);return false}b.Name="年鉴年份";b.Value=getYearString(e,h);b.ExtendType=cnkiSearch.ExtendType.Composite}else{b.Name=d;b.Value=e;b.Value2=h;b.ExtendType=cnkiSearch.ExtendType.Between}cnkiSearch.delQueryNode(g);cnkiSearch.addQueryNode(g,b);return true}function getYearString(a,c){var b="";for(a;a<=c;a++){b+="'"+a+"'+"}if(b.length>0){return b.substr(0,b.length-1)}return""}function setDateKeyUp(a){if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}if(a.keyCode==13){$(".visual-row a").click()}}function mutiSelectedGroup(){var b=$("#isscdb").val();if(b=="1"&&cnkiSearch.getDbCode()=="SCDB"){cnkiSearch.delQueryNode(cnkiSearch.GroupName.SCDBGroup)}else{if(b=="0"){cnkiSearch.delQueryNode(cnkiSearch.GroupName.SCDBGroup)}}cnkiSearch.delQueryNode(cnkiSearch.GroupName.MutiGroup);$("#divGroup").find("dl").each(function(){var e=$(this);var g=[];var f=e.attr("groupId");e.find("dd").each(function(){var i,l,m,h,k;i=$(this).attr("tit");l=$(this).attr("field");unicode=$(this).attr("u");k=$(this).find("input[type='checkbox']:checked");if(k&&k.length>0){var j;k.each(function(){m=$(this).attr("text");h=$(this).attr("value");if(l=="专题子栏目代码"||l=="SUBJECT_CODE"||l=="行业分类代码"){h=h+"?"}j=cnkiSearch.getQueryItem();j.Key=h;j.Name=l;j.Title=m;if(unicode=="1"&&!/^[A-Za-z0-9 -_+=().,;!@#$%&*]*$/.test(h)){j.Value=escape(h).replace(/(%u)(\w{4})/gi,"&#x$2;")}else{j.Value=h}j.Logic=cnkiSearch.Logic.OR;if(h.indexOf("+")>0&&m!=h){j.ExtendType=cnkiSearch.ExtendType.Composite}else{if(m!=h){j.ExtendType=cnkiSearch.ExtendType.NoExtend}}g.push(j)})}});if(g.length>0){cnkiSearch.addQueryNode((cnkiSearch.getDbCode()=="SCDB"?cnkiSearch.GroupName.SCDBGroup:cnkiSearch.GroupName.MutiGroup)+"/"+f,g)}});if($("a.btn-visual").length>0&&$("a.btn-visual").attr("value")!=""){var a=$("a.btn-visual").attr("tit");var d=$("a.btn-visual").attr("field");setDateItemToJson(a,d)}var c=cnkiSearch.getSearchJsonInfo();$.BriefExtend.searchCallBackFun(true);getGroupResult();if($(".back-top").css("display")!="none"){$(".back-top").click()}}function renderSelectedGroupItem(b){$("#divGroup").find("dl").each(function(){var m=$(this);var t=m.attr("groupId");if(!!b&&b!=t){return true}var r=cnkiSearch.findQueryNodeByPath("SCDBGroup");if(typeof(r)!="undefined"&&typeof(r.ChildItems)!="undefined"&&r.ChildItems.length>0){for(var o=0;o<r.ChildItems.length;o++){var w=r.ChildItems[o];if(typeof(w.Items)!="undefined"&&w.Items.length>0){for(var k=0;k<w.Items.length;k++){var u;if(w.Items[k].Name!="人工标识码"){u=w.Items[k].Key.replace("?","")}else{u=w.Items[k].Key}var y=w.Items[k].Title;var q=w.Items[k].Name;m.find("dd[field='"+q+"']").find("input[text='"+y+"'][value='"+u+"']").attr("checked",true);$("div.sidebar-filter-btns").removeClass("disableclick")}}}}var l=cnkiSearch.findQueryNodeByPath("MutiGroup/"+t);if(l!=null&&l.Items.length>0){for(var k=0;k<l.Items.length;k++){var u=l.Items[k].Key.replace("?","");var y=l.Items[k].Title;var q=l.Items[k].Name;m.find("dd[field='"+q+"']").find("input[text='"+y+"'][value='"+u+"']").attr("checked",true);$("div.sidebar-filter-btns").removeClass("disableclick")}}if(m.find("dd").length>1){var n=m.find("dt.tit");var v=m.find("dt.subtit");var p=-1;var s=false;m.find("dd").each(function(){p++;if($(this).find("input[type='checkbox']:checked").length>0){s=true;v.find("a").removeClass("cur");v.find("a:eq("+p+")").addClass("cur");if(typeof(n)!=null&&n.length>0){n.attr("groupitem",v.find("a.cur").text())}m.find("dd").hide();$(this).css("display","");return false}});if(s==false){p=-1;if(m.hasClass("is-up-fold")){return}m.find("dd").each(function(){p++;if($(this).find("li").length>0){v.find("a").removeClass("cur");v.find("a:eq("+p+")").addClass("cur");if(typeof(n)!=null&&n.length>0){n.attr("groupitem",v.find("a.cur").text())}m.find("dd").hide();m.find("dd:eq("+p+")").css("display","");return false}})}}});if(!!b){return}var e=$("a.btn-visual").attr("tit");var g=$("a.btn-visual").attr("field");if(typeof(e)=="undefined"||typeof(g)=="undefined"){return}var j=cnkiSearch.GroupName.SCDBGroup+"/"+e+g;var c=cnkiSearch.GroupName.MutiGroup+"/"+e+g;var i;var a=cnkiSearch.findQueryNodeByPath(c);var d=cnkiSearch.findQueryNodeByPath(j);if(!!a&&!!a.Items&&!!a.Items[0]){i=a.Items[0].Key}else{if(!!d&&!!d.Items&&!!d.Items[0]){i=d.Items[0].Key}}if(!!i){var h=i.split("-")[0];var f=i.split("-")[1];$("#txtStartYear").val(h);$("#txtEndYear").val(f);$("a.btn-visual").attr("title",message.selected+message.year+":"+i);$("a.btn-visual").attr("value",i)}else{$("#txtStartYear").val("");$("#txtEndYear").val("");$("a.btn-visual").attr("title",$("a.btn-visual").text());$("a.btn-visual").attr("value","")}}function filterFn(){this.filterBox=$(".sidebar-filter");if(this.filterBox.length==0){return}this.filterBtns=this.filterBox.find(".sidebar-filter-btns");this.visualBtn=this.filterBox.find(".btn-visual");this.init()}filterFn.prototype={init:function(){this.yAxisfold();this.subTitSwitch();this.winScroll();this.clearAllChecked();this.clickItem()},yAxisfold:function(){var a=this;a.filterBox.find("dl>dt.tit").off("click").on("click",function(c){c.preventDefault();parentDl=$(this).closest("dl");if(!$(this).parent().hasClass("is-up-fold")){if(parentDl.find("div.resultlist").html()!=""){$(this).parent().addClass("is-up-fold off");filterFn.prototype.filterBtnsMoveTop(this);return}}parentDl.removeClass("is-up-fold off");if(parentDl.find("ul").length>0){return}var b=$(this).attr("groupid");var e=sessionCookieUnit.getCookie("knsLeftGroupSelectItem");if(typeof(e)!="undefined"&&e!=""){sessionCookieUnit.addToCookie("knsLeftGroupSelectItem",e+b+";")}else{sessionCookieUnit.addToCookie("knsLeftGroupSelectItem",b+";")}var d=cnkiSearch.getSearchJsonInfo();parentDl.showLoading();$.post(APPPATH+"/Group/SingleResult",{queryJson:d,groupId:b},function(f){parentDl.find("dt.subtit").remove();parentDl.find("dd").remove();parentDl.hideLoading();parentDl.append(f);renderSelectedGroupItem(b)}).error(function(h,f,g){parentDl.hideLoading()})})},subTitSwitch:function(){var a=this;a.filterBox.find("dt.subtit a").on("click",function(b){var c=$(this).text();if(c=="科技"){dblist.SwapDblist(0)}else{if(c=="社科"){dblist.SwapDblist(1)}}parentDl=$(this).closest("dl");var d=parentDl.find("dt.tit");if(d!=null&&d.length>0){d.attr("groupitem",c)}if($(this).hasClass("cur")){parentDl.toggleClass("off")}else{$(this).addClass("cur").siblings().removeClass("cur");_index=$(this).index();dd=$(this).parent().siblings("dd");dd.eq(_index).attr("style","").siblings("dd").hide()}})},clickItem:function(){var a=this;a.filterBox.find("li a,li span").on("click",function(){$(this).parent().find("input").prop("checked",function(b,c){return !c});a._filterBtnsMove(this)});a.filterBox.find("li input[type=checkbox]").on("click",function(){a._filterBtnsMove(this)})},_filterBtnsMove:function(a){scrollTop=document.body.scrollTop||document.documentElement.scrollTop;aTop=$(a).parent().offset().top;filterTop=this.filterBox.offset().top;filterBtnsTop=this.filterBtns.offset().top;len=$(a).closest(".js-condition").find("input[type=checkbox]:checked").length;if(len>0){this.filterBtns.removeClass("disableclick")}else{this.filterBtns.addClass("disableclick")}goalTop=aTop-filterTop-(this.filterBtns.find("a").eq(0).outerHeight()-$(a).parent().height())/2;this.filterBtns.animate({top:goalTop},200)},filterBtnsMoveTop:function(a){filterTop=$(".sidebar-filter").offset().top;if(!!a){aTop=$(a).parent().offset().top;$(".sidebar-filter").find(".sidebar-filter-btns").animate({top:aTop-filterTop},200)}else{aTop=$(a).parent().offset().top;$(".sidebar-filter").find(".sidebar-filter-btns").animate({top:aTop-filterTop},200)}},clearAllChecked:function(){var a=this;a.filterBox.parent().find(".btn-clearall").click(function(){$(this).parent().parent().find("input[type=checkbox]").prop("checked",false);a.filterBtns.addClass("disableclick");$("#txtStartYear").val("");$("#txtEndYear").val("");$("a.btn-visual").attr("title",$("a.btn-visual").text());$("a.btn-visual").attr("value","")})},winScroll:function(){var a=this;var b=0;$(window).on("load scroll resize",function(){if(a.filterBtns.length==0){return}scrollTop=document.body.scrollTop||document.documentElement.scrollTop;screenH=$(window).height();filterTop=a.filterBox.offset().top;filterH=a.filterBox.height();filterBtnsH=a.filterBtns.find("a").outerHeight(true)*2;visualBtnH=a.visualBtn.outerHeight();a.visualBtn.attr("style","");minTop=filterTop;maxTop=filterTop+filterH-filterBtnsH;if(filterTop>=scrollTop+screenH-filterBtnsH){a.filterBtns.css("top","0")}if((filterTop<scrollTop+screenH-filterBtnsH)&&(scrollTop<=maxTop)){if((b<scrollTop)&&(a.filterBtns.offset().top<=scrollTop)){a.filterBtns.css("top",scrollTop-filterTop)}if((b>scrollTop)&&(a.filterBtns.offset().top>=scrollTop+screenH-filterBtnsH)){a.filterBtns.css("top",scrollTop+screenH-filterBtnsH-filterTop)}}if(scrollTop>maxTop){a.filterBtns.css("top",filterH-filterBtnsH)}footTop=$(".footer").offset().top;minScrollTop=filterTop-(screenH-visualBtnH)/2;maxScrollTop=footTop-(screenH+visualBtnH)/2;if(scrollTop<=minScrollTop){a.visualBtn.css("top",filterTop-scrollTop+visualBtnH/2)}if((scrollTop>minScrollTop)&&(scrollTop<maxScrollTop)){a.visualBtn.attr("style","")}if(scrollTop>=maxScrollTop){a.visualBtn.css("top",footTop-scrollTop-visualBtnH/2)}setTimeout(function(){b=scrollTop},0)})}}; 
 !function(m,v){var b,g,j=m.layui&&layui.define,h={getPath:function(){var a=document.currentScript?document.currentScript.src:function(){for(var o,f=document.scripts,l=f.length-1,c=l;c>0;c--){if("interactive"===f[c].readyState){o=f[c].src;break}}return o||f[l].src}();return a.substring(0,a.lastIndexOf("/")+1)}(),config:{},end:{},minIndex:0,minLeft:[],btn:["&#x786E;&#x5B9A;","&#x53D6;&#x6D88;"],type:["dialog","page","iframe","loading","tips"],getStyle:function(c,e){var a=c.currentStyle?c.currentStyle:m.getComputedStyle(c,null);return a[a.getPropertyValue?"getPropertyValue":"getAttribute"](e)},link:function(A,e,r){if(q.path){var w=document.getElementsByTagName("head")[0],z=document.createElement("link");"string"==typeof e&&(r=e);var o=(r||A).replace(/\.|\//g,""),y="layuicss-"+o,x=0;z.rel="stylesheet",z.href=q.path+A,z.id=y,document.getElementById(y)||w.appendChild(z),"function"==typeof e&&!function B(){return ++x>80?m.console&&console.error("layer.css: Invalid"):void (1989===parseInt(h.getStyle(document.getElementById(y),"width"))?e():setTimeout(B,100))}()}}},q={v:"3.1.1",ie:function(){var a=navigator.userAgent.toLowerCase();return !!(m.ActiveXObject||"ActiveXObject" in m)&&((a.match(/msie\s(\d+)/)||[])[1]||"11")}(),index:m.layer&&m.layer.v?100000:0,path:h.getPath,config:function(c,a){return c=c||{},q.cache=h.config=b.extend({},h.config,c),q.path=h.config.path||q.path,"string"==typeof c.extend&&(c.extend=[c.extend]),h.config.path&&q.ready(),c.extend?(j?layui.addcss("modules/layer/"+c.extend):h.link("theme/"+c.extend),this):this},ready:function(a){},alert:function(l,f,c){var i="function"==typeof f;return i&&(c=f),q.open(b.extend({content:l,yes:c},i?{}:f))},confirm:function(o,i,f,l){var c="function"==typeof i;return c&&(l=f,f=i),q.open(b.extend({content:o,btn:h.btn,yes:f,btn2:l},c?{}:i))},msg:function(w,l,r){var i="function"==typeof l,x=h.config.skin,t=(x?x+" "+x+"-msg":"")||"layui-layer-msg",o=d.anim.length-1;return i&&(r=l),q.open(b.extend({content:w,time:3000,shade:!1,skin:t,title:!1,closeBtn:!1,btn:!1,resize:!1,end:r},i&&!h.config.skin?{skin:t+" layui-layer-hui",anim:o}:function(){return l=l||{},(l.icon===-1||l.icon===v&&!h.config.skin)&&(l.skin=t+" "+(l.skin||"layui-layer-hui")),l}()))},load:function(c,a){return q.open(b.extend({type:3,icon:c||0,resize:!1,shade:0.01},a))},tips:function(f,c,a){return q.open(b.extend({type:4,content:[f,c],closeBtn:!1,time:3000,shade:!1,resize:!1,fixed:!1,maxWidth:210},a))}},u=function(c){var a=this;a.index=++q.index,a.config=b.extend({},a.config,h.config,c),document.body?a.creat():setTimeout(function(){a.creat()},30)};u.pt=u.prototype;var d=["layui-layer",".layui-layer-title",".layui-layer-main",".layui-layer-dialog","layui-layer-iframe","layui-layer-content","layui-layer-btn","layui-layer-close"];d.anim=["layer-anim-00","layer-anim-01","layer-anim-02","layer-anim-03","layer-anim-04","layer-anim-05","layer-anim-06"],u.pt.config={type:0,shade:0.3,fixed:!0,move:d[1],title:"&#x4FE1;&#x606F;",offset:"auto",area:"auto",closeBtn:1,time:0,zIndex:19891014,maxWidth:360,anim:0,isOutAnim:!0,icon:-1,moveType:1,resize:!0,scrollbar:!0,tips:2},u.pt.vessel=function(w,A){var i=this,l=i.index,y=i.config,z=y.zIndex+l,x="object"==typeof y.title,o=y.maxmin&&(1===y.type||2===y.type),B=y.title?'<div class="layui-layer-title" style="'+(x?y.title[1]:"")+'">'+(x?y.title[0]:y.title)+"</div>":"";return y.zIndex=z,A([y.shade?'<div class="layui-layer-shade" id="layui-layer-shade'+l+'" times="'+l+'" style="'+("z-index:"+(z-1)+"; ")+'"></div>':"",'<div class="'+d[0]+(" layui-layer-"+h.type[y.type])+(0!=y.type&&2!=y.type||y.shade?"":" layui-layer-border")+" "+(y.skin||"")+'" id="'+d[0]+l+'" type="'+h.type[y.type]+'" times="'+l+'" showtime="'+y.time+'" conType="'+(w?"object":"string")+'" style="z-index: '+z+"; width:"+y.area[0]+";height:"+y.area[1]+(y.fixed?"":";position:absolute;")+'">'+(w&&2!=y.type?"":B)+'<div id="'+(y.id||"")+'" class="layui-layer-content'+(0==y.type&&y.icon!==-1?" layui-layer-padding":"")+(3==y.type?" layui-layer-loading"+y.icon:"")+'">'+(0==y.type&&y.icon!==-1?'<i class="layui-layer-ico layui-layer-ico'+y.icon+'"></i>':"")+(1==y.type&&w?"":y.content||"")+'</div><span class="layui-layer-setwin">'+function(){var a=o?'<a class="layui-layer-min" href="javascript:;"><cite></cite></a><a class="layui-layer-ico layui-layer-max" href="javascript:;"></a>':"";return y.closeBtn&&(a+='<a class="layui-layer-ico '+d[7]+" "+d[7]+(y.title?y.closeBtn:4==y.type?"1":"2")+'" href="javascript:;"></a>'),a}()+"</span>"+(y.btn?function(){var f="";"string"==typeof y.btn&&(y.btn=[y.btn]);for(var a=0,c=y.btn.length;a<c;a++){f+='<a class="'+d[6]+a+'">'+y.btn[a]+"</a>"}return'<div class="'+d[6]+" layui-layer-btn-"+(y.btnAlign||"")+'">'+f+"</div>"}():"")+(y.resize?'<span class="layui-layer-resize"></span>':"")+"</div>"],B,b('<div class="layui-layer-move"></div>')),i},u.pt.creat=function(){var w=this,l=w.config,o=w.index,i=l.content,x="object"==typeof i,r=b("body");if(!l.id||!b("#"+l.id)[0]){switch("string"==typeof l.area&&(l.area="auto"===l.area?["",""]:[l.area,""]),l.shift&&(l.anim=l.shift),6==q.ie&&(l.fixed=!1),l.type){case 0:l.btn="btn" in l?l.btn:h.btn[0],q.closeAll("dialog");break;case 2:var i=l.content=x?l.content:[l.content||"http://layer.layui.com","auto"];l.content='<iframe scrolling="'+(l.content[1]||"auto")+'" allowtransparency="true" id="'+d[4]+o+'" name="'+d[4]+o+'" onload="this.className=\'\';" class="layui-layer-load" frameborder="0" src="'+l.content[0]+'"></iframe>';break;case 3:delete l.title,delete l.closeBtn,l.icon===-1&&0===l.icon,q.closeAll("loading");break;case 4:x||(l.content=[l.content,"body"]),l.follow=l.content[1],l.content=l.content[0]+'<i class="layui-layer-TipsG"></i>',delete l.title,l.tips="object"==typeof l.tips?l.tips:[l.tips,!0],l.tipsMore||q.closeAll("tips")}if(w.vessel(x,function(c,a,e){r.append(c[0]),x?function(){2==l.type||4==l.type?function(){b("body").append(c[1])}():function(){i.parents("."+d[0])[0]||(i.data("display",i.css("display")).show().addClass("layui-layer-wrap").wrap(c[1]),b("#"+d[0]+o).find("."+d[5]).before(a))}()}():r.append(c[1]),b(".layui-layer-move")[0]||r.append(h.moveElem=e),w.layero=b("#"+d[0]+o),l.scrollbar||d.html.css("overflow","hidden").attr("layer-full",o)}).auto(o),b("#layui-layer-shade"+w.index).css({"background-color":l.shade[1]||"#000",opacity:l.shade[0]||l.shade}),2==l.type&&6==q.ie&&w.layero.find("iframe").attr("src",i[0]),4==l.type?w.tips():w.offset(),l.fixed&&g.on("resize",function(){w.offset(),(/^\d+%$/.test(l.area[0])||/^\d+%$/.test(l.area[1]))&&w.auto(o),4==l.type&&w.tips()}),l.time<=0||setTimeout(function(){q.close(w.index)},l.time),w.move().callback(),d.anim[l.anim]){var n="layer-anim "+d.anim[l.anim];w.layero.addClass(n).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){b(this).removeClass(n)})}l.isOutAnim&&w.layero.data("isOutAnim",!0)}},u.pt.auto=function(r){var y=this,l=y.config,i=b("#"+d[0]+r);""===l.area[0]&&l.maxWidth>0&&(q.ie&&q.ie<8&&l.btn&&i.width(i.innerWidth()),i.outerWidth()>l.maxWidth&&i.width(l.maxWidth));var x=[i.innerWidth(),i.innerHeight()],w=i.find(d[1]).outerHeight()||0,n=i.find("."+d[6]).outerHeight()||0,z=function(a){a=i.find(a),a.height(x[1]-w-n-2*(0|parseFloat(a.css("padding-top"))))};switch(l.type){case 2:z("iframe");break;default:""===l.area[1]?l.maxHeight>0&&i.outerHeight()>l.maxHeight?(x[1]=l.maxHeight,z("."+d[5])):l.fixed&&x[1]>=g.height()&&(x[1]=g.height(),z("."+d[5])):z("."+d[5])}return y},u.pt.offset=function(){var n=this,c=n.config,l=n.layero,f=[l.outerWidth(),l.outerHeight()],r="object"==typeof c.offset;n.offsetTop=(g.height()-f[1])/2,n.offsetLeft=(g.width()-f[0])/2,r?(n.offsetTop=c.offset[0],n.offsetLeft=c.offset[1]||n.offsetLeft):"auto"!==c.offset&&("t"===c.offset?n.offsetTop=0:"r"===c.offset?n.offsetLeft=g.width()-f[0]:"b"===c.offset?n.offsetTop=g.height()-f[1]:"l"===c.offset?n.offsetLeft=0:"lt"===c.offset?(n.offsetTop=0,n.offsetLeft=0):"lb"===c.offset?(n.offsetTop=g.height()-f[1],n.offsetLeft=0):"rt"===c.offset?(n.offsetTop=0,n.offsetLeft=g.width()-f[0]):"rb"===c.offset?(n.offsetTop=g.height()-f[1],n.offsetLeft=g.width()-f[0]):n.offsetTop=c.offset),c.fixed||(n.offsetTop=/%$/.test(n.offsetTop)?g.height()*parseFloat(n.offsetTop)/100:parseFloat(n.offsetTop),n.offsetLeft=/%$/.test(n.offsetLeft)?g.width()*parseFloat(n.offsetLeft)/100:parseFloat(n.offsetLeft),n.offsetTop+=g.scrollTop(),n.offsetLeft+=g.scrollLeft()),l.attr("minLeft")&&(n.offsetTop=g.height()-(l.find(d[1]).outerHeight()||0),n.offsetLeft=l.css("left")),l.css({top:n.offsetTop,left:n.offsetLeft})},u.pt.tips=function(){var w=this,A=w.config,l=w.layero,i=[l.outerWidth(),l.outerHeight()],y=b(A.follow);y[0]||(y=b("body"));var z={width:y.outerWidth(),height:y.outerHeight(),top:y.offset().top,left:y.offset().left},x=l.find(".layui-layer-TipsG"),n=A.tips[0];A.tips[1]||x.remove(),z.autoLeft=function(){z.left+i[0]-g.width()>0?(z.tipLeft=z.left+z.width-i[0],x.css({right:12,left:"auto"})):z.tipLeft=z.left},z.where=[function(){z.autoLeft(),z.tipTop=z.top-i[1]-10,x.removeClass("layui-layer-TipsB").addClass("layui-layer-TipsT").css("border-right-color",A.tips[1])},function(){z.tipLeft=z.left+z.width+10,z.tipTop=z.top,x.removeClass("layui-layer-TipsL").addClass("layui-layer-TipsR").css("border-bottom-color",A.tips[1])},function(){z.autoLeft(),z.tipTop=z.top+z.height+10,x.removeClass("layui-layer-TipsT").addClass("layui-layer-TipsB").css("border-right-color",A.tips[1])},function(){z.tipLeft=z.left-i[0]-10,z.tipTop=z.top,x.removeClass("layui-layer-TipsR").addClass("layui-layer-TipsL").css("border-bottom-color",A.tips[1])}],z.where[n-1](),1===n?z.top-(g.scrollTop()+i[1]+16)<0&&z.where[2]():2===n?g.width()-(z.left+z.width+i[0]+16)>0||z.where[3]():3===n?z.top-g.scrollTop()+z.height+i[1]+16-g.height()>0&&z.where[0]():4===n&&i[0]+16-z.left>0&&z.where[1](),l.find("."+d[5]).css({"background-color":A.tips[1],"padding-right":A.closeBtn?"30px":""}),l.css({left:z.tipLeft-(A.fixed?g.scrollLeft():0),top:z.tipTop-(A.fixed?g.scrollTop():0)})},u.pt.move=function(){var w=this,n=w.config,o=b(document),i=w.layero,y=i.find(n.move),x=i.find(".layui-layer-resize"),r={};return n.move&&y.css("cursor","move"),y.on("mousedown",function(a){a.preventDefault(),n.move&&(r.moveStart=!0,r.offset=[a.clientX-parseFloat(i.css("left")),a.clientY-parseFloat(i.css("top"))],h.moveElem.css("cursor","move").show())}),x.on("mousedown",function(a){a.preventDefault(),r.resizeStart=!0,r.offset=[a.clientX,a.clientY],r.area=[i.outerWidth(),i.outerHeight()],h.moveElem.css("cursor","se-resize").show()}),o.on("mousemove",function(t){if(r.moveStart){var s=t.clientX-r.offset[0],c=t.clientY-r.offset[1],A="fixed"===i.css("position");if(t.preventDefault(),r.stX=A?0:g.scrollLeft(),r.stY=A?0:g.scrollTop(),!n.moveOut){var z=g.width()-i.outerWidth()+r.stX,e=g.height()-i.outerHeight()+r.stY;s<r.stX&&(s=r.stX),s>z&&(s=z),c<r.stY&&(c=r.stY),c>e&&(c=e)}i.css({left:s,top:c})}if(n.resize&&r.resizeStart){var s=t.clientX-r.offset[0],c=t.clientY-r.offset[1];t.preventDefault(),q.style(w.index,{width:r.area[0]+s,height:r.area[1]+c}),r.isResize=!0,n.resizing&&n.resizing(i)}}).on("mouseup",function(a){r.moveStart&&(delete r.moveStart,h.moveElem.hide(),n.moveEnd&&n.moveEnd(i)),r.resizeStart&&(delete r.resizeStart,h.moveElem.hide())}),w},u.pt.callback=function(){function l(){var a=i.cancel&&i.cancel(f.index,c);a===!1||q.close(f.index)}var f=this,c=f.layero,i=f.config;f.openLayer(),i.success&&(2==i.type?c.find("iframe").on("load",function(){i.success(c,f.index)}):i.success(c,f.index)),6==q.ie&&f.IE6(c),c.find("."+d[6]).children("a").on("click",function(){var n=b(this).index();if(0===n){i.yes?i.yes(f.index,c):i.btn1?i.btn1(f.index,c):q.close(f.index)}else{var a=i["btn"+(n+1)]&&i["btn"+(n+1)](f.index,c);a===!1||q.close(f.index)}}),c.find("."+d[7]).on("click",l),i.shadeClose&&b("#layui-layer-shade"+f.index).on("click",function(){q.close(f.index)}),c.find(".layui-layer-min").on("click",function(){var a=i.min&&i.min(c);a===!1||q.min(f.index,i)}),c.find(".layui-layer-max").on("click",function(){b(this).hasClass("layui-layer-maxmin")?(q.restore(f.index),i.restore&&i.restore(c)):(q.full(f.index,i),setTimeout(function(){i.full&&i.full(c)},100))}),i.end&&(h.end[f.index]=i.end)},h.reselect=function(){b.each(b("select"),function(f,c){var a=b(this);a.parents("."+d[0])[0]||1==a.attr("layer")&&b("."+d[0]).length<1&&a.removeAttr("layer").show(),a=null})},u.pt.IE6=function(a){b("select").each(function(i,f){var c=b(this);c.parents("."+d[0])[0]||"none"===c.css("display")||c.attr({layer:"1"}).hide(),c=null})},u.pt.openLayer=function(){var a=this;q.zIndex=a.config.zIndex,q.setTop=function(f){var c=function(){q.zIndex++,f.css("z-index",q.zIndex+1)};return q.zIndex=parseInt(f[0].style.zIndex),f.on("mousedown",c),q.zIndex}},h.record=function(c){var a=[c.width(),c.height(),c.position().top,c.position().left+parseFloat(c.css("margin-left"))];c.find(".layui-layer-max").addClass("layui-layer-maxmin"),c.attr({area:a})},h.rescollbar=function(a){d.html.attr("layer-full")==a&&(d.html[0].style.removeProperty?d.html[0].style.removeProperty("overflow"):d.html[0].style.removeAttribute("overflow"),d.html.removeAttr("layer-full"))},m.layer=q,q.getChildFrame=function(c,a){return a=a||b("."+d[4]).attr("times"),b("#"+d[0]+a).find("iframe").contents().find(c)},q.getFrameIndex=function(a){return b("#"+a).parents("."+d[4]).attr("times")},q.iframeAuto=function(l){if(l){var f=q.getChildFrame("html",l).outerHeight(),c=b("#"+d[0]+l),i=c.find(d[1]).outerHeight()||0,r=c.find("."+d[6]).outerHeight()||0;c.css({height:f+i+r}),c.find("iframe").css({height:f})}},q.iframeSrc=function(c,a){b("#"+d[0]+c).find("iframe").attr("src",a)},q.style=function(w,A,i){var l=b("#"+d[0]+w),y=l.find(".layui-layer-content"),z=l.attr("type"),x=l.find(d[1]).outerHeight()||0,o=l.find("."+d[6]).outerHeight()||0;l.attr("minLeft");z!==h.type[3]&&z!==h.type[4]&&(i||(parseFloat(A.width)<=260&&(A.width=260),parseFloat(A.height)-x-o<=64&&(A.height=64+x+o)),l.css(A),o=l.find("."+d[6]).outerHeight(),z===h.type[2]?l.find("iframe").css({height:parseFloat(A.height)-x-o}):y.css({height:parseFloat(A.height)-x-o-parseFloat(y.css("padding-top"))-parseFloat(y.css("padding-bottom"))}))},q.min=function(r,l){var n=b("#"+d[0]+r),i=n.find(d[1]).outerHeight()||0,w=n.attr("minLeft")||181*h.minIndex+"px",o=n.css("position");h.record(n),h.minLeft[0]&&(w=h.minLeft[0],h.minLeft.shift()),n.attr("position",o),q.style(r,{width:180,height:i,left:w,top:g.height()-i,position:"fixed",overflow:"hidden"},!0),n.find(".layui-layer-min").hide(),"page"===n.attr("type")&&n.find(d[4]).hide(),h.rescollbar(r),n.attr("minLeft")||h.minIndex++,n.attr("minLeft",w)},q.restore=function(f){var c=b("#"+d[0]+f),a=c.attr("area").split(",");c.attr("type");q.style(f,{width:parseFloat(a[0]),height:parseFloat(a[1]),top:parseFloat(a[2]),left:parseFloat(a[3]),position:c.attr("position"),overflow:"visible"},!0),c.find(".layui-layer-max").removeClass("layui-layer-maxmin"),c.find(".layui-layer-min").show(),"page"===c.attr("type")&&c.find(d[4]).show(),h.rescollbar(f)},q.full=function(i){var c,f=b("#"+d[0]+i);h.record(f),d.html.attr("layer-full")||d.html.css("overflow","hidden").attr("layer-full",i),clearTimeout(c),c=setTimeout(function(){var a="fixed"===f.css("position");q.style(i,{top:a?0:g.scrollTop(),left:a?0:g.scrollLeft(),width:g.width(),height:g.height()},!0),f.find(".layui-layer-min").hide()},100)},q.title=function(f,c){var a=b("#"+d[0]+(c||q.index)).find(d[1]);a.html(f)},q.close=function(r){var l=b("#"+d[0]+r),i=l.attr("type"),o="layer-anim-close";if(l[0]){var c="layui-layer-wrap",w=function(){if(i===h.type[1]&&"object"===l.attr("conType")){l.children(":not(."+d[5]+")").remove();for(var n=l.find("."+c),e=0;e<2;e++){n.unwrap()}n.css("display",n.data("display")).removeClass(c)}else{if(i===h.type[2]){try{var t=b("#"+d[4]+r)[0];t.contentWindow.document.write(""),t.contentWindow.close(),l.find("."+d[5])[0].removeChild(t)}catch(s){}}l[0].innerHTML="",l.remove()}"function"==typeof h.end[r]&&h.end[r](),delete h.end[r]};l.data("isOutAnim")&&l.addClass("layer-anim "+o),b("#layui-layer-moves, #layui-layer-shade"+r).remove(),6==q.ie&&h.reselect(),h.rescollbar(r),l.attr("minLeft")&&(h.minIndex--,h.minLeft.push(l.attr("minLeft"))),q.ie&&q.ie<10||!l.data("isOutAnim")?w():setTimeout(function(){w()},200)}},q.closeAll=function(a){b.each(b("."+d[0]),function(){var e=b(this),c=a?e.attr("type")===a:1;c&&q.close(e.attr("times")),c=null})};var p=q.cache||{},k=function(a){return p.skin?" "+p.skin+" "+p.skin+"-"+a:""};q.prompt=function(w,i){var n="";if(w=w||{},"function"==typeof w&&(i=w),w.area){var x=w.area;n='style="width: '+x[0]+"; height: "+x[1]+';"',delete w.area}var c,y=2==w.formType?'<textarea class="layui-layer-input"'+n+">"+(w.value||"")+"</textarea>":function(){return'<input type="'+(1==w.formType?"password":"text")+'" class="layui-layer-input" value="'+(w.value||"")+'">'}(),r=w.success;return delete w.success,q.open(b.extend({type:1,btn:["&#x786E;&#x5B9A;","&#x53D6;&#x6D88;"],content:y,skin:"layui-layer-prompt"+k("prompt"),maxWidth:g.width(),success:function(a){c=a.find(".layui-layer-input"),c.focus(),"function"==typeof r&&r(a)},resize:!1,yes:function(e){var a=c.val();""===a?c.focus():a.length>(w.maxlength||500)?q.tips("&#x6700;&#x591A;&#x8F93;&#x5165;"+(w.maxlength||500)+"&#x4E2A;&#x5B57;&#x6570;",c,{tips:1}):i&&i(a,e,c)}},w))},q.tab=function(l){l=l||{};var f=l.tab||{},c="layui-this",i=l.success;return delete l.success,q.open(b.extend({type:1,skin:"layui-layer-tab"+k("tab"),resize:!1,title:function(){var r=f.length,o=1,n="";if(r>0){for(n='<span class="'+c+'">'+f[0].title+"</span>";o<r;o++){n+="<span>"+f[o].title+"</span>"}}return n}(),content:'<ul class="layui-layer-tabmain">'+function(){var r=f.length,o=1,n="";if(r>0){for(n='<li class="layui-layer-tabli '+c+'">'+(f[0].content||"no content")+"</li>";o<r;o++){n+='<li class="layui-layer-tabli">'+(f[o].content||"no  content")+"</li>"}}return n}()+"</ul>",success:function(e){var n=e.find(".layui-layer-title").children(),a=e.find(".layui-layer-tabmain").children();n.on("mousedown",function(r){r.stopPropagation?r.stopPropagation():r.cancelBubble=!0;var s=b(this),w=s.index();s.addClass(c).siblings().removeClass(c),a.eq(w).show().siblings().hide(),"function"==typeof l.change&&l.change(w)}),"function"==typeof i&&i(e)}},l))},q.photos=function(C,e,w){function i(o,f,l){var a=new Image;return a.src=o,a.complete?f(a):(a.onload=function(){a.onload=null,f(a)},void (a.onerror=function(n){a.onerror=null,l(n)}))}var B={};if(C=C||{},C.photos){var c=C.photos.constructor===Object,z=c?C.photos:{},D=z.data||[],x=z.start||0;B.imgIndex=(0|x)+1,C.img=C.img||"img";var r=C.success;if(delete C.success,c){if(0===D.length){return q.msg("&#x6CA1;&#x6709;&#x56FE;&#x7247;")}}else{var A=b(C.photos),E=function(){D=[],A.find(C.img).each(function(f){var a=b(this);a.attr("layer-index",f),D.push({alt:a.attr("alt"),pid:a.attr("layer-pid"),src:a.attr("layer-src")||a.attr("src"),thumb:a.attr("src")})})};if(E(),0===D.length){return}if(e||A.on("click",C.img,function(){var f=b(this),a=f.attr("layer-index");q.photos(b.extend(C,{photos:{start:a,data:D,tab:C.tab},full:C.full}),!0),E()}),!e){return}}B.imgprev=function(a){B.imgIndex--,B.imgIndex<1&&(B.imgIndex=D.length),B.tabimg(a)},B.imgnext=function(f,a){B.imgIndex++,B.imgIndex>D.length&&(B.imgIndex=1,a)||B.tabimg(f)},B.keyup=function(f){if(!B.end){var a=f.keyCode;f.preventDefault(),37===a?B.imgprev(!0):39===a?B.imgnext(!0):27===a&&q.close(B.index)}},B.tabimg=function(a){if(!(D.length<=1)){return z.start=B.imgIndex-1,q.close(B.index),q.photos(C,!0,a)}},B.event=function(){B.bigimg.hover(function(){B.imgsee.show()},function(){B.imgsee.hide()}),B.bigimg.find(".layui-layer-imgprev").on("click",function(a){a.preventDefault(),B.imgprev()}),B.bigimg.find(".layui-layer-imgnext").on("click",function(a){a.preventDefault(),B.imgnext()}),b(document).on("keyup",B.keyup)},B.loadi=q.load(1,{shade:!("shade" in C)&&0.9,scrollbar:!1}),i(D[x].src,function(a){q.close(B.loadi),B.index=q.open(b.extend({type:1,id:"layui-layer-photos",area:function(){var n=[a.width,a.height],l=[b(m).width()-100,b(m).height()-100];if(!C.full&&(n[0]>l[0]||n[1]>l[1])){var f=[n[0]/l[0],n[1]/l[1]];f[0]>f[1]?(n[0]=n[0]/f[0],n[1]=n[1]/f[0]):f[0]<f[1]&&(n[0]=n[0]/f[1],n[1]=n[1]/f[1])}return[n[0]+"px",n[1]+"px"]}(),title:!1,shade:0.9,shadeClose:!0,closeBtn:!1,move:".layui-layer-phimg img",moveType:1,scrollbar:!1,moveOut:!0,isOutAnim:!1,skin:"layui-layer-photos"+k("photos"),content:'<div class="layui-layer-phimg"><img src="'+D[x].src+'" alt="'+(D[x].alt||"")+'" layer-pid="'+D[x].pid+'"><div class="layui-layer-imgsee">'+(D.length>1?'<span class="layui-layer-imguide"><a href="javascript:;" class="layui-layer-iconext layui-layer-imgprev"></a><a href="javascript:;" class="layui-layer-iconext layui-layer-imgnext"></a></span>':"")+'<div class="layui-layer-imgbar" style="display:'+(w?"block":"")+'"><span class="layui-layer-imgtit"><a href="javascript:;">'+(D[x].alt||"")+"</a><em>"+B.imgIndex+"/"+D.length+"</em></span></div></div></div>",success:function(l,f){B.bigimg=l.find(".layui-layer-phimg"),B.imgsee=l.find(".layui-layer-imguide,.layui-layer-imgbar"),B.event(l),C.tab&&C.tab(D[x],l),"function"==typeof r&&r(l)},end:function(){B.end=!0,b(document).off("keyup",B.keyup)}},C))},function(){q.close(B.loadi),q.msg("&#x5F53;&#x524D;&#x56FE;&#x7247;&#x5730;&#x5740;&#x5F02;&#x5E38;<br>&#x662F;&#x5426;&#x7EE7;&#x7EED;&#x67E5;&#x770B;&#x4E0B;&#x4E00;&#x5F20;&#xFF1F;",{time:30000,btn:["&#x4E0B;&#x4E00;&#x5F20;","&#x4E0D;&#x770B;&#x4E86;"],yes:function(){D.length>1&&B.imgnext(!0,!0)}})})}},h.run=function(a){b=a,g=b(m),d.html=b("html"),q.open=function(f){var c=new u(f);return c.index}},m.layui&&layui.define?(q.ready(),layui.define("jquery",function(a){q.path=layui.cache.dir,h.run(layui.$),m.layer=q,a("layer",q)})):"function"==typeof define&&define.amd?define(["jquery"],function(){return h.run(m.jQuery),q}):function(){h.run(m.jQuery),q.ready()}()}(window); 
 var _searchHistory=(function(){var b="searchHistory";var e=500;function d(h,k){if(!k){return -1}for(var j=0;j<h.length;j++){if(h[j]["id"]==k){return j}}return -1}function g(j){var k=[];if(window.localStorage){if(j){k=JSON.parse(localStorage.getItem(b));if(!k){return[]}for(var h=0;h<k.length;h++){if(k[h].id==j){return k[h]}}}else{k=JSON.parse(localStorage.getItem(b));k=k?k:[]}}else{}return k}function c(p){if(!p){return}p=p.replaceAll("&#39;","'");var j=p.split(/\) and \(|\) not \(|\) or \(|\'\s+and \(|\'\s+not \(|\'\s+or \(/i);if(j.length>=2){if(j[0].split("(").length==j[0].split(")").length){j[0]=j[0]+"' "}else{j[0]=j[0]+")"}if(j[j.length-1].split("(").length==j[j.length-1].split(")").length){j[j.length-1]="' "+j[j.length-1]}else{j[j.length-1]="("+j[j.length-1]}for(var h=1;h<j.length-1;h++){if(j[h].split("(").length==j[h].split(")").length){j[h]="' "+j[h]+")"}else{j[h]="("+j[h]+")"}}}var m=$("div.search-middle dl dd").length;for(var h=0;h<j.length-m;h++){$("div.search-middle dl dt a.add-group").click()}for(var h=0;h<j.length;h++){var n=p.substring(p.indexOf(j[h])+j[h].length).trim();var k=n.substring(0,n.indexOf(" "));var l=j?h+1:h;$("div.search-middle dl dd:eq("+l+") div.logical .sort-list li").each(function(q,r){if($(r).find("a").text()==k){$(r).parents("div.logical").find("div.sort-default").click();$(r).click();$(r).parents("div.logical").find(".sort-list").css("display","none");return false}});var o=j[h].substring(j[h].indexOf("(")+1,j[h].lastIndexOf(")")).split(/%|=/i);$("div.search-middle dl dd:eq("+h+") div.input-box div.reopt div.sort-list ul li").each(function(t,u){if(!o[0]||$(u).find("a").text()!=o[0]){return true}$(u).parents("div.reopt").find("div.sort-default").click();$(u).click();$(u).parents("div.reopt").find("div.sort-list").css("display","none");$(u).parents("div.input-box").find("input[type=text]").val(o[1]);if(j[h].indexOf("'")>-1){var r=j[h].substring(j[h].indexOf("'")+1,j[h].lastIndexOf("'"));var i=r.split(/ /i);for(var q=0;q<i.length;q++){if(!i[q]){continue}var s=i[q].split("=");$(u).parents("div.input-box").find("input[type=text]").attr(s[0],s[1]).addClass("disable-editor")}}if(j[h].indexOf(",词频=")>-1){$(u).parents("div.input-box").find("div.freq ul li").each(function(v,w){if($(w).find("a").text()==j[h].substring(j[h].lastIndexOf(",词频=")+4)){$(w).parents("div.freq").find("div.sort-default").click();$(w).click();$(w).parents("div.freq").find("ul.sort-list").css("display","none");return false}})}if(j[h].indexOf("%")>-1){$(u).parents("div.input-box").find("div.special ul li").each(function(v,w){if($(w).find("a").attr("value")=="%"){$(w).parents("div.special").find("div.sort-default").click();$(w).click();$(w).parents("div.special").find("ul.sort-list").css("display","none");return false}})}else{$(u).parents("div.input-box").find("div.special ul li").each(function(w,v){if($(v).find("a").attr("value")=="="){$(v).parents("div.special").find("div.sort-default").click();$(v).click();$(v).parents("div.special").find("ul.sort-list").css("display","none");return false}})}return false})}}function f(h){function i(m){if(!m){$("div.extend div.extend-indent-labels input[type='checkbox']").each(function(n,o){$(o).prop("checked",false)})}else{$("div.extend div.extend-indent-labels input[type='checkbox']").each(function(n,o){if((","+m+",").indexOf(","+$(o).parent().text().trim()+",")>-1){$(o).prop("checked",true)}else{$(o).prop("checked",false)}})}}function j(m){if(!m){return}var n=m.split(",");for(var o=0;o<n.length;o++){if(!n[o]){continue}$("div.extend div.extend-row span").each(function(p,q){if($(q).text().indexOf(n[o].split(":")[0])>-1){if(n[o].split(":")[1].indexOf("到")>-1){$(q).parent().find("input[type='text']:eq(0)").val(n[o].split(":")[1].split("到")[0]);$(q).parent().find("input[type='text']:eq(1)").val(n[o].split(":")[1].split("到")[1])}else{$(q).parent().find("ul li a").each(function(s,r){if($(r).text()==n[o].split(":")[1]){$(r).parent().click();$(r).parent().click();$(r).parent().parent().hide()}});$(q).parent().find("input[type='text']").val(n[o].split(":")[1])}}});$("div.extend div.extend-row b").each(function(p,q){if(n[o].split(":").length==1){n[o]=n[o-1].split(":")[0]+":"+n[o]}if($(q).text().indexOf(n[o].split(":")[0])>-1){$(q).next().find("a.icon-browse").click();$("div.layui-layer-content label").each(function(s,r){if((","+n[o].split(":")[1]+",").indexOf(","+$(r).attr("title")+",")>-1){$(r).click()}return true});$("div.layui-layer a.layui-layer-btn0").click()}})}}function l(m){if(!m){return}var n=m.split(":");if(n.length<2){return}$("div.extend div.extend-tit-checklist input[type='checkbox']").each(function(p,q){if((","+n[1]+",").indexOf(","+$(q).parent().text().trim()+",")>-1){if(!$(q).val()){if(!$(q).prop("checked")){$(q).click()}return false}else{if(!$(q).prop("checked")){$(q).click()}}}else{if($(q).prop("checked")){$(q).click()}}});var n=m.split(",");for(var o=0;o<n.length;o++){if(!n[o]){continue}$("div.extend div.extend-row b").each(function(p,q){if($(q).text().indexOf(n[o].split(":")[0])>-1){$(q).next().find("ul li a").each(function(s,r){if($(r).text()==n[o].split(":")[1]){$(r).parent().click();$(r).parent().click();$(r).parent().parent().hide()}})}})}}if(!h){return}var k=h.split("|");if(k.length!=4){return}i(k[1]);j(k[2]);l(k[3])}function a(l){if(!l){return}var h;if(l.indexOf(":")>-1){$("div.top-tabs a").each(function(){if($(this).text()==l.split(":")[0]){$(this).click()}});h=l.split(":")[1].split(",")}else{h=l.split(",")}for(var m=0;m<h.length;m++){var k=h[m].split("|");if(k.length!=2){continue}j(k[0])}$(".icon-arrow").click();function j(i){$("div.nav-content>ul:visible li a").each(function(o,n){if($(n).parent().attr("name")==i){$(n).parent().find("i.icon-select").click();return false}else{if(i.startWith($(n).parent().attr("name"))&&$(n).parent().next().find("li").length==0){var p=$(n).prev();if(!$(p).parent().hasClass("is-down")){var u=$("#dbcode").val();if($("div.patent-classify").length>0){u=$("div.patent-classify>a.cur").attr("dbcode")}var r=$(p).parents(".nav-content-list").attr("data-id");var q=$(p).parent().find("i.icon").attr("id");var t=$(p).parent().find("i.icon").attr("name");var s=$("ul[name="+q+"]").children();if(s.length==0){$.ajax({url:"AdvSearch/_GetAdvNavi",type:"POST",async:false,data:{dbcode:u,naviClassId:r,parentId:q,naviItemlevel:t},success:function(w){if(w){var v=$(".top-tabs a[class='cur']").attr("data-href");if(v){$("#"+v).find("ul[name="+q+"]").html(w)}else{$("ul[name="+q+"]").html(w)}if($("div[name="+q+"]").find("a").hasClass("selected")){$("ul[name="+q+"]").find("a").addClass("selected")}}else{$(p).removeClass("icon")}var x=$(p).parent();x.toggleClass("is-down");if(x.hasClass("is-down")){x.next("ul").slideDown()}else{x.next("ul").slideUp()}j(i)}})}}else{if($(p).parent().parent().find("a.selected")>0){return false}}}}})}}return{save:function(j){if(!j){return false}if(window.localStorage){try{var m=0;var h=g();for(var l=0;l<h.length;l++){if(h[l]["id"]>m){m=h[l]["id"]}if(h[l]["type"]==j.type&&h[l]["from"]==j.from&&h[l]["subject"]==j.subject&&h[l]["where"]==j.where&&h[l]["classify"]==j.classify){j.id=h[l]["id"];h.splice(l,1);h.splice(0,0,j);if(h.length>e){h.splice(e,h.length-e)}localStorage.setItem(b,JSON.stringify(h));return true}}j.id=parseInt(m)+1;h.splice(0,0,j);if(h.length>e){h.splice(e,h.length-e)}localStorage.setItem(b,JSON.stringify(h))}catch(k){e=100;var h=g();if(h.length>e){h.splice(e,h.length-e)}localStorage.setItem(b,JSON.stringify(h))}}else{}return true},get:function(h){return g(h)},getProcuctCode:function(){var i=GetQueryStringByName(window.location.href,"id");if(!i){return""}var h=g(i);if(h.type==6){return h.from.split("|")[1]}else{return h.dbcode}},clear:function(l){if(window.localStorage){if(l){var j=this.get();var h=l.split(",");for(var k in h){var m=d(j,h[k]);if(m>-1){j.splice(m,1)}}localStorage.setItem(b,JSON.stringify(j))}else{localStorage.removeItem(b)}}else{}},bindclick:function(){var n="",t="",l="",k="",m="",o="",q=GetQueryStringByName("subject");var j=$(".search-main .sort-default span");var u=$("div.all-box div.switch-ChEn a").hasClass("cur")?$("#dbcode").val():($("ul.doctype-menus>li.cur a").attr("dbcode")||$("#dbcode").val());var r=$("div.all-box div.switch-ChEn a").hasClass("cur")?$("div.all-box div.switch-ChEn a.cur").text():"";n=r+($(".doctype-menus:not(.is-hide) a[name='dbcode'][dbcode='"+u+"']").find("span").eq(0).text()||$("dd.setdoctype li[data-id='"+u+"']").text()||$("ul.doctype-menus:visible>li.cur>a").text()||message.zk);n=$.trim(n);if($(j).length>0){if(!$(".search-main .search-input").val()){return}t=$(j).text()+"%"+$(".search-main .search-input").val();$(".search-main .search-input").each(function(v,w){$.each(this.attributes,function(){if((this.name.startWith("data-")||this.name=="searchword")&&this.name!="data-tipid"&&this.value){o+=$(w).attr(this.name)?" "+this.name+"="+this.value:""}})});t=o?(t.replaceAll("'","&#39;")+" '"+o+"' "):t.replaceAll("'","&#39;");l=1;k=u+"|"+$(".search-main .sort-default #selectfield").attr("korder")+"|"+$(".search-main .search-input").val()}else{var p={gradeSearch:2,majorSearch:3,authorSearch:4,sentenceSearch:5,"结果中检索":6};var s=$("div.search-classify").find("ul.search-classify-menu:visible li.active");for(var i in p){if(i==$(s).attr("name")){l=p[i]}}n+="|";if(l==2||l==4){$("div.search-middle dl dd").each(function(w,x){if($(x).find("input[type='text']").val()){t+=($(x).find(".logical .sort-default span").text()?(" "+$(x).find(".logical .sort-default span").text()+" "):"")+"("+$(x).find(".reopt .sort-default span").text()+(!$(x).find(".special .sort-default span").attr("value")?" ":$(x).find(".special .sort-default span").attr("value"))+$(x).find("input[type='text']").val()+")";o="";$(x).find("input[type='text']").each(function(){$.each(this.attributes,function(){if((this.name.startWith("data-")||this.name=="searchword")&&this.name!="data-tipid"&&this.value){o+=$(x).find("input[type='text']").attr(this.name)?" "+this.name+"="+this.value:""}})});t=o?(t.replaceAll("'","&#39;")+" '"+o+"' "):t.replaceAll("'","&#39;");var v=$(x).find(".freq .sort-default span").text()&&$(x).find(".freq .sort-default span").text()!="词频"?$(x).find(".freq .sort-default span").text():"";t=v?(t+",词频="+v):t}})}else{if(l==3){t+=$(".search-middle textarea.textarea-major").val().replaceAll("'","&#39;")}else{if(l==5){$("div.search-middle dl dd").each(function(v,w){if($(w).find("input[type='text']").eq(0).val()&&$(w).find("input[type='text']:eq(1)").val()){t+=($(w).find(".logical .sort-default span").text()?(" "+$(w).find(".logical .sort-default span").text()+" "):"")+"("+$(w).find(".sort-sentence .sort-default span").text()+"含有"+$(w).find("input[type='text']:eq(0)").val()+" 和 "+$(w).find("input[type='text']:eq(1)").val()+")"}});t=t.replaceAll("'","&#39;")}}}if(l==2||l==3||l==4||l==5){$("div.nav-content ul li i.selected").each(function(v,w){if(!$(w).parent().parent().parent().parent().children("div").find("a").hasClass("selected")){m+=$(w).parent().attr("name")+"|"+$(w).parent().find("a.navi-search").text()+","}})}if(m.endWith(",")){m=m.substring(0,m.length-1)}m=($("div.top-tabs a.cur").text()&&m)?($("div.top-tabs a.cur").text()+":"+m):m;$("div.extend div.extend-indent-labels input[type='checkbox']").each(function(v,w){if($(w).prop("checked")){n+=$(w).parent().text().trim()+","}});if(n.endWith(",")){n=n.substring(0,n.length-1)}n+="|";n+=$("div.extend div.extend-row:eq(0) b.tit:eq(0)").text();if($("div.extend div.extend-row").children("div:eq(0)").find("b.tit").length>0){n+=$("div.extend div.extend-row").children("div:eq(0)").find("input.inhibit-input").val()?($("div.extend div.extend-row").children("div:eq(0)").find("input.inhibit-input").val()+","):","}if($("div.extend div.extend-row").children("div:eq(1)").find("b.tit").length>0&&$("div.extend div.extend-row").children("div:eq(1)").find("input.inhibit-input").val()){n+=$("div.extend div.extend-row").children("div:eq(1)").find("b.tit").text()+$("div.extend div.extend-row").children("div:eq(1)").find("input.inhibit-input").val()+","}if($("div.extend div.extend-row div.tit-startend-yearbox span.subtit").length>0){n+=$("div.extend div.extend-row div.tit-startend-yearbox span.subtit").text()+":";$("div.extend div.extend-row div.tit-startend-yearbox input[type='text']").each(function(v,w){n+=$(w).val()+"到"});n=n.substring(0,n.length-1)+","}if($("div.extend div.extend-row div.tit-date-box:eq(0) span.subtit").length>0){n+=$("div.extend div.extend-row div.tit-date-box:eq(0) span.subtit").text()+":";$("div.extend div.extend-row div.tit-date-box:eq(0) input.publishdate[type='text']").each(function(v,w){n+=$(w).val()+"到"});n=n.substring(0,n.length-1)+","}if($("div.extend div.extend-row div.tit-date-box:eq(1) span.subtit").length>0){n+=$("div.extend div.extend-row div.tit-date-box:eq(1) span.subtit").text()+":";$("div.extend div.extend-row div.tit-date-box:eq(1) input.publishdate[type='text']").each(function(v,w){n+=$(w).val()+"到"});n=n.substring(0,n.length-1)+","}if($("div.extend div.tit-dropdown-box span.subtit").length>0&&$("div.extend div.tit-dropdown-box div.sort-default span").text()){n+=$("div.extend div.tit-dropdown-box span.subtit").text()+":"+$("div.extend div.tit-dropdown-box div.sort-default span").text()+","}if($("div.extend div.tit-textinput-box span.subtit").length>0&&$("div.extend div.tit-textinput-box input[type='text']").val()){n+=$("div.extend div.tit-textinput-box span.subtit").text()+":"+$("div.extend div.tit-textinput-box input[type='text']").val()+","}$("div.extend div.extend-row:eq(0) div.dropdown-box div.sort-default span").each(function(v,w){if($(w).text()){n+=$(w).closest("div.dropdown-box").attr("data-title")+":"+$(w).text()+","}});if(n.endWith(",")){n=n.substring(0,n.length-1)}n+="|";n+=$("div.extend div.extend-tit-checklist b.tit").text();$("div.extend div.extend-tit-checklist input[type='checkbox']").each(function(v,w){if($(w).prop("checked")){if(!$(w).val()){n+=$(w).parent().text().trim()+",";return false}else{n+=$(w).parent().text().trim()+","}}});$("div.extend div.extend-row div.dropdown-box div.sort-default span").each(function(v,w){if($(w).text()){n+=$(w).closest("div.dropdown-box").attr("data-title")+":"+$(w).text()+","}});if(n.endWith(",")){n=n.substring(0,n.length-1)}}var h={from:n,where:t,time:new Date().format("yyyy-MM-dd hh:mm:ss"),type:l,dbcode:$("#dbcode").val(),classify:m,subject:q};if(l==1){h.href=k}_searchHistory.save(h)},init:function(k){var v=g(k);if(!!v.where){v.where=v.where.replaceAll("&#39;","'")}if(v.type==1){if(v.where.indexOf("'")>-1){var w=v.where.substring(v.where.indexOf("'")+1,v.where.lastIndexOf("'"));var n=w.split(/ /i);for(var t=0;t<n.length;t++){if(!n[t]){continue}var q=n[t].split("=");$(".search-main .search-input").attr(q[0],q[1])}}}if(v.type==2){if(v.dbcode=="GXDB"){var h=$("div.ancientworks-classify>a[dbcode='GXDB']");var m=h.attr("dbcode");h.addClass("cur").siblings().removeClass("cur");$("#dbcode").val(m);$.ajax({url:APPPATH+"/AdvSearch/_LoadSearchFields",type:"POST",async:false,data:{dbcode:m},success:function(i){$(".search-classify-content div.sort-list").html($(i).html());$(".search-middle dd").each(function(x){var j=x>2?0:x;$(this).find(".reopt .sort-list li:eq("+j+")").removeClass("cur").click();$(this).find(".reopt .sort-list").hide()});c(v.where)}});$.ajax({url:APPPATH+"/AdvSearch/_GetAdvNavi",type:"POST",data:{dbcode:m},success:function(i){var j=$(i).find("div.nav-content").html();$(".search-classify-content .search-mainbox").removeClass("is-on").addClass("is-off");$(".search-mainbox .search-sidebar-a .nav-content").html(j)}})}else{c(v.where)}}else{if(v.type==3){if(v.dbcode=="GXDB"){$("a[dbcode='GXDB']").click()}$("div.search-middle textarea.textarea-major").val(v.where)}else{if(v.type==4){c(v.where)}else{if(v.type==5){var r=v.where.split(/ and | not | or /i);for(var s=0;s<r.length;s++){var o=r[s].substring(r[s].indexOf("(")+1,r[s].lastIndexOf(")")).split("含有");var u=v.where.substring(v.where.indexOf(r[s])+r[s].length).trim();var l=u.substring(0,u.indexOf(" "));var p=r?s+1:s;$("div.search-middle dl dd:eq("+p+") div.logical .sort-list li").each(function(j,x){if($(x).find("a").text()==l){$(x).parents("div.logical").find("div.sort-default").click();$(x).click();$(x).parents("div.logical").find(".sort-list").css("display","none");return false}});$("div.search-middle dl dd:eq("+s+") ul.sort-list li").each(function(i,j){if($(j).find("a").text()==o[0]){$(j).parents("div.sort").find("div.sort-default").click();$(j).click();$(j).parent().css("display","none");$(j).parent().parent().parent().find("input[type='text']:eq(0)").val(o[1].split("和")[0].trim());$(j).parent().parent().parent().find("input[type='text']:eq(1)").val(o[1].split("和")[1].trim())}})}}}}}f(v.from?v.from.replace("时间范围：","").replaceAll("：",":"):v.from);a(v.classify);$("input[type='button'].btn-search").click()},apisave:function(){var i="";$.each($("input[name=changeDB]:checked"),function(){var j=$("#dbcode").val();switch(j){case"CJFQ":i="中国学术期刊网络出版总库综合,WWJD";break;case"CFLQ":i="中国学术期刊网络出版总库综合";break;case"CCND":i="中国重要报纸全文数据库综合";break;case"CISD":i="国家标准全文数据库,中国行业标准全文数据库";break;case"SCOD":i="中国专利数据库";break}});var h={sql:$("#sqlVal").val(),dbcode:$("#dbcode").val(),dbname:i};ajaxSubmit.Submit(APPPATH+"/manage/APISaveHistory",h,function(l){var k=JSON.parse(l);if(!k||k.length==0||k.code!=1){return}var j={from:k.data[0]["value"][0],where:k.data[1]["value"][0],time:new Date().format("yyyy-MM-dd hh:mm:ss"),type:6};_searchHistory.save(j)})},resultSearch:function(h){function l(p){var q={from:p.from,where:p.where};$("#dbcode").val(p.from.split("|")[1]);$(".search-his-tip").css("display","block");$(".search-his-tip b").text(p.from.split("|")[0]);$(".search-his-tip .conditions").text(p.where);ajaxSubmit.Submit(APPPATH+"/manage/APIGetHistory",q,function(r){i(r)},"#briefBox")}function i(p){$("#briefBox").html(p);$("#briefBox").show();$("#briefBox #batchOpsBox #analysisLi").hide();$.BriefExtend.downloadValidRight($.BriefParam._getDownloadArgModel());$.searchinfoInit();$.filenameInit();if($("a.fz14").length>0){window.KNS.isCollection($("a.fz14"))}else{if($("dl.result-detail-list>dd h6>a").length>0){window.KNS.isCollection($("dl.result-detail-list>dd>.middle>h6>a"))}}$.BriefExtend.setMostAuthors()}var o=_searchHistory.get(h);var k=GetQueryStringByName(window.location.href,"lg");if(!!k&&/[a-z]+/ig.test(h)){var k=GetQueryStringByName(window.location.href,"lg");var n=GetQueryStringByName(window.location.href,"subject");var m={identy:h,lg:k,subject:n};this.LoadGroupResult(m);ajaxSubmit.Submit(APPPATH+"/manage/APIGetCustom",m,function(p){i(p)},"#briefBox");$("#dbcode").val("SCDB");$(".search-his-tip").css("display","block");var j={frontier:"前沿推荐",importantinst:"重要机构",leadings:"领军专家",coremeeting:"核心会议",finepublic:"精刊先睹",};$(".search-his-tip b").text(j[h]?j[h]:"前沿推荐");$(".search-his-tip .conditions").text()}else{l(o)}},LoadGroupResult:function(h){ajaxSubmit.Submit(APPPATH+"/manage/APIGetGroup",h,function(i){$("#divGroup").html(i);$(".sidebar-filter").hideLoading();new filterFn();renderSelectedGroupItem();$(".visual-row input").val("");$(".icon-arrow-filter").show();filterBoxFold()})}}})();Date.prototype.format=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S+":this.getMilliseconds()};if(/(y+)/i.test(a)){a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var c in b){if(new RegExp("("+c+")").test(a)){a=a.replace(RegExp.$1,RegExp.$1.length==1?b[c]:("00"+b[c]).substr((""+b[c]).length))}}return a};String.prototype.endWith=function(b){var a=new RegExp(b+"$");return a.test(this)};String.prototype.startWith=function(b){var a=new RegExp("^"+b);return a.test(this)};String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a,"gm"),b)};$("div.search-classify").on("click",".btn-search",function(){_searchHistory.bindclick()});$(document).ready(function(){var a=GetQueryStringByName(window.location.href,"id");if(!a){return""}_searchHistory.init(a);if(window.location.pathname.toLowerCase().indexOf("manage/search")>-1){_searchHistory.resultSearch(a)}}); 
 